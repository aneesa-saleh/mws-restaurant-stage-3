"use strict";var restaurants,neighborhoods,cuisines,newMap,markers=[];document.addEventListener("DOMContentLoaded",function(e){initMap(),fetchNeighborhoods(),fetchCuisines(),registerServiceWorker(),window.caches&&setInterval(cleanMapboxTilesCache,5e3)});var fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)})},initMap=function(){self.newMap=L.map("map",{center:[40.722216,-73.987501],zoom:12,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiYW5lZXNhLXNhbGVoIiwiYSI6ImNqa2xmZHVwMDFoYW4zdnAwYWplMm53bHEifQ.V11dDOtEnWSwTxY-C8mJLw",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,r=e[n].value,o=t[a].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,o,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers&&self.markers.forEach(function(e){return e.remove()}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("article"),n=document.createElement("picture"),a=document.createElement("source");a.media="(min-width: 451px) and (max-width: 749px), (min-width: 950px)",a.srcset=DBHelper.imageUrlForRestaurant(e,{size:"medium"}),a.type="image/jpeg",n.appendChild(a);var r=document.createElement("source");r.media="(max-width: 450px), (min-width: 750px) and (max-width: 949px)",r.srcset=DBHelper.imageUrlForRestaurant(e,{size:"small"}),r.type="image/jpeg",n.appendChild(r);var o=document.createElement("img");o.className="restaurant-img",o.srcset=DBHelper.imageUrlForRestaurant(e,{size:"medium"}),o.src=DBHelper.imageUrlForRestaurant(e,{size:"medium",singleValue:!0}),o.alt=e.alt,n.appendChild(o),t.append(n);var s=document.createElement("span"),i=document.createElement("h2");i.innerHTML=e.name,s.append(i);var c=document.createElement("p");c.innerHTML=e.neighborhood,s.append(c);var l=document.createElement("p");l.innerHTML=e.address,s.append(l);var d=document.createElement("a");return d.innerHTML="View Details",d.setAttribute("aria-label","View Details of ".concat(e.name)),d.href=DBHelper.urlForRestaurant(e),s.append(d),t.append(s),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.newMap);t.on("click",function(){window.location.href=t.options.url}),self.markers.push(t)})};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImluaXRNYXAiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJmZXRjaEN1aXNpbmVzIiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiREJIZWxwZXIiLCJlcnJvciIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsImZvckVhY2giLCJuZWlnaGJvcmhvb2QiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiY29uc29sZSIsImZpbGxDdWlzaW5lc0hUTUwiLCJjdWlzaW5lIiwidmFsdWUiLCJhcHBlbmQiLCJMIiwibWFwIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwibmV3TWFwIiwiY2VudGVyIiwidXBkYXRlUmVzdGF1cmFudHMiLCJhZGRUbyIsImNJbmRleCIsImNTZWxlY3QiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiblNlbGVjdCIsInJlc2V0UmVzdGF1cmFudHMiLCJtYXJrZXJzIiwibWFya2VyIiwidWwiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwicmVzdGF1cmFudCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwic291cmNlTWVkaXVtIiwibWVkaWEiLCJzcmNzZXQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJzaXplIiwidHlwZSIsInBpY3R1cmUiLCJhcHBlbmRDaGlsZCIsImFydGljbGUiLCJzb3VyY2VTbWFsbCIsImNsYXNzTmFtZSIsInNpbmdsZVZhbHVlIiwiaW1hZ2UiLCJhbHQiLCJzcGFuIiwibmFtZSIsImFkZHJlc3MiLCJtb3JlIiwiY29uY2F0IiwidXJsRm9yUmVzdGF1cmFudCIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJvcHRpb25zIiwidXJsIiwicHVzaCJdLCJtYXBwaW5ncyI6ImFBQUEsSUFBSUEsWUFDQUMsY0FEQUQsU0FDQUMsT0FDQUMsUUFBSixHQU9BQyxTQUFTQyxpQkFBaUIsbUJBQW9CLFNBQUNDLEdBQzdDQyxVQURGSCxxQkFDRUcsZ0JBR0FDLHdCQURBQyxPQUFBQSxRQUNBRCxZQUFBQSxzQkFBcUIsT0FVdkIsSUFBTUUsbUJBQXFCLFdBQ3pCQyxTQUFTRCxtQkFBbUIsU0FBQ0UsRUFBT1YsR0FDOUJVLEVBRkZGLFFBQUFBLE1BQUFBLElBRUZHLEtBQUlELGNBQU9WLEVBQUVZLDRCQVNqQkEsc0JBQUEsV0FBQSxJQUFBWixFQUFBLEVBQUFhLFVBQUFDLGFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFBRixLQUFBWCxjQUlRZ0IsRUFBU2QsU0FBU2UsZUFBZSx3QkFDdkNqQixFQUFja0IsUUFBUSxTQUFDQyxHQUNyQixJQUFNQyxFQUFTbEIsU0FBU21CLGNBQWMsVUFDdENELEVBQU9FLFVBQVlILEVBSmpCUCxFQUFBQSxNQUFBQSxFQUFnRUksRUFBdkNoQixPQUFBQSxNQUU3Qk8sY0FBQSxXQUZGRSxTQUFBRixjQUFBLFNBQUFHLEVBQUFULEdBVUFTLEVBTU1hLFFBQVFiLE1BQU1BLElBRWRDLEtBQUtWLFNBQVdBLEVBQ2hCdUIsdUJBQUFBLGlCQUFnQixXQUFBLElBQUF2QixFQUFBLEVBQUFZLFVBQUFDLGFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFBRixLQUFBVixTQUNqQmUsRUFBQWQsU0FBQWUsZUFBQSxtQkFDRmhCLEVBUERpQixRQUFBLFNBQUFPLEdBREYsSUFBQUwsRUFBQWxCLFNBQUFtQixjQUFBLFVBV0FELEVBQUFFLFVBQUFHLEVBUUlMLEVBQU9NLE1BQVFELEVBQ2ZULEVBQU9XLE9BQU9QLE1BSGRmLFFB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QyxPQUFBQSxHQUVEUSxHQVFEeUIsZ0JBQWMsWUFBaUNGLEVBQUFBLFVBQUFBLGFBQUFBLElBQUFBLFVBQUFBLEdBQUFBLFVBQUFBLEdBQW5EdkMsS0FBQVosYUFDWVUsUUFBUSxTQUFDK0QsR0FHckJYLElBQVFsQyxFQUFPd0MsU0FBZk0sdUJBQUF2QixFQUFBdkMsS0FBQXlCLFFBRUFXLEVBQU9jLEdBQUFBLFFBcERULFdBdURBYSxPQUFBQyxTQUFBQyxLQUFBN0IsRUFBQThCLFFBQUFDLE1BV0luRSxLQUFLbUMsUUFBUWlDLEtBQUtoQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnRzO1xubGV0IG5laWdoYm9yaG9vZHM7XG5sZXQgY3Vpc2luZXM7XG5sZXQgbmV3TWFwO1xuY29uc3QgbWFya2VycyA9IFtdO1xuXG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4gIGluaXRNYXAoKTsgLy8gYWRkZWRcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XG5cbiAgaWYgKHdpbmRvdy5jYWNoZXMpIHtcbiAgICBzZXRJbnRlcnZhbChjbGVhbk1hcGJveFRpbGVzQ2FjaGUsIDUwMDApO1xuICB9XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmNvbnN0IGZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3JcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cbiAqL1xuY29uc3QgZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaCgobmVpZ2hib3Job29kKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG5cbi8qKlxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuY29uc3QgZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY3Vpc2luZXMuZm9yRWFjaCgoY3Vpc2luZSkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xuY29uc3QgaW5pdE1hcCA9ICgpID0+IHtcbiAgY29uc3QgTUFQQk9YX0FQSV9LRVkgPSAncGsuZXlKMUlqb2lZVzVsWlhOaExYTmhiR1ZvSWl3aVlTSTZJbU5xYTJ4bVpIVndNREZvWVc0emRuQXdZV3BsTW01M2JIRWlmUS5WMTFkRE90RW5XU3dUeFktQzhtSkx3JztcbiAgc2VsZi5uZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgIGNlbnRlcjogWzQwLjcyMjIxNiwgLTczLjk4NzUwMV0sXG4gICAgem9vbTogMTIsXG4gICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZSxcbiAgfSk7XG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0uanBnNzA/YWNjZXNzX3Rva2VuPXttYXBib3hUb2tlbn0nLCB7XG4gICAgbWFwYm94VG9rZW46IE1BUEJPWF9BUElfS0VZLFxuICAgIG1heFpvb206IDE4LFxuICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICdcbiAgICAgICsgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJ1xuICAgICAgKyAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcbiAgICBpZDogJ21hcGJveC5zdHJlZXRzJyxcbiAgfSkuYWRkVG8obmV3TWFwKTtcblxuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufTtcblxuLyoqXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxuICovXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cbmNvbnN0IHJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgdWwuaW5uZXJIVE1MID0gJyc7XG5cbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuICBpZiAoc2VsZi5tYXJrZXJzKSB7XG4gICAgc2VsZi5tYXJrZXJzLmZvckVhY2gobWFya2VyID0+IG1hcmtlci5yZW1vdmUoKSk7XG4gIH1cbiAgc2VsZi5tYXJrZXJzID0gW107XG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn07XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKChyZXN0YXVyYW50KSA9PiB7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxuICovXG5jb25zdCBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJyk7XG5cbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcblxuICAvLyBhIHR3by1jb2x1bW4gbGF5b3V0IGlzIHVzZWQgZm9yIGxhcmdlciB2aWV3cG9ydHNcbiAgLy8gbWVkaXVtIGltYWdlcyBhcmUgZGlzcGxheWVkIGZvciB3aWRlIHNpbmdsZS1jb2x1bW4gKDQ1MXB4IC0gNzQ5cHgpIGFuZCB3aWRlIDItY29sdW1uIHZpZXdwb3J0cyAoPj0gOTUwcHgpXG4gIGNvbnN0IHNvdXJjZU1lZGl1bSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBzb3VyY2VNZWRpdW0ubWVkaWEgPSAnKG1pbi13aWR0aDogNDUxcHgpIGFuZCAobWF4LXdpZHRoOiA3NDlweCksIChtaW4td2lkdGg6IDk1MHB4KSc7XG4gIHNvdXJjZU1lZGl1bS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgeyBzaXplOiAnbWVkaXVtJyB9KTtcbiAgc291cmNlTWVkaXVtLnR5cGUgPSAnaW1hZ2UvanBlZyc7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoc291cmNlTWVkaXVtKTtcblxuICAvLyBzbWFsbCBpbWFnZXMgYXJlIGRpc3BsYXllZCBmb3Igc21hbGwgc2luZ2xlLWNvbHVtbiAoPD0gNDUwcHgpIGFuZCBzbWFsbCAyLWNvbHVtbiB2aWV3cG9ydHMgKDc1MHB4IC0gOTQ5cHgpXG4gIGNvbnN0IHNvdXJjZVNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIHNvdXJjZVNtYWxsLm1lZGlhID0gJyhtYXgtd2lkdGg6IDQ1MHB4KSwgKG1pbi13aWR0aDogNzUwcHgpIGFuZCAobWF4LXdpZHRoOiA5NDlweCknO1xuICBzb3VyY2VTbWFsbC5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgeyBzaXplOiAnc21hbGwnIH0pO1xuICBzb3VyY2VTbWFsbC50eXBlID0gJ2ltYWdlL2pwZWcnO1xuICBwaWN0dXJlLmFwcGVuZENoaWxkKHNvdXJjZVNtYWxsKTtcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICAvLyBzZXQgZGVmYXVsdCBzaXplIGluIGNhc2UgcGljdHVyZSBlbGVtZW50IGlzIG5vdCBzdXBwb3J0ZWRcbiAgaW1hZ2Uuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHsgc2l6ZTogJ21lZGl1bScgfSk7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB7IHNpemU6ICdtZWRpdW0nLCBzaW5nbGVWYWx1ZTogdHJ1ZSB9KTtcbiAgaW1hZ2UuYWx0ID0gcmVzdGF1cmFudC5hbHQ7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoaW1hZ2UpO1xuXG4gIGFydGljbGUuYXBwZW5kKHBpY3R1cmUpO1xuXG4gIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBzcGFuLmFwcGVuZChuYW1lKTtcblxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcbiAgc3Bhbi5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgc3Bhbi5hcHBlbmQoYWRkcmVzcyk7XG5cbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcbiAgbW9yZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgVmlldyBEZXRhaWxzIG9mICR7cmVzdGF1cmFudC5uYW1lfWApO1xuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBzcGFuLmFwcGVuZChtb3JlKTtcblxuICBhcnRpY2xlLmFwcGVuZChzcGFuKTtcblxuICByZXR1cm4gYXJ0aWNsZTtcbn07XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICByZXN0YXVyYW50cy5mb3JFYWNoKChyZXN0YXVyYW50KSA9PiB7XG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm5ld01hcCk7XG4gICAgbWFya2VyLm9uKCdjbGljaycsIG9uQ2xpY2spO1xuICAgIGZ1bmN0aW9uIG9uQ2xpY2soKSB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci5vcHRpb25zLnVybDtcbiAgICB9XG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgfSk7XG59O1xuIl19

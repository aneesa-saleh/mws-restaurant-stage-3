"use strict";

var restaurant;
var reviews;
var newMap;
var matchesMediaQuery;
var mediaQuery = '(min-width: 800px)';
var previouslyFocusedElement;
/**
 * Initialize map as soon as the page is loaded.
 */

document.addEventListener('DOMContentLoaded', function (event) {
  initMap();
  fetchReviews();

  if (window.matchMedia) {
    matchesMediaQuery = window.matchMedia(mediaQuery).matches;
  }

  updateRestaurantContainerAria(); // set initial aria values

  registerServiceWorker();
  setInterval(cleanMapboxTilesCache, 5000);
});
/**
 * Initialize leaflet map
 */

var initMap = function initMap() {
  fetchRestaurantFromURL(function (error, restaurant) {
    var MAPBOX_API_KEY = 'pk.eyJ1IjoiYW5lZXNhLXNhbGVoIiwiYSI6ImNqa2xmZHVwMDFoYW4zdnAwYWplMm53bHEifQ.V11dDOtEnWSwTxY-C8mJLw';

    if (error) {
      // Got an error!
      console.error(error);
    } else {
      self.newMap = L.map('map', {
        center: [restaurant.latlng.lat, restaurant.latlng.lng],
        zoom: 16,
        scrollWheelZoom: false
      });
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}', {
        mapboxToken: MAPBOX_API_KEY,
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox.streets'
      }).addTo(newMap);
      fillBreadcrumb();
      DBHelper.mapMarkerForRestaurant(self.restaurant, self.newMap);
    }
  });
};
/**
* Update aria-hidden values of the visible and accessible restaurant containers
*/


window.addEventListener('resize', function () {
  if (window.matchMedia) {
    var nextMatchesMediaQuery = window.matchMedia(mediaQuery).matches;

    if (nextMatchesMediaQuery !== matchesMediaQuery) {
      // only update aria when layout changes
      matchesMediaQuery = nextMatchesMediaQuery;
      updateRestaurantContainerAria();
    }
  }
});
/**
* Set aria-hidden values for visible and regular restaurant containers
* Accessible restaurant container is off screen
* It is required to maintain screen reading order when the layout shifts
*/

var updateRestaurantContainerAria = function updateRestaurantContainerAria() {
  var restaurantContainer = document.getElementById('restaurant-container');
  var accessibleRestaurantContainer = document.getElementById('accessible-restaurant-container');

  if (matchesMediaQuery) {
    // larger layout, screen reading order off
    restaurantContainer.setAttribute('aria-hidden', 'true');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'false');
  } else {
    // use regular reading order
    restaurantContainer.setAttribute('aria-hidden', 'false');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'true');
  }
};
/**
 * Get current restaurant from page URL.
 */


var fetchRestaurantFromURL = function fetchRestaurantFromURL(callback) {
  if (self.restaurant) {
    // restaurant already fetched!
    callback(null, self.restaurant);
    return;
  }

  var id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    callback(error, null);
  } else {
    DBHelper.fetchRestaurantById(id, function (error, restaurant) {
      self.restaurant = restaurant;

      if (!restaurant) {
        console.error(error);
        return;
      }

      fillRestaurantHTML();
      callback(null, restaurant);
    });
  }
};
/**
 * Create restaurant HTML and add it to the webpage
 */


var fillRestaurantHTML = function fillRestaurantHTML() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;
  var address = document.getElementById('restaurant-address');
  address.innerHTML += restaurant.address;
  var picture = document.getElementById('restaurant-picture');
  var sourceLarge = document.createElement('source');
  sourceLarge.media = '(min-width: 800px)';
  sourceLarge.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'large',
    wide: true
  });
  sourceLarge.type = 'image/jpeg';
  picture.appendChild(sourceLarge);
  var sourceMedium = document.createElement('source');
  sourceMedium.media = '(min-width: 600px)';
  sourceMedium.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'medium'
  });
  sourceMedium.type = 'image/jpeg';
  picture.appendChild(sourceMedium);
  var sourceSmall = document.createElement('source');
  sourceSmall.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'small'
  });
  sourceSmall.type = 'image/jpeg';
  picture.appendChild(sourceSmall);
  var image = document.createElement('img');
  image.className = 'restaurant-img'; // set default size in case picture element is not supported

  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.alt = restaurant.alt;
  picture.appendChild(image);
  var accessibleRestaurantImage = document.getElementById('accessible-restaurant-img');
  accessibleRestaurantImage.setAttribute('aria-label', restaurant.alt);
  var cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type);
  var accessibleRestaurantCuisine = document.getElementById('accessible-restaurant-cuisine');
  accessibleRestaurantCuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type);
  var addReviewButton = document.getElementById('add-review-button');
  addReviewButton.setAttribute('aria-label', "Add a review for ".concat(restaurant.name));
  var addReviewOverlayHeading = document.getElementById('add-review-overlay-heading');
  addReviewOverlayHeading.innerHTML = "Add review for ".concat(restaurant.name); // fill operating hours

  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  }

  if (Object.hasOwnProperty.call(restaurant, 'is_favorite')) {
    fillMarkAsFavouriteHTML();
  }
};
/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */


var fillRestaurantHoursHTML = function fillRestaurantHoursHTML() {
  var operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.operating_hours;
  var hours = document.getElementById('restaurant-hours');

  for (var key in operatingHours) {
    if (Object.prototype.hasOwnProperty.call(operatingHours, key)) {
      var row = document.createElement('tr');
      var day = document.createElement('td');
      day.innerHTML = key;
      row.appendChild(day);
      var time = document.createElement('td');
      time.innerHTML = operatingHours[key];
      row.appendChild(time);
      hours.appendChild(row);
    }
  }
};

var markRestaurantAsFavourite = function markRestaurantAsFavourite(button) {
  var icon = button.querySelector('i');
  var text = button.querySelector('span');
  text.innerHTML = 'Unmark restaurant as favourite';
  icon.classList.add('fas', 'marked');
  icon.classList.remove('far', 'unmarked');
  icon.setAttribute('aria-label', 'Restaurant is currently marked as favourite');
};

var unmarkRestaurantAsFavourite = function unmarkRestaurantAsFavourite(button) {
  var icon = button.querySelector('i');
  var text = button.querySelector('span');
  text.innerHTML = 'Mark restaurant as favourite';
  icon.classList.add('far', 'unmarked');
  icon.classList.remove('fas', 'marked');
  icon.setAttribute('aria-label', 'Restaurant is not currently marked as favourite');
};
/**
 * Set state and text for mark as favourite button.
 */


var fillMarkAsFavouriteHTML = function fillMarkAsFavouriteHTML() {
  var isFavourite = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.is_favorite;
  var favouriteButton = document.getElementById('mark-as-favourite');

  if (stringToBoolean(isFavourite)) {
    markRestaurantAsFavourite(favouriteButton);
  } else {
    unmarkRestaurantAsFavourite(favouriteButton);
  }
};
/**
 * Get current restaurant from page URL.
 */


var fetchReviews = function fetchReviews() {
  var id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    console.log('No restaurant id in URL');
  } else {
    DBHelper.fetchReviewsByRestaurantId(id, function (error, reviews) {
      self.reviews = reviews;

      if (!reviews) {
        console.error(error);
        return;
      }

      fillReviewsHTML();
    });
  }
};
/**
 * Create all reviews HTML and add them to the webpage.
 */


var fillReviewsHTML = function fillReviewsHTML() {
  var reviews = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.reviews;
  var container = document.getElementById('reviews-container');

  if (!reviews) {
    var noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }

  var ul = document.getElementById('reviews-list');
  reviews.forEach(function (review) {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};
/**
 * Create review HTML and add it to the webpage.
 */


var createReviewHTML = function createReviewHTML(review) {
  var article = document.createElement('article');
  article.className = 'review';
  var headerSpan = document.createElement('span');
  headerSpan.className = 'review-header';
  var name = document.createElement('p');
  name.innerHTML = review.name;
  name.className = 'review-name';
  headerSpan.appendChild(name);
  var date = document.createElement('p');
  var dateText = formatDate(new Date(review.updatedAt));
  date.innerHTML = dateText;
  date.className = 'review-date';
  headerSpan.appendChild(date);
  article.appendChild(headerSpan);
  var contentSpan = document.createElement('span');
  contentSpan.className = 'review-content';
  var rating = document.createElement('p');
  rating.innerHTML = "Rating: ".concat(review.rating);
  rating.className = 'review-rating';
  contentSpan.appendChild(rating);
  var comments = document.createElement('p');
  comments.innerHTML = review.comments;
  contentSpan.appendChild(comments);
  article.appendChild(contentSpan);
  return article;
};
/**
 * Add restaurant name to the breadcrumb navigation menu
 */


var fillBreadcrumb = function fillBreadcrumb() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var breadcrumb = document.getElementById('breadcrumb');
  var li = document.createElement('li');
  li.innerHTML = restaurant.name;
  breadcrumb.appendChild(li);
};
/**
 * Get a parameter by name from page URL.
 */


var getParameterByName = function getParameterByName(name, url) {
  url = url || window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  var regex = new RegExp("[?&]".concat(name, "(=([^&#]*)|&|#|$)"));
  var results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};

var setMarkAsFavouriteFetchingState = function setMarkAsFavouriteFetchingState(button, spinner) {
  button.setAttribute('disabled', true);
  button.setAttribute('aria-busy', 'true');
  spinner.classList.add('show');
};

var removeMarkAsFavouriteFetchingState = function removeMarkAsFavouriteFetchingState(button, spinner) {
  button.removeAttribute('disabled');
  button.setAttribute('aria-busy', 'false');
  spinner.classList.remove('show');
};

var toggleRestaurantAsFavourite = function toggleRestaurantAsFavourite() {
  var isFavourite = stringToBoolean(self.restaurant.is_favorite);
  var newIsFavourite = !isFavourite && isFavourite !== 'false';
  var restaurantId = self.restaurant.id;
  var button = document.getElementById('mark-as-favourite');
  var spinner = document.getElementById('favourite-spinner');
  var failedUpdateCallback;

  if (newIsFavourite) {
    markRestaurantAsFavourite(button);
    failedUpdateCallback = unmarkRestaurantAsFavourite;
  } else {
    unmarkRestaurantAsFavourite(button);
    failedUpdateCallback = markRestaurantAsFavourite;
  }

  setMarkAsFavouriteFetchingState(button, spinner);
  DBHelper.setRestaurantFavouriteStatus(restaurantId, newIsFavourite, function (error, updatedRestaurant) {
    removeMarkAsFavouriteFetchingState(button, spinner);

    if (!updatedRestaurant) {
      console.error(error);
      failedUpdateCallback(button);
      return;
    }

    self.restaurant = updatedRestaurant;
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm5ld01hcCIsIm1hdGNoZXNNZWRpYVF1ZXJ5IiwibWVkaWFRdWVyeSIsInByZXZpb3VzbHlGb2N1c2VkRWxlbWVudCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiaW5pdE1hcCIsImZldGNoUmV2aWV3cyIsIndpbmRvdyIsIm1hdGNoTWVkaWEiLCJtYXRjaGVzIiwidXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJzZXRJbnRlcnZhbCIsImNsZWFuTWFwYm94VGlsZXNDYWNoZSIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsIk1BUEJPWF9BUElfS0VZIiwiY29uc29sZSIsInNlbGYiLCJMIiwibWFwIiwiY2VudGVyIiwibGF0bG5nIiwibGF0IiwibG5nIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiaWQiLCJhZGRUbyIsImZpbGxCcmVhZGNydW1iIiwiREJIZWxwZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwibmV4dE1hdGNoZXNNZWRpYVF1ZXJ5IiwicmVzdGF1cmFudENvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIiLCJzZXRBdHRyaWJ1dGUiLCJjYWxsYmFjayIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJuYW1lIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsInBpY3R1cmUiLCJzb3VyY2VMYXJnZSIsImNyZWF0ZUVsZW1lbnQiLCJtZWRpYSIsInNyY3NldCIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInNpemUiLCJ3aWRlIiwidHlwZSIsImFwcGVuZENoaWxkIiwic291cmNlTWVkaXVtIiwic291cmNlU21hbGwiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImFsdCIsImFjY2Vzc2libGVSZXN0YXVyYW50SW1hZ2UiLCJjdWlzaW5lIiwiY3Vpc2luZV90eXBlIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lIiwiYWRkUmV2aWV3QnV0dG9uIiwiYWRkUmV2aWV3T3ZlcmxheUhlYWRpbmciLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsIk9iamVjdCIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImZpbGxNYXJrQXNGYXZvdXJpdGVIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInByb3RvdHlwZSIsInJvdyIsImRheSIsInRpbWUiLCJtYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlIiwiYnV0dG9uIiwiaWNvbiIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0IiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwidW5tYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlIiwiaXNGYXZvdXJpdGUiLCJpc19mYXZvcml0ZSIsImZhdm91cml0ZUJ1dHRvbiIsInN0cmluZ1RvQm9vbGVhbiIsImxvZyIsImZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkIiwiZmlsbFJldmlld3NIVE1MIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImFydGljbGUiLCJoZWFkZXJTcGFuIiwiZGF0ZSIsImRhdGVUZXh0IiwiZm9ybWF0RGF0ZSIsIkRhdGUiLCJ1cGRhdGVkQXQiLCJjb250ZW50U3BhbiIsInJhdGluZyIsImNvbW1lbnRzIiwiYnJlYWRjcnVtYiIsImxpIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJzZXRNYXJrQXNGYXZvdXJpdGVGZXRjaGluZ1N0YXRlIiwic3Bpbm5lciIsInJlbW92ZU1hcmtBc0Zhdm91cml0ZUZldGNoaW5nU3RhdGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJ0b2dnbGVSZXN0YXVyYW50QXNGYXZvdXJpdGUiLCJuZXdJc0Zhdm91cml0ZSIsInJlc3RhdXJhbnRJZCIsImZhaWxlZFVwZGF0ZUNhbGxiYWNrIiwic2V0UmVzdGF1cmFudEZhdm91cml0ZVN0YXR1cyIsInVwZGF0ZWRSZXN0YXVyYW50Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFVBQUo7QUFDQSxJQUFJQyxPQUFKO0FBQ0EsSUFBSUMsTUFBSjtBQUNBLElBQUlDLGlCQUFKO0FBQ0EsSUFBTUMsVUFBVSxHQUFHLG9CQUFuQjtBQUNBLElBQUlDLHdCQUFKO0FBRUE7Ozs7QUFHQUMsUUFBUSxDQUFDQyxnQkFBVCxDQUEwQixrQkFBMUIsRUFBOEMsVUFBQ0MsS0FBRCxFQUFXO0FBQ3ZEQyxFQUFBQSxPQUFPO0FBQ1BDLEVBQUFBLFlBQVk7O0FBQ1osTUFBSUMsTUFBTSxDQUFDQyxVQUFYLEVBQXVCO0FBQ3JCVCxJQUFBQSxpQkFBaUIsR0FBR1EsTUFBTSxDQUFDQyxVQUFQLENBQWtCUixVQUFsQixFQUE4QlMsT0FBbEQ7QUFDRDs7QUFDREMsRUFBQUEsNkJBQTZCLEdBTjBCLENBTXRCOztBQUNqQ0MsRUFBQUEscUJBQXFCO0FBQ3JCQyxFQUFBQSxXQUFXLENBQUNDLHFCQUFELEVBQXdCLElBQXhCLENBQVg7QUFDRCxDQVREO0FBV0E7Ozs7QUFHQSxJQUFNUixPQUFPLEdBQUcsU0FBVkEsT0FBVSxHQUFNO0FBQ3BCUyxFQUFBQSxzQkFBc0IsQ0FBQyxVQUFDQyxLQUFELEVBQVFuQixVQUFSLEVBQXVCO0FBQzVDLFFBQU1vQixjQUFjLEdBQUcsa0dBQXZCOztBQUNBLFFBQUlELEtBQUosRUFBVztBQUFFO0FBQ1hFLE1BQUFBLE9BQU8sQ0FBQ0YsS0FBUixDQUFjQSxLQUFkO0FBQ0QsS0FGRCxNQUVPO0FBQ0xHLE1BQUFBLElBQUksQ0FBQ3BC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TUFBTXdDLFlBQVksR0FBR2xILElBQUksQ0FBQ3RCLFVBQUwsQ0FBZ0JtQyxFQUFyQztBQUNBLE1BQU1xRCxNQUFNLEdBQUdsRixRQUFRLENBQUNvQyxjQUFULENBQXdCLG1CQUF4QixDQUFmO0FBQ0EsTUFBTXlGLE9BQU8sR0FBRzdILFFBQVEsQ0FBQ29DLGNBQVQsQ0FBd0IsbUJBQXhCLENBQWhCO0FBQ0EsTUFBSStGLG9CQUFKOztBQUNBLE1BQUlGLGNBQUosRUFBb0I7QUFDbEJoRCxJQUFBQSx5QkFBeUIsQ0FBQ0MsTUFBRCxDQUF6QjtBQUNBaUQsSUFBQUEsb0JBQW9CLEdBQUcxQywyQkFBdkI7QUFDRCxHQUhELE1BR087QUFDTEEsSUFBQUEsMkJBQTJCLENBQUNQLE1BQUQsQ0FBM0I7QUFDQWlELElBQUFBLG9CQUFvQixHQUFHbEQseUJBQXZCO0FBQ0Q7O0FBQ0QyQyxFQUFBQSwrQkFBK0IsQ0FBQzFDLE1BQUQsRUFBUzJDLE9BQVQsQ0FBL0I7QUFDQTdGLEVBQUFBLFFBQVEsQ0FBQ29HLDRCQUFULENBQXNDRixZQUF0QyxFQUFvREQsY0FBcEQsRUFBb0UsVUFBQ3BILEtBQUQsRUFBUXdILGlCQUFSLEVBQThCO0FBQ2hHUCxJQUFBQSxrQ0FBa0MsQ0FBQzVDLE1BQUQsRUFBUzJDLE9BQVQsQ0FBbEM7O0FBQ0EsUUFBSSxDQUFDUSxpQkFBTCxFQUF3QjtBQUN0QnRILE1BQUFBLE9BQU8sQ0FBQ0YsS0FBUixDQUFjQSxLQUFkO0FBQ0FzSCxNQUFBQSxvQkFBb0IsQ0FBQ2pELE1BQUQsQ0FBcEI7QUFDQTtBQUNEOztBQUNEbEUsSUFBQUEsSUFBSSxDQUFDdEIsVUFBTCxHQUFrQjJJLGlCQUFsQjtBQUNELEdBUkQ7QUFTRCxDQXhCRCIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xubGV0IHJldmlld3M7XG5sZXQgbmV3TWFwO1xubGV0IG1hdGNoZXNNZWRpYVF1ZXJ5O1xuY29uc3QgbWVkaWFRdWVyeSA9ICcobWluLXdpZHRoOiA4MDBweCknO1xubGV0IHByZXZpb3VzbHlGb2N1c2VkRWxlbWVudDtcblxuLyoqXG4gKiBJbml0aWFsaXplIG1hcCBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBpbml0TWFwKCk7XG4gIGZldGNoUmV2aWV3cygpO1xuICBpZiAod2luZG93Lm1hdGNoTWVkaWEpIHtcbiAgICBtYXRjaGVzTWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKG1lZGlhUXVlcnkpLm1hdGNoZXM7XG4gIH1cbiAgdXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEoKTsgLy8gc2V0IGluaXRpYWwgYXJpYSB2YWx1ZXNcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XG4gIHNldEludGVydmFsKGNsZWFuTWFwYm94VGlsZXNDYWNoZSwgNTAwMCk7XG59KTtcblxuLyoqXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwXG4gKi9cbmNvbnN0IGluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgY29uc3QgTUFQQk9YX0FQSV9LRVkgPSAncGsuZXlKMUlqb2lZVzVsWlhOaExYTmhiR1ZvSWl3aVlTSTZJbU5xYTJ4bVpIVndNREZvWVc0emRuQXdZV3BsTW01M2JIRWlmUS5WMTFkRE90RW5XU3dUeFktQzhtSkx3JztcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcbiAgICAgICAgY2VudGVyOiBbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsIHtcbiAgICAgICAgbWFwYm94VG9rZW46IE1BUEJPWF9BUElfS0VZLFxuICAgICAgICBtYXhab29tOiAxOCxcbiAgICAgICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJ1xuICAgICAgICAgICsgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJ1xuICAgICAgICAgICsgJ0ltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vXCI+TWFwYm94PC9hPicsXG4gICAgICAgIGlkOiAnbWFwYm94LnN0cmVldHMnLFxuICAgICAgfSkuYWRkVG8obmV3TWFwKTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5uZXdNYXApO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiogVXBkYXRlIGFyaWEtaGlkZGVuIHZhbHVlcyBvZiB0aGUgdmlzaWJsZSBhbmQgYWNjZXNzaWJsZSByZXN0YXVyYW50IGNvbnRhaW5lcnNcbiovXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICBpZiAod2luZG93Lm1hdGNoTWVkaWEpIHtcbiAgICBjb25zdCBuZXh0TWF0Y2hlc01lZGlhUXVlcnkgPSB3aW5kb3cubWF0Y2hNZWRpYShtZWRpYVF1ZXJ5KS5tYXRjaGVzO1xuICAgIGlmIChuZXh0TWF0Y2hlc01lZGlhUXVlcnkgIT09IG1hdGNoZXNNZWRpYVF1ZXJ5KSB7IC8vIG9ubHkgdXBkYXRlIGFyaWEgd2hlbiBsYXlvdXQgY2hhbmdlc1xuICAgICAgbWF0Y2hlc01lZGlhUXVlcnkgPSBuZXh0TWF0Y2hlc01lZGlhUXVlcnk7XG4gICAgICB1cGRhdGVSZXN0YXVyYW50Q29udGFpbmVyQXJpYSgpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8qKlxuKiBTZXQgYXJpYS1oaWRkZW4gdmFsdWVzIGZvciB2aXNpYmxlIGFuZCByZWd1bGFyIHJlc3RhdXJhbnQgY29udGFpbmVyc1xuKiBBY2Nlc3NpYmxlIHJlc3RhdXJhbnQgY29udGFpbmVyIGlzIG9mZiBzY3JlZW5cbiogSXQgaXMgcmVxdWlyZWQgdG8gbWFpbnRhaW4gc2NyZWVuIHJlYWRpbmcgb3JkZXIgd2hlbiB0aGUgbGF5b3V0IHNoaWZ0c1xuKi9cbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRDb250YWluZXJBcmlhID0gKCkgPT4ge1xuICBjb25zdCByZXN0YXVyYW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY29udGFpbmVyJyk7XG4gIGNvbnN0IGFjY2Vzc2libGVSZXN0YXVyYW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY2Vzc2libGUtcmVzdGF1cmFudC1jb250YWluZXInKTtcbiAgaWYgKG1hdGNoZXNNZWRpYVF1ZXJ5KSB7IC8vIGxhcmdlciBsYXlvdXQsIHNjcmVlbiByZWFkaW5nIG9yZGVyIG9mZlxuICAgIHJlc3RhdXJhbnRDb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuICB9IGVsc2UgeyAvLyB1c2UgcmVndWxhciByZWFkaW5nIG9yZGVyXG4gICAgcmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG4gICAgYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gIH1cbn07XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5jb25zdCBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXG4gICAgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnO1xuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XG4gICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MICs9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBwaWN0dXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtcGljdHVyZScpO1xuXG4gIGNvbnN0IHNvdXJjZUxhcmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIHNvdXJjZUxhcmdlLm1lZGlhID0gJyhtaW4td2lkdGg6IDgwMHB4KSc7XG4gIHNvdXJjZUxhcmdlLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB7IHNpemU6ICdsYXJnZScsIHdpZGU6IHRydWUgfSk7XG4gIHNvdXJjZUxhcmdlLnR5cGUgPSAnaW1hZ2UvanBlZyc7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoc291cmNlTGFyZ2UpO1xuXG4gIGNvbnN0IHNvdXJjZU1lZGl1bSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBzb3VyY2VNZWRpdW0ubWVkaWEgPSAnKG1pbi13aWR0aDogNjAwcHgpJztcbiAgc291cmNlTWVkaXVtLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB7IHNpemU6ICdtZWRpdW0nIH0pO1xuICBzb3VyY2VNZWRpdW0udHlwZSA9ICdpbWFnZS9qcGVnJztcbiAgcGljdHVyZS5hcHBlbmRDaGlsZChzb3VyY2VNZWRpdW0pO1xuXG4gIGNvbnN0IHNvdXJjZVNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIHNvdXJjZVNtYWxsLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB7IHNpemU6ICdzbWFsbCcgfSk7XG4gIHNvdXJjZVNtYWxsLnR5cGUgPSAnaW1hZ2UvanBlZyc7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoc291cmNlU21hbGwpO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIC8vIHNldCBkZWZhdWx0IHNpemUgaW4gY2FzZSBwaWN0dXJlIGVsZW1lbnQgaXMgbm90IHN1cHBvcnRlZFxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGltYWdlLmFsdCA9IHJlc3RhdXJhbnQuYWx0O1xuICBwaWN0dXJlLmFwcGVuZENoaWxkKGltYWdlKTtcblxuICBjb25zdCBhY2Nlc3NpYmxlUmVzdGF1cmFudEltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY2Vzc2libGUtcmVzdGF1cmFudC1pbWcnKTtcbiAgYWNjZXNzaWJsZVJlc3RhdXJhbnRJbWFnZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCByZXN0YXVyYW50LmFsdCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSBgQ3Vpc2luZTogJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX1gO1xuXG4gIGNvbnN0IGFjY2Vzc2libGVSZXN0YXVyYW50Q3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2Nlc3NpYmxlLXJlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBhY2Nlc3NpYmxlUmVzdGF1cmFudEN1aXNpbmUuaW5uZXJIVE1MID0gYEN1aXNpbmU6ICR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9YDtcblxuICBjb25zdCBhZGRSZXZpZXdCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXJldmlldy1idXR0b24nKTtcbiAgYWRkUmV2aWV3QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGBBZGQgYSByZXZpZXcgZm9yICR7cmVzdGF1cmFudC5uYW1lfWApO1xuXG4gIGNvbnN0IGFkZFJldmlld092ZXJsYXlIZWFkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1yZXZpZXctb3ZlcmxheS1oZWFkaW5nJyk7XG4gIGFkZFJldmlld092ZXJsYXlIZWFkaW5nLmlubmVySFRNTCA9IGBBZGQgcmV2aWV3IGZvciAke3Jlc3RhdXJhbnQubmFtZX1gO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cblxuICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocmVzdGF1cmFudCwgJ2lzX2Zhdm9yaXRlJykpIHtcbiAgICBmaWxsTWFya0FzRmF2b3VyaXRlSFRNTCgpO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAoY29uc3Qga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvcGVyYXRpbmdIb3Vycywga2V5KSkge1xuICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBtYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlID0gKGJ1dHRvbikgPT4ge1xuICB2YXIgaWNvbiA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdpJyk7XG4gIHZhciB0ZXh0ID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTtcbiAgdGV4dC5pbm5lckhUTUwgPSAnVW5tYXJrIHJlc3RhdXJhbnQgYXMgZmF2b3VyaXRlJztcbiAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYXMnLCAnbWFya2VkJyk7XG4gIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmFyJywgJ3VubWFya2VkJyk7XG4gIGljb24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1Jlc3RhdXJhbnQgaXMgY3VycmVudGx5IG1hcmtlZCBhcyBmYXZvdXJpdGUnKTtcbn07XG5cbmNvbnN0IHVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZSA9IChidXR0b24pID0+IHtcbiAgdmFyIGljb24gPSBidXR0b24ucXVlcnlTZWxlY3RvcignaScpO1xuICB2YXIgdGV4dCA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzcGFuJyk7XG4gIHRleHQuaW5uZXJIVE1MID0gJ01hcmsgcmVzdGF1cmFudCBhcyBmYXZvdXJpdGUnO1xuICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhcicsICd1bm1hcmtlZCcpO1xuICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhcycsICdtYXJrZWQnKTtcbiAgaWNvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnUmVzdGF1cmFudCBpcyBub3QgY3VycmVudGx5IG1hcmtlZCBhcyBmYXZvdXJpdGUnKTtcbn07XG5cbi8qKlxuICogU2V0IHN0YXRlIGFuZCB0ZXh0IGZvciBtYXJrIGFzIGZhdm91cml0ZSBidXR0b24uXG4gKi9cbmNvbnN0IGZpbGxNYXJrQXNGYXZvdXJpdGVIVE1MID0gKGlzRmF2b3VyaXRlID0gc2VsZi5yZXN0YXVyYW50LmlzX2Zhdm9yaXRlKSA9PiB7XG4gIGNvbnN0IGZhdm91cml0ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXJrLWFzLWZhdm91cml0ZScpO1xuICBpZiAoc3RyaW5nVG9Cb29sZWFuKGlzRmF2b3VyaXRlKSkge1xuICAgIG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoZmF2b3VyaXRlQnV0dG9uKTtcbiAgfSBlbHNlIHtcbiAgICB1bm1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoZmF2b3VyaXRlQnV0dG9uKTtcbiAgfVxuXG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZmV0Y2hSZXZpZXdzID0gKCkgPT4ge1xuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBjb25zb2xlLmxvZygnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChpZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gICAgICBzZWxmLnJldmlld3MgPSByZXZpZXdzO1xuICAgICAgaWYgKCFyZXZpZXdzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmV2aWV3c0hUTUwoKTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXZpZXdzKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2goKHJldmlldykgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcbiAgY29uc3QgYXJ0aWNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2FydGljbGUnKTtcbiAgYXJ0aWNsZS5jbGFzc05hbWUgPSAncmV2aWV3JztcblxuICBjb25zdCBoZWFkZXJTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBoZWFkZXJTcGFuLmNsYXNzTmFtZSA9ICdyZXZpZXctaGVhZGVyJztcblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBuYW1lLmNsYXNzTmFtZSA9ICdyZXZpZXctbmFtZSc7XG4gIGhlYWRlclNwYW4uYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29uc3QgZGF0ZVRleHQgPSBmb3JtYXREYXRlKG5ldyBEYXRlKHJldmlldy51cGRhdGVkQXQpKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBkYXRlVGV4dDtcbiAgZGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3LWRhdGUnO1xuICBoZWFkZXJTcGFuLmFwcGVuZENoaWxkKGRhdGUpO1xuICBhcnRpY2xlLmFwcGVuZENoaWxkKGhlYWRlclNwYW4pO1xuXG4gIGNvbnN0IGNvbnRlbnRTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBjb250ZW50U3Bhbi5jbGFzc05hbWUgPSAncmV2aWV3LWNvbnRlbnQnO1xuXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xuICByYXRpbmcuY2xhc3NOYW1lID0gJ3Jldmlldy1yYXRpbmcnO1xuICBjb250ZW50U3Bhbi5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG4gIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGNvbnRlbnRTcGFuLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcbiAgYXJ0aWNsZS5hcHBlbmRDaGlsZChjb250ZW50U3Bhbik7XG5cbiAgcmV0dXJuIGFydGljbGU7XG59O1xuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmNvbnN0IGZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICB1cmwgPSB1cmwgfHwgd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCk7XG5cblxuICBjb25zdCByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn07XG5cbmNvbnN0IHNldE1hcmtBc0Zhdm91cml0ZUZldGNoaW5nU3RhdGUgPSAoYnV0dG9uLCBzcGlubmVyKSA9PiB7XG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtYnVzeScsICd0cnVlJyk7XG4gIHNwaW5uZXIuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xufVxuXG5jb25zdCByZW1vdmVNYXJrQXNGYXZvdXJpdGVGZXRjaGluZ1N0YXRlID0gKGJ1dHRvbiwgc3Bpbm5lcikgPT4ge1xuICBidXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWJ1c3knLCAnZmFsc2UnKTtcbiAgc3Bpbm5lci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG59XG5cbmNvbnN0IHRvZ2dsZVJlc3RhdXJhbnRBc0Zhdm91cml0ZSA9ICgpID0+IHtcbiAgY29uc3QgaXNGYXZvdXJpdGUgPSBzdHJpbmdUb0Jvb2xlYW4oc2VsZi5yZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcbiAgY29uc3QgbmV3SXNGYXZvdXJpdGUgPSAoIWlzRmF2b3VyaXRlKSAmJiBpc0Zhdm91cml0ZSAhPT0gJ2ZhbHNlJztcbiAgY29uc3QgcmVzdGF1cmFudElkID0gc2VsZi5yZXN0YXVyYW50LmlkO1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFyay1hcy1mYXZvdXJpdGUnKTtcbiAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYXZvdXJpdGUtc3Bpbm5lcicpO1xuICBsZXQgZmFpbGVkVXBkYXRlQ2FsbGJhY2s7XG4gIGlmIChuZXdJc0Zhdm91cml0ZSkge1xuICAgIG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoYnV0dG9uKTtcbiAgICBmYWlsZWRVcGRhdGVDYWxsYmFjayA9IHVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZTtcbiAgfSBlbHNlIHtcbiAgICB1bm1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoYnV0dG9uKTtcbiAgICBmYWlsZWRVcGRhdGVDYWxsYmFjayA9IG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGU7XG4gIH1cbiAgc2V0TWFya0FzRmF2b3VyaXRlRmV0Y2hpbmdTdGF0ZShidXR0b24sIHNwaW5uZXIpO1xuICBEQkhlbHBlci5zZXRSZXN0YXVyYW50RmF2b3VyaXRlU3RhdHVzKHJlc3RhdXJhbnRJZCwgbmV3SXNGYXZvdXJpdGUsIChlcnJvciwgdXBkYXRlZFJlc3RhdXJhbnQpID0+IHtcbiAgICByZW1vdmVNYXJrQXNGYXZvdXJpdGVGZXRjaGluZ1N0YXRlKGJ1dHRvbiwgc3Bpbm5lcik7XG4gICAgaWYgKCF1cGRhdGVkUmVzdGF1cmFudCkge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICBmYWlsZWRVcGRhdGVDYWxsYmFjayhidXR0b24pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZWxmLnJlc3RhdXJhbnQgPSB1cGRhdGVkUmVzdGF1cmFudDtcbiAgfSk7XG59XG4iXSwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5qcyJ9

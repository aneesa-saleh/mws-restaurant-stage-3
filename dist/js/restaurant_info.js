"use strict";

var restaurant;
var reviews;
var newMap;
var matchesMediaQuery;
var mediaQuery = '(min-width: 800px)';
/**
 * Initialize map as soon as the page is loaded.
 */

document.addEventListener('DOMContentLoaded', function (event) {
  initMap();
  fetchReviews();

  if (window.matchMedia) {
    matchesMediaQuery = window.matchMedia(mediaQuery).matches;
  }

  updateRestaurantContainerAria(); // set initial aria values

  registerServiceWorker();
  setInterval(cleanMapboxTilesCache, 5000);
});
/**
 * Initialize leaflet map
 */

var initMap = function initMap() {
  fetchRestaurantFromURL(function (error, restaurant) {
    var MAPBOX_API_KEY = 'pk.eyJ1IjoiYW5lZXNhLXNhbGVoIiwiYSI6ImNqa2xmZHVwMDFoYW4zdnAwYWplMm53bHEifQ.V11dDOtEnWSwTxY-C8mJLw';

    if (error) {
      // Got an error!
      console.error(error);
    } else {
      self.newMap = L.map('map', {
        center: [restaurant.latlng.lat, restaurant.latlng.lng],
        zoom: 16,
        scrollWheelZoom: false
      });
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}', {
        mapboxToken: MAPBOX_API_KEY,
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox.streets'
      }).addTo(newMap);
      fillBreadcrumb();
      DBHelper.mapMarkerForRestaurant(self.restaurant, self.newMap);
    }
  });
};
/**
* Update aria-hidden values of the visible and accessible restaurant containers
*/


window.addEventListener('resize', function () {
  if (window.matchMedia) {
    var nextMatchesMediaQuery = window.matchMedia(mediaQuery).matches;

    if (nextMatchesMediaQuery !== matchesMediaQuery) {
      // only update aria when layout changes
      matchesMediaQuery = nextMatchesMediaQuery;
      updateRestaurantContainerAria();
    }
  }
});
/**
* Set aria-hidden values for visible and regular restaurant containers
* Accessible restaurant container is off screen
* It is required to maintain screen reading order when the layout shifts
*/

var updateRestaurantContainerAria = function updateRestaurantContainerAria() {
  var restaurantContainer = document.getElementById('restaurant-container');
  var accessibleRestaurantContainer = document.getElementById('accessible-restaurant-container');

  if (matchesMediaQuery) {
    // larger layout, screen reading order off
    restaurantContainer.setAttribute('aria-hidden', 'true');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'false');
  } else {
    // use regular reading order
    restaurantContainer.setAttribute('aria-hidden', 'false');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'true');
  }
};
/**
 * Get current restaurant from page URL.
 */


var fetchRestaurantFromURL = function fetchRestaurantFromURL(callback) {
  if (self.restaurant) {
    // restaurant already fetched!
    callback(null, self.restaurant);
    return;
  }

  var id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    callback(error, null);
  } else {
    DBHelper.fetchRestaurantById(id, function (error, restaurant) {
      self.restaurant = restaurant;

      if (!restaurant) {
        console.error(error);
        return;
      }

      fillRestaurantHTML();
      callback(null, restaurant);
    });
  }
};
/**
 * Create restaurant HTML and add it to the webpage
 */


var fillRestaurantHTML = function fillRestaurantHTML() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;
  var address = document.getElementById('restaurant-address');
  address.innerHTML += restaurant.address;
  var picture = document.getElementById('restaurant-picture');
  var sourceLarge = document.createElement('source');
  sourceLarge.media = '(min-width: 800px)';
  sourceLarge.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'large',
    wide: true
  });
  sourceLarge.type = 'image/jpeg';
  picture.appendChild(sourceLarge);
  var sourceMedium = document.createElement('source');
  sourceMedium.media = '(min-width: 600px)';
  sourceMedium.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'medium'
  });
  sourceMedium.type = 'image/jpeg';
  picture.appendChild(sourceMedium);
  var sourceSmall = document.createElement('source');
  sourceSmall.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'small'
  });
  sourceSmall.type = 'image/jpeg';
  picture.appendChild(sourceSmall);
  var image = document.createElement('img');
  image.className = 'restaurant-img'; // set default size in case picture element is not supported

  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.alt = restaurant.alt;
  picture.appendChild(image);
  var accessibleRestaurantImage = document.getElementById('accessible-restaurant-img');
  accessibleRestaurantImage.setAttribute('aria-label', restaurant.alt);
  var cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type);
  var accessibleRestaurantCuisine = document.getElementById('accessible-restaurant-cuisine');
  accessibleRestaurantCuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type); // fill operating hours

  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  }

  if (Object.hasOwnProperty.call(restaurant, 'is_favorite')) {
    fillMarkAsFavouriteHTML();
  }
};
/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */


var fillRestaurantHoursHTML = function fillRestaurantHoursHTML() {
  var operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.operating_hours;
  var hours = document.getElementById('restaurant-hours');

  for (var key in operatingHours) {
    if (Object.prototype.hasOwnProperty.call(operatingHours, key)) {
      var row = document.createElement('tr');
      var day = document.createElement('td');
      day.innerHTML = key;
      row.appendChild(day);
      var time = document.createElement('td');
      time.innerHTML = operatingHours[key];
      row.appendChild(time);
      hours.appendChild(row);
    }
  }
};

var markRestaurantAsFavourite = function markRestaurantAsFavourite(button) {
  var icon = button.querySelector('i');
  var text = button.querySelector('span');
  text.innerHTML = 'Unmark restaurant as favourite';
  icon.classList.add('fas', 'marked');
  icon.classList.remove('far', 'unmarked');
  icon.setAttribute('aria-label', 'Restaurant is currently marked as favourite');
};

var unmarkRestaurantAsFavourite = function unmarkRestaurantAsFavourite(button) {
  var icon = button.querySelector('i');
  var text = button.querySelector('span');
  text.innerHTML = 'Mark restaurant as favourite';
  icon.classList.add('far', 'unmarked');
  icon.classList.remove('fas', 'marked');
  icon.setAttribute('aria-label', 'Restaurant is not currently marked as favourite');
};
/**
 * Set state and text for mark as favourite button.
 */


var fillMarkAsFavouriteHTML = function fillMarkAsFavouriteHTML() {
  var isFavourite = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.is_favorite;
  var favouriteButton = document.getElementById('mark-as-favourite');

  if (stringToBoolean(isFavourite)) {
    markRestaurantAsFavourite(favouriteButton);
  } else {
    unmarkRestaurantAsFavourite(favouriteButton);
  }
};
/**
 * Get current restaurant from page URL.
 */


var fetchReviews = function fetchReviews() {
  var id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    console.log('No restaurant id in URL');
  } else {
    DBHelper.fetchReviewsByRestaurantId(id, function (error, reviews) {
      self.reviews = reviews;

      if (!reviews) {
        console.error(error);
        return;
      }

      fillReviewsHTML();
    });
  }
};
/**
 * Create all reviews HTML and add them to the webpage.
 */


var fillReviewsHTML = function fillReviewsHTML() {
  var reviews = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.reviews;
  var container = document.getElementById('reviews-container');
  var title = document.createElement('h2');
  title.innerHTML = 'Reviews';
  container.appendChild(title);

  if (!reviews) {
    var noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }

  var ul = document.getElementById('reviews-list');
  reviews.forEach(function (review) {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};
/**
 * Create review HTML and add it to the webpage.
 */


var createReviewHTML = function createReviewHTML(review) {
  var article = document.createElement('article');
  article.className = 'review';
  var headerSpan = document.createElement('span');
  headerSpan.className = 'review-header';
  var name = document.createElement('p');
  name.innerHTML = review.name;
  name.className = 'review-name';
  headerSpan.appendChild(name);
  var date = document.createElement('p');
  var dateText = formatDate(new Date(review.updatedAt));
  date.innerHTML = dateText;
  date.className = 'review-date';
  headerSpan.appendChild(date);
  article.appendChild(headerSpan);
  var contentSpan = document.createElement('span');
  contentSpan.className = 'review-content';
  var rating = document.createElement('p');
  rating.innerHTML = "Rating: ".concat(review.rating);
  rating.className = 'review-rating';
  contentSpan.appendChild(rating);
  var comments = document.createElement('p');
  comments.innerHTML = review.comments;
  contentSpan.appendChild(comments);
  article.appendChild(contentSpan);
  return article;
};
/**
 * Add restaurant name to the breadcrumb navigation menu
 */


var fillBreadcrumb = function fillBreadcrumb() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var breadcrumb = document.getElementById('breadcrumb');
  var li = document.createElement('li');
  li.innerHTML = restaurant.name;
  breadcrumb.appendChild(li);
};
/**
 * Get a parameter by name from page URL.
 */


var getParameterByName = function getParameterByName(name, url) {
  url = url || window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  var regex = new RegExp("[?&]".concat(name, "(=([^&#]*)|&|#|$)"));
  var results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};

var setMarkAsFavouriteFetchingState = function setMarkAsFavouriteFetchingState(button, spinner) {
  button.setAttribute('disabled', true);
  button.setAttribute('aria-busy', 'true');
  spinner.classList.add('show');
};

var removeMarkAsFavouriteFetchingState = function removeMarkAsFavouriteFetchingState(button, spinner) {
  button.removeAttribute('disabled');
  button.setAttribute('aria-busy', 'false');
  spinner.classList.remove('show');
};

var toggleRestaurantAsFavourite = function toggleRestaurantAsFavourite() {
  var isFavourite = stringToBoolean(self.restaurant.is_favorite);
  var newIsFavourite = !isFavourite && isFavourite !== 'false';
  var restaurantId = self.restaurant.id;
  var button = document.getElementById('mark-as-favourite');
  var spinner = document.getElementById('favourite-spinner');
  var failedUpdateCallback;

  if (newIsFavourite) {
    markRestaurantAsFavourite(button);
    failedUpdateCallback = unmarkRestaurantAsFavourite;
  } else {
    unmarkRestaurantAsFavourite(button);
    failedUpdateCallback = markRestaurantAsFavourite;
  }

  setMarkAsFavouriteFetchingState(button, spinner);
  DBHelper.setRestaurantFavouriteStatus(restaurantId, newIsFavourite, function (error, updatedRestaurant) {
    removeMarkAsFavouriteFetchingState(button, spinner);

    if (!updatedRestaurant) {
      console.error(error);
      failedUpdateCallback(button);
      return;
    }

    self.restaurant = updatedRestaurant;
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm5ld01hcCIsIm1hdGNoZXNNZWRpYVF1ZXJ5IiwibWVkaWFRdWVyeSIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiaW5pdE1hcCIsImZldGNoUmV2aWV3cyIsIndpbmRvdyIsIm1hdGNoTWVkaWEiLCJtYXRjaGVzIiwidXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJzZXRJbnRlcnZhbCIsImNsZWFuTWFwYm94VGlsZXNDYWNoZSIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsIk1BUEJPWF9BUElfS0VZIiwiY29uc29sZSIsInNlbGYiLCJMIiwibWFwIiwiY2VudGVyIiwibGF0bG5nIiwibGF0IiwibG5nIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiaWQiLCJhZGRUbyIsImZpbGxCcmVhZGNydW1iIiwiREJIZWxwZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwibmV4dE1hdGNoZXNNZWRpYVF1ZXJ5IiwicmVzdGF1cmFudENvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIiLCJzZXRBdHRyaWJ1dGUiLCJjYWxsYmFjayIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJuYW1lIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsInBpY3R1cmUiLCJzb3VyY2VMYXJnZSIsImNyZWF0ZUVsZW1lbnQiLCJtZWRpYSIsInNyY3NldCIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInNpemUiLCJ3aWRlIiwidHlwZSIsImFwcGVuZENoaWxkIiwic291cmNlTWVkaXVtIiwic291cmNlU21hbGwiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImFsdCIsImFjY2Vzc2libGVSZXN0YXVyYW50SW1hZ2UiLCJjdWlzaW5lIiwiY3Vpc2luZV90eXBlIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJPYmplY3QiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJmaWxsTWFya0FzRmF2b3VyaXRlSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJwcm90b3R5cGUiLCJyb3ciLCJkYXkiLCJ0aW1lIiwibWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZSIsImJ1dHRvbiIsImljb24iLCJxdWVyeVNlbGVjdG9yIiwidGV4dCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZSIsImlzRmF2b3VyaXRlIiwiaXNfZmF2b3JpdGUiLCJmYXZvdXJpdGVCdXR0b24iLCJzdHJpbmdUb0Jvb2xlYW4iLCJsb2ciLCJmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZCIsImZpbGxSZXZpZXdzSFRNTCIsImNvbnRhaW5lciIsInRpdGxlIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImFydGljbGUiLCJoZWFkZXJTcGFuIiwiZGF0ZSIsImRhdGVUZXh0IiwiZm9ybWF0RGF0ZSIsIkRhdGUiLCJ1cGRhdGVkQXQiLCJjb250ZW50U3BhbiIsInJhdGluZyIsImNvbW1lbnRzIiwiYnJlYWRjcnVtYiIsImxpIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJzZXRNYXJrQXNGYXZvdXJpdGVGZXRjaGluZ1N0YXRlIiwic3Bpbm5lciIsInJlbW92ZU1hcmtBc0Zhdm91cml0ZUZldGNoaW5nU3RhdGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJ0b2dnbGVSZXN0YXVyYW50QXNGYXZvdXJpdGUiLCJuZXdJc0Zhdm91cml0ZSIsInJlc3RhdXJhbnRJZCIsImZhaWxlZFVwZGF0ZUNhbGxiYWNrIiwic2V0UmVzdGF1cmFudEZhdm91cml0ZVN0YXR1cyIsInVwZGF0ZWRSZXN0YXVyYW50Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFVBQUo7QUFDQSxJQUFJQyxPQUFKO0FBQ0EsSUFBSUMsTUFBSjtBQUNBLElBQUlDLGlCQUFKO0FBQ0EsSUFBTUMsVUFBVSxHQUFHLG9CQUFuQjtBQUVBOzs7O0FBR0FDLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLFVBQUNDLEtBQUQsRUFBVztBQUN2REMsRUFBQUEsT0FBTztBQUNQQyxFQUFBQSxZQUFZOztBQUNaLE1BQUlDLE1BQU0sQ0FBQ0MsVUFBWCxFQUF1QjtBQUNyQlIsSUFBQUEsaUJBQWlCLEdBQUdPLE1BQU0sQ0FBQ0MsVUFBUCxDQUFrQlAsVUFBbEIsRUFBOEJRLE9BQWxEO0FBQ0Q7O0FBQ0RDLEVBQUFBLDZCQUE2QixHQU4wQixDQU10Qjs7QUFDakNDLEVBQUFBLHFCQUFxQjtBQUNyQkMsRUFBQUEsV0FBVyxDQUFDQyxxQkFBRCxFQUF3QixJQUF4QixDQUFYO0FBQ0QsQ0FURDtBQVdBOzs7O0FBR0EsSUFBTVIsT0FBTyxHQUFHLFNBQVZBLE9BQVUsR0FBTTtBQUNwQlMsRUFBQUEsc0JBQXNCLENBQUMsVUFBQ0MsS0FBRCxFQUFRbEIsVUFBUixFQUF1QjtBQUM1QyxRQUFNbUIsY0FBYyxHQUFHLGtHQUF2Qjs7QUFDQSxRQUFJRCxLQUFKLEVBQVc7QUFBRTtBQUNYRSxNQUFBQSxPQUFPLENBQUNGLEtBQVIsQ0FBY0EsS0FBZDtBQUNELEtBRkQsTUFFTztBQUNMRyxNQUFBQSxJQUFJLENBQUNuQixNQUFMLEdBQWNvQixDQUFDLENBQUNDLEdBQUYsQ0FBTSxLQUFOLEVBQWE7QUFDekJDLFFBQUFBLE1BQU0sRUFBRSxDQUFDeEIsVUFBVSxD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OztBQUNBLE1BQUlGLGNBQUosRUFBb0I7QUFDbEJqRCxJQUFBQSx5QkFBeUIsQ0FBQ0MsTUFBRCxDQUF6QjtBQUNBa0QsSUFBQUEsb0JBQW9CLEdBQUczQywyQkFBdkI7QUFDRCxHQUhELE1BR087QUFDTEEsSUFBQUEsMkJBQTJCLENBQUNQLE1BQUQsQ0FBM0I7QUFDQWtELElBQUFBLG9CQUFvQixHQUFHbkQseUJBQXZCO0FBQ0Q7O0FBQ0Q0QyxFQUFBQSwrQkFBK0IsQ0FBQzNDLE1BQUQsRUFBUzRDLE9BQVQsQ0FBL0I7QUFDQTVGLEVBQUFBLFFBQVEsQ0FBQ21HLDRCQUFULENBQXNDRixZQUF0QyxFQUFvREQsY0FBcEQsRUFBb0UsVUFBQ25ILEtBQUQsRUFBUXVILGlCQUFSLEVBQThCO0FBQ2hHUCxJQUFBQSxrQ0FBa0MsQ0FBQzdDLE1BQUQsRUFBUzRDLE9BQVQsQ0FBbEM7O0FBQ0EsUUFBSSxDQUFDUSxpQkFBTCxFQUF3QjtBQUN0QnJILE1BQUFBLE9BQU8sQ0FBQ0YsS0FBUixDQUFjQSxLQUFkO0FBQ0FxSCxNQUFBQSxvQkFBb0IsQ0FBQ2xELE1BQUQsQ0FBcEI7QUFDQTtBQUNEOztBQUNEaEUsSUFBQUEsSUFBSSxDQUFDckIsVUFBTCxHQUFrQnlJLGlCQUFsQjtBQUNELEdBUkQ7QUFTRCxDQXhCRCIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xubGV0IHJldmlld3M7XG5sZXQgbmV3TWFwO1xubGV0IG1hdGNoZXNNZWRpYVF1ZXJ5O1xuY29uc3QgbWVkaWFRdWVyeSA9ICcobWluLXdpZHRoOiA4MDBweCknO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbWFwIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4gIGluaXRNYXAoKTtcbiAgZmV0Y2hSZXZpZXdzKCk7XG4gIGlmICh3aW5kb3cubWF0Y2hNZWRpYSkge1xuICAgIG1hdGNoZXNNZWRpYVF1ZXJ5ID0gd2luZG93Lm1hdGNoTWVkaWEobWVkaWFRdWVyeSkubWF0Y2hlcztcbiAgfVxuICB1cGRhdGVSZXN0YXVyYW50Q29udGFpbmVyQXJpYSgpOyAvLyBzZXQgaW5pdGlhbCBhcmlhIHZhbHVlc1xuICByZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcbiAgc2V0SW50ZXJ2YWwoY2xlYW5NYXBib3hUaWxlc0NhY2hlLCA1MDAwKTtcbn0pO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbGVhZmxldCBtYXBcbiAqL1xuY29uc3QgaW5pdE1hcCA9ICgpID0+IHtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICBjb25zdCBNQVBCT1hfQVBJX0tFWSA9ICdway5leUoxSWpvaVlXNWxaWE5oTFhOaGJHVm9JaXdpWVNJNkltTnFhMnhtWkhWd01ERm9ZVzR6ZG5Bd1lXcGxNbTUzYkhFaWZRLlYxMWRET3RFbldTd1R4WS1DOG1KTHcnO1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5uZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG4gICAgICAgIHpvb206IDE2LFxuICAgICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlLFxuICAgICAgfSk7XG4gICAgICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59Jywge1xuICAgICAgICBtYXBib3hUb2tlbjogTUFQQk9YX0FQSV9LRVksXG4gICAgICAgIG1heFpvb206IDE4LFxuICAgICAgICBhdHRyaWJ1dGlvbjogJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCAnXG4gICAgICAgICAgKyAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnXG4gICAgICAgICAgKyAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcbiAgICAgICAgaWQ6ICdtYXBib3guc3RyZWV0cycsXG4gICAgICB9KS5hZGRUbyhuZXdNYXApO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm5ld01hcCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuKiBVcGRhdGUgYXJpYS1oaWRkZW4gdmFsdWVzIG9mIHRoZSB2aXNpYmxlIGFuZCBhY2Nlc3NpYmxlIHJlc3RhdXJhbnQgY29udGFpbmVyc1xuKi9cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7XG4gIGlmICh3aW5kb3cubWF0Y2hNZWRpYSkge1xuICAgIGNvbnN0IG5leHRNYXRjaGVzTWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKG1lZGlhUXVlcnkpLm1hdGNoZXM7XG4gICAgaWYgKG5leHRNYXRjaGVzTWVkaWFRdWVyeSAhPT0gbWF0Y2hlc01lZGlhUXVlcnkpIHsgLy8gb25seSB1cGRhdGUgYXJpYSB3aGVuIGxheW91dCBjaGFuZ2VzXG4gICAgICBtYXRjaGVzTWVkaWFRdWVyeSA9IG5leHRNYXRjaGVzTWVkaWFRdWVyeTtcbiAgICAgIHVwZGF0ZVJlc3RhdXJhbnRDb250YWluZXJBcmlhKCk7XG4gICAgfVxuICB9XG59KTtcblxuLyoqXG4qIFNldCBhcmlhLWhpZGRlbiB2YWx1ZXMgZm9yIHZpc2libGUgYW5kIHJlZ3VsYXIgcmVzdGF1cmFudCBjb250YWluZXJzXG4qIEFjY2Vzc2libGUgcmVzdGF1cmFudCBjb250YWluZXIgaXMgb2ZmIHNjcmVlblxuKiBJdCBpcyByZXF1aXJlZCB0byBtYWludGFpbiBzY3JlZW4gcmVhZGluZyBvcmRlciB3aGVuIHRoZSBsYXlvdXQgc2hpZnRzXG4qL1xuY29uc3QgdXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEgPSAoKSA9PiB7XG4gIGNvbnN0IHJlc3RhdXJhbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jb250YWluZXInKTtcbiAgY29uc3QgYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjZXNzaWJsZS1yZXN0YXVyYW50LWNvbnRhaW5lcicpO1xuICBpZiAobWF0Y2hlc01lZGlhUXVlcnkpIHsgLy8gbGFyZ2VyIGxheW91dCwgc2NyZWVuIHJlYWRpbmcgb3JkZXIgb2ZmXG4gICAgcmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICBhY2Nlc3NpYmxlUmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG4gIH0gZWxzZSB7IC8vIHVzZSByZWd1bGFyIHJlYWRpbmcgb3JkZXJcbiAgICByZXN0YXVyYW50Q29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICBhY2Nlc3NpYmxlUmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgfVxufTtcblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmNvbnN0IGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuY29uc3QgZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgKz0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1waWN0dXJlJyk7XG5cbiAgY29uc3Qgc291cmNlTGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgc291cmNlTGFyZ2UubWVkaWEgPSAnKG1pbi13aWR0aDogODAwcHgpJztcbiAgc291cmNlTGFyZ2Uuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHsgc2l6ZTogJ2xhcmdlJywgd2lkZTogdHJ1ZSB9KTtcbiAgc291cmNlTGFyZ2UudHlwZSA9ICdpbWFnZS9qcGVnJztcbiAgcGljdHVyZS5hcHBlbmRDaGlsZChzb3VyY2VMYXJnZSk7XG5cbiAgY29uc3Qgc291cmNlTWVkaXVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIHNvdXJjZU1lZGl1bS5tZWRpYSA9ICcobWluLXdpZHRoOiA2MDBweCknO1xuICBzb3VyY2VNZWRpdW0uc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHsgc2l6ZTogJ21lZGl1bScgfSk7XG4gIHNvdXJjZU1lZGl1bS50eXBlID0gJ2ltYWdlL2pwZWcnO1xuICBwaWN0dXJlLmFwcGVuZENoaWxkKHNvdXJjZU1lZGl1bSk7XG5cbiAgY29uc3Qgc291cmNlU21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgc291cmNlU21hbGwuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHsgc2l6ZTogJ3NtYWxsJyB9KTtcbiAgc291cmNlU21hbGwudHlwZSA9ICdpbWFnZS9qcGVnJztcbiAgcGljdHVyZS5hcHBlbmRDaGlsZChzb3VyY2VTbWFsbCk7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgLy8gc2V0IGRlZmF1bHQgc2l6ZSBpbiBjYXNlIHBpY3R1cmUgZWxlbWVudCBpcyBub3Qgc3VwcG9ydGVkXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgaW1hZ2UuYWx0ID0gcmVzdGF1cmFudC5hbHQ7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoaW1hZ2UpO1xuXG4gIGNvbnN0IGFjY2Vzc2libGVSZXN0YXVyYW50SW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjZXNzaWJsZS1yZXN0YXVyYW50LWltZycpO1xuICBhY2Nlc3NpYmxlUmVzdGF1cmFudEltYWdlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHJlc3RhdXJhbnQuYWx0KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IGBDdWlzaW5lOiAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfWA7XG5cbiAgY29uc3QgYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY2Vzc2libGUtcmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGFjY2Vzc2libGVSZXN0YXVyYW50Q3Vpc2luZS5pbm5lckhUTUwgPSBgQ3Vpc2luZTogJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX1gO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cblxuICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocmVzdGF1cmFudCwgJ2lzX2Zhdm9yaXRlJykpIHtcbiAgICBmaWxsTWFya0FzRmF2b3VyaXRlSFRNTCgpO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAoY29uc3Qga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvcGVyYXRpbmdIb3Vycywga2V5KSkge1xuICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBtYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlID0gKGJ1dHRvbikgPT4ge1xuICB2YXIgaWNvbiA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdpJyk7XG4gIHZhciB0ZXh0ID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTtcbiAgdGV4dC5pbm5lckhUTUwgPSAnVW5tYXJrIHJlc3RhdXJhbnQgYXMgZmF2b3VyaXRlJztcbiAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYXMnLCAnbWFya2VkJyk7XG4gIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmFyJywgJ3VubWFya2VkJyk7XG4gIGljb24uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1Jlc3RhdXJhbnQgaXMgY3VycmVudGx5IG1hcmtlZCBhcyBmYXZvdXJpdGUnKTtcbn07XG5cbmNvbnN0IHVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZSA9IChidXR0b24pID0+IHtcbiAgdmFyIGljb24gPSBidXR0b24ucXVlcnlTZWxlY3RvcignaScpO1xuICB2YXIgdGV4dCA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzcGFuJyk7XG4gIHRleHQuaW5uZXJIVE1MID0gJ01hcmsgcmVzdGF1cmFudCBhcyBmYXZvdXJpdGUnO1xuICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhcicsICd1bm1hcmtlZCcpO1xuICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhcycsICdtYXJrZWQnKTtcbiAgaWNvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnUmVzdGF1cmFudCBpcyBub3QgY3VycmVudGx5IG1hcmtlZCBhcyBmYXZvdXJpdGUnKTtcbn07XG5cbi8qKlxuICogU2V0IHN0YXRlIGFuZCB0ZXh0IGZvciBtYXJrIGFzIGZhdm91cml0ZSBidXR0b24uXG4gKi9cbmNvbnN0IGZpbGxNYXJrQXNGYXZvdXJpdGVIVE1MID0gKGlzRmF2b3VyaXRlID0gc2VsZi5yZXN0YXVyYW50LmlzX2Zhdm9yaXRlKSA9PiB7XG4gIGNvbnN0IGZhdm91cml0ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXJrLWFzLWZhdm91cml0ZScpO1xuICBpZiAoc3RyaW5nVG9Cb29sZWFuKGlzRmF2b3VyaXRlKSkge1xuICAgIG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoZmF2b3VyaXRlQnV0dG9uKTtcbiAgfSBlbHNlIHtcbiAgICB1bm1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoZmF2b3VyaXRlQnV0dG9uKTtcbiAgfVxuXG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZmV0Y2hSZXZpZXdzID0gKCkgPT4ge1xuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBjb25zb2xlLmxvZygnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChpZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gICAgICBzZWxmLnJldmlld3MgPSByZXZpZXdzO1xuICAgICAgaWYgKCFyZXZpZXdzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmV2aWV3c0hUTUwoKTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXZpZXdzKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICBpZiAoIXJldmlld3MpIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3cy5mb3JFYWNoKChyZXZpZXcpID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJyk7XG4gIGFydGljbGUuY2xhc3NOYW1lID0gJ3Jldmlldyc7XG5cbiAgY29uc3QgaGVhZGVyU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgaGVhZGVyU3Bhbi5jbGFzc05hbWUgPSAncmV2aWV3LWhlYWRlcic7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbmFtZS5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBoZWFkZXJTcGFuLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IGRhdGVUZXh0ID0gZm9ybWF0RGF0ZShuZXcgRGF0ZShyZXZpZXcudXBkYXRlZEF0KSk7XG4gIGRhdGUuaW5uZXJIVE1MID0gZGF0ZVRleHQ7XG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlldy1kYXRlJztcbiAgaGVhZGVyU3Bhbi5hcHBlbmRDaGlsZChkYXRlKTtcbiAgYXJ0aWNsZS5hcHBlbmRDaGlsZChoZWFkZXJTcGFuKTtcblxuICBjb25zdCBjb250ZW50U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgY29udGVudFNwYW4uY2xhc3NOYW1lID0gJ3Jldmlldy1jb250ZW50JztcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICdyZXZpZXctcmF0aW5nJztcbiAgY29udGVudFNwYW4uYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb250ZW50U3Bhbi5hcHBlbmRDaGlsZChjb21tZW50cyk7XG4gIGFydGljbGUuYXBwZW5kQ2hpbGQoY29udGVudFNwYW4pO1xuXG4gIHJldHVybiBhcnRpY2xlO1xufTtcblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5jb25zdCBmaWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmNvbnN0IGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgdXJsID0gdXJsIHx8IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApO1xuXG5cbiAgY29uc3QgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59O1xuXG5jb25zdCBzZXRNYXJrQXNGYXZvdXJpdGVGZXRjaGluZ1N0YXRlID0gKGJ1dHRvbiwgc3Bpbm5lcikgPT4ge1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIHRydWUpO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWJ1c3knLCAndHJ1ZScpO1xuICBzcGlubmVyLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbn1cblxuY29uc3QgcmVtb3ZlTWFya0FzRmF2b3VyaXRlRmV0Y2hpbmdTdGF0ZSA9IChidXR0b24sIHNwaW5uZXIpID0+IHtcbiAgYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1idXN5JywgJ2ZhbHNlJyk7XG4gIHNwaW5uZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xufVxuXG5jb25zdCB0b2dnbGVSZXN0YXVyYW50QXNGYXZvdXJpdGUgPSAoKSA9PiB7XG4gIGNvbnN0IGlzRmF2b3VyaXRlID0gc3RyaW5nVG9Cb29sZWFuKHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gIGNvbnN0IG5ld0lzRmF2b3VyaXRlID0gKCFpc0Zhdm91cml0ZSkgJiYgaXNGYXZvdXJpdGUgIT09ICdmYWxzZSc7XG4gIGNvbnN0IHJlc3RhdXJhbnRJZCA9IHNlbGYucmVzdGF1cmFudC5pZDtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcmstYXMtZmF2b3VyaXRlJyk7XG4gIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmF2b3VyaXRlLXNwaW5uZXInKTtcbiAgbGV0IGZhaWxlZFVwZGF0ZUNhbGxiYWNrO1xuICBpZiAobmV3SXNGYXZvdXJpdGUpIHtcbiAgICBtYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlKGJ1dHRvbik7XG4gICAgZmFpbGVkVXBkYXRlQ2FsbGJhY2sgPSB1bm1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGU7XG4gIH0gZWxzZSB7XG4gICAgdW5tYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlKGJ1dHRvbik7XG4gICAgZmFpbGVkVXBkYXRlQ2FsbGJhY2sgPSBtYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlO1xuICB9XG4gIHNldE1hcmtBc0Zhdm91cml0ZUZldGNoaW5nU3RhdGUoYnV0dG9uLCBzcGlubmVyKTtcbiAgREJIZWxwZXIuc2V0UmVzdGF1cmFudEZhdm91cml0ZVN0YXR1cyhyZXN0YXVyYW50SWQsIG5ld0lzRmF2b3VyaXRlLCAoZXJyb3IsIHVwZGF0ZWRSZXN0YXVyYW50KSA9PiB7XG4gICAgcmVtb3ZlTWFya0FzRmF2b3VyaXRlRmV0Y2hpbmdTdGF0ZShidXR0b24sIHNwaW5uZXIpO1xuICAgIGlmICghdXBkYXRlZFJlc3RhdXJhbnQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgZmFpbGVkVXBkYXRlQ2FsbGJhY2soYnV0dG9uKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc2VsZi5yZXN0YXVyYW50ID0gdXBkYXRlZFJlc3RhdXJhbnQ7XG4gIH0pO1xufVxuIl0sImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMifQ==

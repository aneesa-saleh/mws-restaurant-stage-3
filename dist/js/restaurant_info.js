"use strict";

var restaurant;
var reviews;
var newMap;
var matchesMediaQuery;
var mediaQuery = '(min-width: 800px)';
/**
 * Initialize map as soon as the page is loaded.
 */

document.addEventListener('DOMContentLoaded', function (event) {
  initMap();
  fetchReviews();

  if (window.matchMedia) {
    matchesMediaQuery = window.matchMedia(mediaQuery).matches;
  }

  updateRestaurantContainerAria(); // set initial aria values

  registerServiceWorker();
  setInterval(cleanMapboxTilesCache, 5000);
});
/**
 * Initialize leaflet map
 */

var initMap = function initMap() {
  fetchRestaurantFromURL(function (error, restaurant) {
    var MAPBOX_API_KEY = 'pk.eyJ1IjoiYW5lZXNhLXNhbGVoIiwiYSI6ImNqa2xmZHVwMDFoYW4zdnAwYWplMm53bHEifQ.V11dDOtEnWSwTxY-C8mJLw';

    if (error) {
      // Got an error!
      console.error(error);
    } else {
      self.newMap = L.map('map', {
        center: [restaurant.latlng.lat, restaurant.latlng.lng],
        zoom: 16,
        scrollWheelZoom: false
      });
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}', {
        mapboxToken: MAPBOX_API_KEY,
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox.streets'
      }).addTo(newMap);
      fillBreadcrumb();
      DBHelper.mapMarkerForRestaurant(self.restaurant, self.newMap);
    }
  });
};
/**
* Update aria-hidden values of the visible and accessible restaurant containers
*/


window.addEventListener('resize', function () {
  if (window.matchMedia) {
    var nextMatchesMediaQuery = window.matchMedia(mediaQuery).matches;

    if (nextMatchesMediaQuery !== matchesMediaQuery) {
      // only update aria when layout changes
      matchesMediaQuery = nextMatchesMediaQuery;
      updateRestaurantContainerAria();
    }
  }
});
/**
* Set aria-hidden values for visible and regular restaurant containers
* Accessible restaurant container is off screen
* It is required to maintain screen reading order when the layout shifts
*/

var updateRestaurantContainerAria = function updateRestaurantContainerAria() {
  var restaurantContainer = document.getElementById('restaurant-container');
  var accessibleRestaurantContainer = document.getElementById('accessible-restaurant-container');

  if (matchesMediaQuery) {
    // larger layout, screen reading order off
    restaurantContainer.setAttribute('aria-hidden', 'true');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'false');
  } else {
    // use regular reading order
    restaurantContainer.setAttribute('aria-hidden', 'false');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'true');
  }
};
/**
 * Get current restaurant from page URL.
 */


var fetchRestaurantFromURL = function fetchRestaurantFromURL(callback) {
  if (self.restaurant) {
    // restaurant already fetched!
    callback(null, self.restaurant);
    return;
  }

  var id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    callback(error, null);
  } else {
    DBHelper.fetchRestaurantById(id, function (error, restaurant) {
      self.restaurant = restaurant;

      if (!restaurant) {
        console.error(error);
        return;
      }

      fillRestaurantHTML();
      callback(null, restaurant);
    });
  }
};
/**
 * Create restaurant HTML and add it to the webpage
 */


var fillRestaurantHTML = function fillRestaurantHTML() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;
  var address = document.getElementById('restaurant-address');
  address.innerHTML += restaurant.address;
  var picture = document.getElementById('restaurant-picture');
  var sourceLarge = document.createElement('source');
  sourceLarge.media = '(min-width: 800px)';
  sourceLarge.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'large',
    wide: true
  });
  sourceLarge.type = 'image/jpeg';
  picture.appendChild(sourceLarge);
  var sourceMedium = document.createElement('source');
  sourceMedium.media = '(min-width: 600px)';
  sourceMedium.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'medium'
  });
  sourceMedium.type = 'image/jpeg';
  picture.appendChild(sourceMedium);
  var sourceSmall = document.createElement('source');
  sourceSmall.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'small'
  });
  sourceSmall.type = 'image/jpeg';
  picture.appendChild(sourceSmall);
  var image = document.createElement('img');
  image.className = 'restaurant-img'; // set default size in case picture element is not supported

  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.alt = restaurant.alt;
  picture.appendChild(image);
  var accessibleRestaurantImage = document.getElementById('accessible-restaurant-img');
  accessibleRestaurantImage.setAttribute('aria-label', restaurant.alt);
  var cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type);
  var accessibleRestaurantCuisine = document.getElementById('accessible-restaurant-cuisine');
  accessibleRestaurantCuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type); // fill operating hours

  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  }

  if (Object.hasOwnProperty.call(restaurant, 'is_favorite')) {
    fillMarkAsFavouriteHTML();
  }
};
/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */


var fillRestaurantHoursHTML = function fillRestaurantHoursHTML() {
  var operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.operating_hours;
  var hours = document.getElementById('restaurant-hours');

  for (var key in operatingHours) {
    if (Object.prototype.hasOwnProperty.call(operatingHours, key)) {
      var row = document.createElement('tr');
      var day = document.createElement('td');
      day.innerHTML = key;
      row.appendChild(day);
      var time = document.createElement('td');
      time.innerHTML = operatingHours[key];
      row.appendChild(time);
      hours.appendChild(row);
    }
  }
};

var markRestaurantAsFavourite = function markRestaurantAsFavourite(button) {
  var icon = button.querySelector('i');
  var text = button.querySelector('span');
  text.innerHTML = 'Unmark restaurant as favourite';
  icon.classList.add('fas', 'marked');
  icon.classList.remove('far', 'unmarked');
  icon.setAttribute('aria-label', 'Restaurant is currently marked as favourite');
};

var unmarkRestaurantAsFavourite = function unmarkRestaurantAsFavourite(button) {
  var icon = button.querySelector('i');
  var text = button.querySelector('span');
  text.innerHTML = 'Mark restaurant as favourite';
  icon.classList.add('far', 'unmarked');
  icon.classList.remove('fas', 'marked');
  icon.setAttribute('aria-label', 'Restaurant is not currently marked as favourite');
};
/**
 * Set state and text for mark as favourite button.
 */


var fillMarkAsFavouriteHTML = function fillMarkAsFavouriteHTML() {
  var isFavourite = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.is_favorite;
  var favouriteButton = document.getElementById('mark-as-favourite');

  if (isFavourite) {
    markRestaurantAsFavourite(favouriteButton);
  } else {
    unmarkRestaurantAsFavourite(favouriteButton);
  }
};
/**
 * Get current restaurant from page URL.
 */


var fetchReviews = function fetchReviews() {
  var id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    console.log('No restaurant id in URL');
  } else {
    DBHelper.fetchReviewsByRestaurantId(id, function (error, reviews) {
      self.reviews = reviews;

      if (!reviews) {
        console.error(error);
        return;
      }

      fillReviewsHTML();
    });
  }
};
/**
 * Create all reviews HTML and add them to the webpage.
 */


var fillReviewsHTML = function fillReviewsHTML() {
  var reviews = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.reviews;
  var container = document.getElementById('reviews-container');
  var title = document.createElement('h2');
  title.innerHTML = 'Reviews';
  container.appendChild(title);

  if (!reviews) {
    var noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }

  var ul = document.getElementById('reviews-list');
  reviews.forEach(function (review) {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};
/**
 * Create review HTML and add it to the webpage.
 */


var createReviewHTML = function createReviewHTML(review) {
  var article = document.createElement('article');
  article.className = 'review';
  var headerSpan = document.createElement('span');
  headerSpan.className = 'review-header';
  var name = document.createElement('p');
  name.innerHTML = review.name;
  name.className = 'review-name';
  headerSpan.appendChild(name);
  var date = document.createElement('p');
  var dateText = formatDate(new Date(review.updatedAt));
  date.innerHTML = dateText;
  date.className = 'review-date';
  headerSpan.appendChild(date);
  article.appendChild(headerSpan);
  var contentSpan = document.createElement('span');
  contentSpan.className = 'review-content';
  var rating = document.createElement('p');
  rating.innerHTML = "Rating: ".concat(review.rating);
  rating.className = 'review-rating';
  contentSpan.appendChild(rating);
  var comments = document.createElement('p');
  comments.innerHTML = review.comments;
  contentSpan.appendChild(comments);
  article.appendChild(contentSpan);
  return article;
};
/**
 * Add restaurant name to the breadcrumb navigation menu
 */


var fillBreadcrumb = function fillBreadcrumb() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var breadcrumb = document.getElementById('breadcrumb');
  var li = document.createElement('li');
  li.innerHTML = restaurant.name;
  breadcrumb.appendChild(li);
};
/**
 * Get a parameter by name from page URL.
 */


var getParameterByName = function getParameterByName(name, url) {
  url = url || window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  var regex = new RegExp("[?&]".concat(name, "(=([^&#]*)|&|#|$)"));
  var results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwicmV2aWV3cyIsIm5ld01hcCIsIm1hdGNoZXNNZWRpYVF1ZXJ5IiwibWVkaWFRdWVyeSIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiaW5pdE1hcCIsImZldGNoUmV2aWV3cyIsIndpbmRvdyIsIm1hdGNoTWVkaWEiLCJtYXRjaGVzIiwidXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJzZXRJbnRlcnZhbCIsImNsZWFuTWFwYm94VGlsZXNDYWNoZSIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsIk1BUEJPWF9BUElfS0VZIiwiY29uc29sZSIsInNlbGYiLCJMIiwibWFwIiwiY2VudGVyIiwibGF0bG5nIiwibGF0IiwibG5nIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiaWQiLCJhZGRUbyIsImZpbGxCcmVhZGNydW1iIiwiREJIZWxwZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwibmV4dE1hdGNoZXNNZWRpYVF1ZXJ5IiwicmVzdGF1cmFudENvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIiLCJzZXRBdHRyaWJ1dGUiLCJjYWxsYmFjayIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJuYW1lIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsInBpY3R1cmUiLCJzb3VyY2VMYXJnZSIsImNyZWF0ZUVsZW1lbnQiLCJtZWRpYSIsInNyY3NldCIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInNpemUiLCJ3aWRlIiwidHlwZSIsImFwcGVuZENoaWxkIiwic291cmNlTWVkaXVtIiwic291cmNlU21hbGwiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImFsdCIsImFjY2Vzc2libGVSZXN0YXVyYW50SW1hZ2UiLCJjdWlzaW5lIiwiY3Vpc2luZV90eXBlIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJPYmplY3QiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJmaWxsTWFya0FzRmF2b3VyaXRlSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJwcm90b3R5cGUiLCJyb3ciLCJkYXkiLCJ0aW1lIiwibWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZSIsImJ1dHRvbiIsImljb24iLCJxdWVyeVNlbGVjdG9yIiwidGV4dCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZSIsImlzRmF2b3VyaXRlIiwiaXNfZmF2b3JpdGUiLCJmYXZvdXJpdGVCdXR0b24iLCJsb2ciLCJmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZCIsImZpbGxSZXZpZXdzSFRNTCIsImNvbnRhaW5lciIsInRpdGxlIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImFydGljbGUiLCJoZWFkZXJTcGFuIiwiZGF0ZSIsImRhdGVUZXh0IiwiZm9ybWF0RGF0ZSIsIkRhdGUiLCJ1cGRhdGVkQXQiLCJjb250ZW50U3BhbiIsInJhdGluZyIsImNvbW1lbnRzIiwiYnJlYWRjcnVtYiIsImxpIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsVUFBSjtBQUNBLElBQUlDLE9BQUo7QUFDQSxJQUFJQyxNQUFKO0FBQ0EsSUFBSUMsaUJBQUo7QUFDQSxJQUFNQyxV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Q0FBd0IsWUFBeEIsQ0FBbkI7QUFDQSxNQUFNNEUsRUFBRSxHQUFHaEgsUUFBUSxDQUFDZ0QsYUFBVCxDQUF1QixJQUF2QixDQUFYO0FBQ0FnRSxFQUFBQSxFQUFFLENBQUNwRSxTQUFILEdBQWVqRCxVQUFVLENBQUNnRCxJQUExQjtBQUNBb0UsRUFBQUEsVUFBVSxDQUFDeEQsV0FBWCxDQUF1QnlELEVBQXZCO0FBQ0QsQ0FMRDtBQU9BOzs7OztBQUdBLElBQU14RSxrQkFBa0IsR0FBRyxTQUFyQkEsa0JBQXFCLENBQUNHLElBQUQsRUFBT3NFLEdBQVAsRUFBZTtBQUN4Q0EsRUFBQUEsR0FBRyxHQUFHQSxHQUFHLElBQUk1RyxNQUFNLENBQUM2RyxRQUFQLENBQWdCQyxJQUE3QjtBQUNBeEUsRUFBQUEsSUFBSSxHQUFHQSxJQUFJLENBQUN5RSxPQUFMLENBQWEsU0FBYixFQUF3QixNQUF4QixDQUFQO0FBQ0EsTUFBTUMsS0FBSyxHQUFHLElBQUlDLE1BQUosZUFBa0IzRSxJQUFsQix1QkFBZDtBQUdBLE1BQU00RSxPQUFPLEdBQUdGLEtBQUssQ0FBQ0csSUFBTixDQUFXUCxHQUFYLENBQWhCO0FBQ0EsTUFBSSxDQUFDTSxPQUFMLEVBQWMsT0FBTyxJQUFQO0FBQ2QsTUFBSSxDQUFDQSxPQUFPLENBQUMsQ0FBRCxDQUFaLEVBQWlCLE9BQU8sRUFBUDtBQUNqQixTQUFPRSxrQkFBa0IsQ0FBQ0YsT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXSCxPQUFYLENBQW1CLEtBQW5CLEVBQTBCLEdBQTFCLENBQUQsQ0FBekI7QUFDRCxDQVZEIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnQ7XG5sZXQgcmV2aWV3cztcbmxldCBuZXdNYXA7XG5sZXQgbWF0Y2hlc01lZGlhUXVlcnk7XG5jb25zdCBtZWRpYVF1ZXJ5ID0gJyhtaW4td2lkdGg6IDgwMHB4KSc7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBtYXAgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcbiAgaW5pdE1hcCgpO1xuICBmZXRjaFJldmlld3MoKTtcbiAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhKSB7XG4gICAgbWF0Y2hlc01lZGlhUXVlcnkgPSB3aW5kb3cubWF0Y2hNZWRpYShtZWRpYVF1ZXJ5KS5tYXRjaGVzO1xuICB9XG4gIHVwZGF0ZVJlc3RhdXJhbnRDb250YWluZXJBcmlhKCk7IC8vIHNldCBpbml0aWFsIGFyaWEgdmFsdWVzXG4gIHJlZ2lzdGVyU2VydmljZVdvcmtlcigpO1xuICBzZXRJbnRlcnZhbChjbGVhbk1hcGJveFRpbGVzQ2FjaGUsIDUwMDApO1xufSk7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBsZWFmbGV0IG1hcFxuICovXG5jb25zdCBpbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGNvbnN0IE1BUEJPWF9BUElfS0VZID0gJ3BrLmV5SjFJam9pWVc1bFpYTmhMWE5oYkdWb0lpd2lZU0k2SW1OcWEyeG1aSFZ3TURGb1lXNHpkbkF3WVdwbE1tNTNiSEVpZlEuVjExZERPdEVuV1N3VHhZLUM4bUpMdyc7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLm5ld01hcCA9IEwubWFwKCdtYXAnLCB7XG4gICAgICAgIGNlbnRlcjogW3Jlc3RhdXJhbnQubGF0bG5nLmxhdCwgcmVzdGF1cmFudC5sYXRsbmcubG5nXSxcbiAgICAgICAgem9vbTogMTYsXG4gICAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0uanBnNzA/YWNjZXNzX3Rva2VuPXttYXBib3hUb2tlbn0nLCB7XG4gICAgICAgIG1hcGJveFRva2VuOiBNQVBCT1hfQVBJX0tFWSxcbiAgICAgICAgbWF4Wm9vbTogMTgsXG4gICAgICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsICdcbiAgICAgICAgICArICc8YSBocmVmPVwiaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvYT4sICdcbiAgICAgICAgICArICdJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxuICAgICAgICBpZDogJ21hcGJveC5zdHJlZXRzJyxcbiAgICAgIH0pLmFkZFRvKG5ld01hcCk7XG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4qIFVwZGF0ZSBhcmlhLWhpZGRlbiB2YWx1ZXMgb2YgdGhlIHZpc2libGUgYW5kIGFjY2Vzc2libGUgcmVzdGF1cmFudCBjb250YWluZXJzXG4qL1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHtcbiAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhKSB7XG4gICAgY29uc3QgbmV4dE1hdGNoZXNNZWRpYVF1ZXJ5ID0gd2luZG93Lm1hdGNoTWVkaWEobWVkaWFRdWVyeSkubWF0Y2hlcztcbiAgICBpZiAobmV4dE1hdGNoZXNNZWRpYVF1ZXJ5ICE9PSBtYXRjaGVzTWVkaWFRdWVyeSkgeyAvLyBvbmx5IHVwZGF0ZSBhcmlhIHdoZW4gbGF5b3V0IGNoYW5nZXNcbiAgICAgIG1hdGNoZXNNZWRpYVF1ZXJ5ID0gbmV4dE1hdGNoZXNNZWRpYVF1ZXJ5O1xuICAgICAgdXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEoKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vKipcbiogU2V0IGFyaWEtaGlkZGVuIHZhbHVlcyBmb3IgdmlzaWJsZSBhbmQgcmVndWxhciByZXN0YXVyYW50IGNvbnRhaW5lcnNcbiogQWNjZXNzaWJsZSByZXN0YXVyYW50IGNvbnRhaW5lciBpcyBvZmYgc2NyZWVuXG4qIEl0IGlzIHJlcXVpcmVkIHRvIG1haW50YWluIHNjcmVlbiByZWFkaW5nIG9yZGVyIHdoZW4gdGhlIGxheW91dCBzaGlmdHNcbiovXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50Q29udGFpbmVyQXJpYSA9ICgpID0+IHtcbiAgY29uc3QgcmVzdGF1cmFudENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWNvbnRhaW5lcicpO1xuICBjb25zdCBhY2Nlc3NpYmxlUmVzdGF1cmFudENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2Nlc3NpYmxlLXJlc3RhdXJhbnQtY29udGFpbmVyJyk7XG4gIGlmIChtYXRjaGVzTWVkaWFRdWVyeSkgeyAvLyBsYXJnZXIgbGF5b3V0LCBzY3JlZW4gcmVhZGluZyBvcmRlciBvZmZcbiAgICByZXN0YXVyYW50Q29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgIGFjY2Vzc2libGVSZXN0YXVyYW50Q29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgfSBlbHNlIHsgLy8gdXNlIHJlZ3VsYXIgcmVhZGluZyBvcmRlclxuICAgIHJlc3RhdXJhbnRDb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuICAgIGFjY2Vzc2libGVSZXN0YXVyYW50Q29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICB9XG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICBpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJztcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgIH0pO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCArPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LXBpY3R1cmUnKTtcblxuICBjb25zdCBzb3VyY2VMYXJnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBzb3VyY2VMYXJnZS5tZWRpYSA9ICcobWluLXdpZHRoOiA4MDBweCknO1xuICBzb3VyY2VMYXJnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgeyBzaXplOiAnbGFyZ2UnLCB3aWRlOiB0cnVlIH0pO1xuICBzb3VyY2VMYXJnZS50eXBlID0gJ2ltYWdlL2pwZWcnO1xuICBwaWN0dXJlLmFwcGVuZENoaWxkKHNvdXJjZUxhcmdlKTtcblxuICBjb25zdCBzb3VyY2VNZWRpdW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgc291cmNlTWVkaXVtLm1lZGlhID0gJyhtaW4td2lkdGg6IDYwMHB4KSc7XG4gIHNvdXJjZU1lZGl1bS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgeyBzaXplOiAnbWVkaXVtJyB9KTtcbiAgc291cmNlTWVkaXVtLnR5cGUgPSAnaW1hZ2UvanBlZyc7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoc291cmNlTWVkaXVtKTtcblxuICBjb25zdCBzb3VyY2VTbWFsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBzb3VyY2VTbWFsbC5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgeyBzaXplOiAnc21hbGwnIH0pO1xuICBzb3VyY2VTbWFsbC50eXBlID0gJ2ltYWdlL2pwZWcnO1xuICBwaWN0dXJlLmFwcGVuZENoaWxkKHNvdXJjZVNtYWxsKTtcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICAvLyBzZXQgZGVmYXVsdCBzaXplIGluIGNhc2UgcGljdHVyZSBlbGVtZW50IGlzIG5vdCBzdXBwb3J0ZWRcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5hbHQgPSByZXN0YXVyYW50LmFsdDtcbiAgcGljdHVyZS5hcHBlbmRDaGlsZChpbWFnZSk7XG5cbiAgY29uc3QgYWNjZXNzaWJsZVJlc3RhdXJhbnRJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2Nlc3NpYmxlLXJlc3RhdXJhbnQtaW1nJyk7XG4gIGFjY2Vzc2libGVSZXN0YXVyYW50SW1hZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgcmVzdGF1cmFudC5hbHQpO1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gYEN1aXNpbmU6ICR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9YDtcblxuICBjb25zdCBhY2Nlc3NpYmxlUmVzdGF1cmFudEN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjZXNzaWJsZS1yZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lLmlubmVySFRNTCA9IGBDdWlzaW5lOiAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfWA7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuXG4gIGlmIChPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChyZXN0YXVyYW50LCAnaXNfZmF2b3JpdGUnKSkge1xuICAgIGZpbGxNYXJrQXNGYXZvdXJpdGVIVE1MKCk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChjb25zdCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9wZXJhdGluZ0hvdXJzLCBrZXkpKSB7XG4gICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgICB9XG4gIH1cbn07XG5cbmNvbnN0IG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUgPSAoYnV0dG9uKSA9PiB7XG4gIHZhciBpY29uID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ2knKTtcbiAgdmFyIHRleHQgPSBidXR0b24ucXVlcnlTZWxlY3Rvcignc3BhbicpO1xuICB0ZXh0LmlubmVySFRNTCA9ICdVbm1hcmsgcmVzdGF1cmFudCBhcyBmYXZvdXJpdGUnO1xuICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhcycsICdtYXJrZWQnKTtcbiAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYXInLCAndW5tYXJrZWQnKTtcbiAgaWNvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnUmVzdGF1cmFudCBpcyBjdXJyZW50bHkgbWFya2VkIGFzIGZhdm91cml0ZScpO1xufTtcblxuY29uc3QgdW5tYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlID0gKGJ1dHRvbikgPT4ge1xuICB2YXIgaWNvbiA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdpJyk7XG4gIHZhciB0ZXh0ID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTtcbiAgdGV4dC5pbm5lckhUTUwgPSAnTWFyayByZXN0YXVyYW50IGFzIGZhdm91cml0ZSc7XG4gIGljb24uY2xhc3NMaXN0LmFkZCgnZmFyJywgJ3VubWFya2VkJyk7XG4gIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmFzJywgJ21hcmtlZCcpO1xuICBpY29uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdSZXN0YXVyYW50IGlzIG5vdCBjdXJyZW50bHkgbWFya2VkIGFzIGZhdm91cml0ZScpO1xufTtcblxuLyoqXG4gKiBTZXQgc3RhdGUgYW5kIHRleHQgZm9yIG1hcmsgYXMgZmF2b3VyaXRlIGJ1dHRvbi5cbiAqL1xuY29uc3QgZmlsbE1hcmtBc0Zhdm91cml0ZUhUTUwgPSAoaXNGYXZvdXJpdGUgPSBzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpID0+IHtcbiAgY29uc3QgZmF2b3VyaXRlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcmstYXMtZmF2b3VyaXRlJyk7XG4gIGlmIChpc0Zhdm91cml0ZSkge1xuICAgIG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoZmF2b3VyaXRlQnV0dG9uKTtcbiAgfSBlbHNlIHtcbiAgICB1bm1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoZmF2b3VyaXRlQnV0dG9uKTtcbiAgfVxuXG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZmV0Y2hSZXZpZXdzID0gKCkgPT4ge1xuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBjb25zb2xlLmxvZygnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChpZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gICAgICBzZWxmLnJldmlld3MgPSByZXZpZXdzO1xuICAgICAgaWYgKCFyZXZpZXdzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmV2aWV3c0hUTUwoKTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXZpZXdzKSA9PiB7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcblxuICBpZiAoIXJldmlld3MpIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3cy5mb3JFYWNoKChyZXZpZXcpID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGFydGljbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhcnRpY2xlJyk7XG4gIGFydGljbGUuY2xhc3NOYW1lID0gJ3Jldmlldyc7XG5cbiAgY29uc3QgaGVhZGVyU3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgaGVhZGVyU3Bhbi5jbGFzc05hbWUgPSAncmV2aWV3LWhlYWRlcic7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbmFtZS5jbGFzc05hbWUgPSAncmV2aWV3LW5hbWUnO1xuICBoZWFkZXJTcGFuLmFwcGVuZENoaWxkKG5hbWUpO1xuXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbnN0IGRhdGVUZXh0ID0gZm9ybWF0RGF0ZShuZXcgRGF0ZShyZXZpZXcudXBkYXRlZEF0KSk7XG4gIGRhdGUuaW5uZXJIVE1MID0gZGF0ZVRleHQ7XG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlldy1kYXRlJztcbiAgaGVhZGVyU3Bhbi5hcHBlbmRDaGlsZChkYXRlKTtcbiAgYXJ0aWNsZS5hcHBlbmRDaGlsZChoZWFkZXJTcGFuKTtcblxuICBjb25zdCBjb250ZW50U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgY29udGVudFNwYW4uY2xhc3NOYW1lID0gJ3Jldmlldy1jb250ZW50JztcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICdyZXZpZXctcmF0aW5nJztcbiAgY29udGVudFNwYW4uYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb250ZW50U3Bhbi5hcHBlbmRDaGlsZChjb21tZW50cyk7XG4gIGFydGljbGUuYXBwZW5kQ2hpbGQoY29udGVudFNwYW4pO1xuXG4gIHJldHVybiBhcnRpY2xlO1xufTtcblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5jb25zdCBmaWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59O1xuXG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cbmNvbnN0IGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgdXJsID0gdXJsIHx8IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApO1xuXG5cbiAgY29uc3QgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKSByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59O1xuIl0sImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMifQ==

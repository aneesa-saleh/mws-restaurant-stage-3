"use strict";function _objectWithoutProperties(e,t){if(null==e)return{};var r,a,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],0<=t.indexOf(r)||(n[r]=e[r]);return n}var restaurant,reviews,outboxReviews,newMap,previouslyConnected,matchesMediaQuery=!0,mediaQuery="(min-width: 800px)";document.addEventListener("DOMContentLoaded",function(e){previouslyConnected=navigator.onLine,initMap(),window.matchMedia&&(matchesMediaQuery=window.matchMedia(mediaQuery).matches),updateRestaurantContainerAria(),registerServiceWorker(),window.caches&&setInterval(cleanMapboxTilesCache,5e3),navigator.serviceWorker&&navigator.serviceWorker.addEventListener("message",function(e){var t=e.data,r=t.type,a=t.requestId,n=t.review,i=t.error;"update-review"===r&&(i?(enqueueToast("An error occurred while submitting your review","error"),updateReviewHTML(!0,a)):(enqueueToast("".concat(n.name,"'s review has been saved"),"success"),updateReviewHTML(!1,a,n)))}),"onLine"in navigator&&(window.addEventListener("online",showConnectionStatus),window.addEventListener("offline",showConnectionStatus),showConnectionStatus());document.getElementById("toast")});var initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiYW5lZXNhLXNhbGVoIiwiYSI6ImNqa2xmZHVwMDFoYW4zdnAwYWplMm53bHEifQ.V11dDOtEnWSwTxY-C8mJLw",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})};window.addEventListener("resize",function(){if(window.matchMedia){var e=window.matchMedia(mediaQuery).matches;e!==matchesMediaQuery&&(matchesMediaQuery=e,updateRestaurantContainerAria())}});var previouslyFocusedElement,updateRestaurantContainerAria=function(){var e=document.getElementById("restaurant-container"),t=document.getElementById("accessible-restaurant-container");matchesMediaQuery?(e.setAttribute("aria-hidden","true"),t.setAttribute("aria-hidden","false")):(e.setAttribute("aria-hidden","false"),t.setAttribute("aria-hidden","true"))},fetchRestaurantFromURL=function(r){if(self.restaurant)r(null,self.restaurant);else{var a=getUrlParam("id");if(a)DBHelper.fetchRestaurantById(a,function(e,t){if(!(self.restaurant=t))return document.getElementById("main-spinner").classList.remove("show"),void document.getElementById("main-error").classList.add("show");fetchReviews(a),fillRestaurantHTML(),document.getElementById("main-spinner").classList.remove("show"),document.getElementById("wrap-main-content").classList.remove("hide"),r(null,t)});else{r("No restaurant id in URL",null),document.getElementById("main-spinner").classList.remove("show"),document.getElementById("main-error").classList.add("show")}}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML+=e.address;var t=document.getElementById("restaurant-picture"),r=document.createElement("source");r.media="(min-width: 800px)",r.srcset=DBHelper.imageUrlForRestaurant(e,{size:"large",wide:!0}),r.type="image/jpeg",t.appendChild(r);var a=document.createElement("source");a.media="(min-width: 600px)",a.srcset=DBHelper.imageUrlForRestaurant(e,{size:"medium"}),a.type="image/jpeg",t.appendChild(a);var n=document.createElement("source");n.srcset=DBHelper.imageUrlForRestaurant(e,{size:"small"}),n.type="image/jpeg",t.appendChild(n);var i=document.createElement("img");i.className="restaurant-img",i.src=DBHelper.imageUrlForRestaurant(e),i.alt=e.alt,t.appendChild(i),document.getElementById("accessible-restaurant-img").setAttribute("aria-label",e.alt),document.getElementById("restaurant-cuisine").innerHTML="Cuisine: ".concat(e.cuisine_type),document.getElementById("accessible-restaurant-cuisine").innerHTML="Cuisine: ".concat(e.cuisine_type);var o=document.getElementById("add-review-button");o.setAttribute("aria-label","Add a review for ".concat(e.name)),o.removeAttribute("disabled"),document.getElementById("add-review-overlay-heading").innerHTML="Add review for ".concat(e.name),e.operating_hours&&fillRestaurantHoursHTML(),Object.hasOwnProperty.call(e,"is_favorite")&&fillMarkAsFavouriteHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var a=document.createElement("tr"),n=document.createElement("td");n.innerHTML=r,a.appendChild(n);var i=document.createElement("td");i.innerHTML=e[r],a.appendChild(i),t.appendChild(a)}},markRestaurantAsFavourite=function(e){var t=e.querySelector("i");e.querySelector("span").innerHTML="Unmark restaurant as favourite",t.classList.add("fas","marked"),t.classList.remove("far","unmarked"),t.setAttribute("aria-label","Restaurant is currently marked as favourite")},unmarkRestaurantAsFavourite=function(e){var t=e.querySelector("i");e.querySelector("span").innerHTML="Mark restaurant as favourite",t.classList.add("far","unmarked"),t.classList.remove("fas","marked"),t.setAttribute("aria-label","Restaurant is not currently marked as favourite")},fillMarkAsFavouriteHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.is_favorite,t=document.getElementById("mark-as-favourite");stringToBoolean(e)?markRestaurantAsFavourite(t):unmarkRestaurantAsFavourite(t)},fetchReviews=function(r){DBHelper.fetchReviewsByRestaurantId(r,function(e,t){(self.reviews=t)?(fillReviewsHTML(),DBHelper.getOutboxReviews(r,function(e,t){e?console.log(e):(self.outboxReviews=t,fillSendingReviewsHTML())})):console.error(e)})},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.reviews;if(!e||0===e.length){var t=document.createElement("p");return t.innerHTML="No reviews yet!",void container.appendChild(t)}var r=document.getElementById("reviews-list");e.forEach(function(e){r.insertBefore(createReviewHTML(e),r.firstChild)})},fillSendingReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.outboxReviews;if(e&&0!==e.length){var a=document.getElementById("reviews-list");e.forEach(function(e){var t=e.request_id,r=_objectWithoutProperties(e,["request_id"]);a.insertBefore(createReviewHTML(r,!0,t),a.firstChild)})}},createReviewHTML=function(e,t,r){var a=document.createElement("article");a.className="review";var n=document.createElement("span");n.className="review-header";var i=document.createElement("p");i.innerHTML=e.name,i.className="review-name",n.appendChild(i);var o=document.createElement("p");if(t){var s=document.createElement("i");s.classList.add("far","fa-clock");var u=document.createElement("span");u.innerHTML="Sending",o.appendChild(s),o.appendChild(u)}else{var d=formatDate(new Date(e.updatedAt));o.innerHTML=d}o.className="review-date",n.appendChild(o),a.appendChild(n);var c=document.createElement("span");c.className="review-content";var l=document.createElement("p");l.innerHTML="Rating: ".concat(e.rating),l.className="review-rating",c.appendChild(l);var m=document.createElement("p");return m.innerHTML=e.comments,c.appendChild(m),a.appendChild(c),t&&(a.setAttribute("data-id",r),a.setAttribute("aria-busy","true"),a.classList.add("sending")),a},updateReviewHTML=function(e,t,r){var a=document.querySelector('[data-id="'.concat(t,'"]'));if(e){if(a){var n=a.querySelector(".review-date");n.innerHTML="";var i=document.createElement("i");i.classList.add("fas","fa-exclamation-triangle");var o=document.createElement("span");o.innerHTML="Sending failed",n.appendChild(i),n.appendChild(o),n.classList.add("error")}}else if(document.getElementById("reviews-list")&&self.restaurant)if(a){a.classList.remove("sending");var s=a.querySelector(".review-date"),u=formatDate(new Date(r.updatedAt));s.innerHTML=u}else createReviewHTML(r,!1)},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,t.appendChild(r)},getUrlParam=function(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},setMarkAsFavouriteFetchingState=function(e,t){e.setAttribute("disabled",!0),e.setAttribute("aria-busy","true"),t.classList.add("show")},removeMarkAsFavouriteFetchingState=function(e,t){e.removeAttribute("disabled"),e.setAttribute("aria-busy","false"),t.classList.remove("show")},toggleRestaurantAsFavourite=function(){var r,a,n,e=stringToBoolean(self.restaurant.is_favorite),t=!e&&"false"!==e,i=self.restaurant.id,o=document.getElementById("mark-as-favourite"),s=document.getElementById("favourite-spinner");n=t?(markRestaurantAsFavourite(o),r=unmarkRestaurantAsFavourite,a="Restaurant has been marked as favourite","An error occurred marking restaurant as favourite"):(unmarkRestaurantAsFavourite(o),r=markRestaurantAsFavourite,a="Restaurant has been unmarked as favourite","An error occurred unmarking restaurant as favourite"),setMarkAsFavouriteFetchingState(o,s),DBHelper.setRestaurantFavouriteStatus(i,t,function(e,t){if(removeMarkAsFavouriteFetchingState(o,s),!t)return console.error(e),r(o),void enqueueToast(n,"error");self.restaurant=t,enqueueToast(a,"success")})};function showConnectionStatus(){document.getElementById("connectionStatus");navigator.onLine&&!previouslyConnected?enqueueToast("You are back online","success"):!navigator.onLine&&previouslyConnected&&enqueueToast("You are offline","error"),previouslyConnected=navigator.onLine}function openModal(){previouslyFocusedElement=document.activeElement;var e=document.querySelector(".overlay"),t=e.querySelectorAll("button, input, textarea");e.classList.add("show"),document.body.classList.add("has-open-modal"),document.addEventListener("keydown",trapTabKey),setTimeout(function(){t[0].focus()},100)}function closeModal(){clearFormErrors(),document.querySelector(".overlay").classList.remove("show"),document.body.classList.remove("has-open-modal"),document.removeEventListener("keydown",trapTabKey),previouslyFocusedElement&&previouslyFocusedElement.focus()}function trapTabKey(e){var t=document.querySelector(".overlay").querySelectorAll("button, input"),r=t[0],a=t[t.length-1];e.key&&"Tab"===e.key&&(e.shiftKey&&e.target===r?(e.preventDefault(),a.focus()):e.shiftKey||e.target!==a||(e.preventDefault(),r.focus()))}function setNameInputError(){var e=document.getElementById("name"),t=document.getElementById("name-error");e.classList.add("has-error"),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby","name-error"),t.classList.add("show")}function clearNameInputError(){var e=document.getElementById("name"),t=document.getElementById("name-error");e.classList.remove("has-error"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),t.classList.remove("show")}function setRatingInputError(){var e=document.getElementById("rating"),t=document.getElementById("rating-error");e.classList.add("has-error"),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby","rating-error"),t.classList.add("show")}function clearRatingInputError(){var e=document.getElementById("rating"),t=document.getElementById("rating-error");e.classList.remove("has-error"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),t.classList.remove("show")}function setCommentInputError(){var e=document.getElementById("comments"),t=document.getElementById("comments-error");e.classList.add("has-error"),e.setAttribute("aria-invalid","true"),e.setAttribute("aria-describedby","comments-error"),t.classList.add("show")}function clearCommentInputError(){var e=document.getElementById("comments"),t=document.getElementById("comments-error");e.classList.remove("has-error"),e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),t.classList.remove("show")}var errorFunctions={name:{setError:setNameInputError,clearError:clearNameInputError},rating:{setError:setRatingInputError,clearError:clearRatingInputError},comments:{setError:setCommentInputError,clearError:clearCommentInputError}};function validateInput(e,t){var r,a=document.getElementById(e).cloneNode();return r=void 0!==t?t:a.value,(r="rating"===e?Number.parseInt(r,10):r)?(errorFunctions[e].clearError(),!0):(requestAnimationFrame(errorFunctions[e].setError),!1)}function validateAllInputs(){var t=!1,r=[];return["name","rating","comments"].forEach(function(e){validateInput(e)||(r.push(e),t=!0)}),{error:t,invalidInputs:r}}function handleRangeChange(e){document.querySelector(".rating-value").innerHTML="".concat(e.target.value,"/5"),validateInput(e.target.name,e.target.value)}function handleInputKeyUp(e){e.key&&"Tab"===e.key||validateInput(e.target.name,e.target.value)}function handleInputBlur(e){validateInput(e.target.name,e.target.value)}function getFormInputValues(){var t={};return["name","rating","comments"].forEach(function(e){t[e]=document.getElementById(e).value}),t}function clearForm(){document.getElementById("name").value="",document.getElementById("rating").value="0",document.querySelector(".rating-value").innerHTML="0/5",document.getElementById("comments").value=""}function clearFormErrors(){document.getElementById("name-error").classList.remove("show"),document.getElementById("rating-error").classList.remove("show"),document.getElementById("comments-error").classList.remove("show"),document.getElementById("add-review-form-error").classList.remove("show"),document.getElementById("add-review-form-error").innerHTML="",document.getElementById("name").classList.remove("has-error"),document.getElementById("rating").classList.remove("has-error"),document.getElementById("comments").classList.remove("has-error")}function handleAddReviewSubmit(){var e=validateAllInputs(),t=e.error,r=e.invalidInputs;if(t){var a=document.getElementById("add-review-form-error"),n="Invalid input for: ".concat(r.join(", "));a.innerHTML=n,a.classList.add("show"),document.getElementById(r[0]).focus()}else{var i=getFormInputValues(),o=i.name,s=i.rating,u=i.comments;if(navigator.serviceWorker&&navigator.serviceWorker.controller){var d="".concat(self.restaurant.id,"-").concat(Date.now()),c={name:o,rating:s,comments:u,restaurant_id:self.restaurant.id},l=document.getElementById("reviews-list");l.insertBefore(createReviewHTML(c,!0,d),l.firstChild),"onLine"in navigator&&!navigator.onLine&&enqueueToast("Your review will be submitted when you are back online"),closeModal(),clearForm(),navigator.serviceWorker.controller.postMessage({type:"post-review",review:c,requestId:d})}else{var m=document.getElementById("add-review-submit");m.setAttribute("disabled",!0),m.setAttribute("aria-busy","true"),DBHelper.addReview(self.restaurant.id,o,s,u,function(e,t){if(m.removeAttribute("disabled"),m.setAttribute("aria-busy","false"),e)enqueueToast("An error occurred. Please try again","error"),console.log(e);else{enqueueToast("".concat(o,"'s review has been saved"),"success");var r=document.getElementById("reviews-list");r.insertBefore(createReviewHTML(t),r.firstChild),closeModal(),clearForm()}})}}}function handleFormSubmit(e){e.preventDefault()}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyIsImFkZFJldmlld01vZGFsLmpzIl0sIm5hbWVzIjpbInJlc3RhdXJhbnQiLCJyZXZpZXdzIiwib3V0Ym94UmV2aWV3cyIsIm5ld01hcCIsIm1hdGNoZXNNZWRpYVF1ZXJ5IiwibWVkaWFRdWVyeSIsImRvY3VtZW50IiwiZXZlbnQiLCJwcmV2aW91c2x5Q29ubmVjdGVkIiwibmF2aWdhdG9yIiwib25MaW5lIiwiaW5pdE1hcCIsIndpbmRvdyIsIm1hdGNoTWVkaWEiLCJtYXRjaGVzIiwidXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEiLCJzZXJ2aWNlV29ya2VyIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9ldmVudCRkYXRhIiwiY2FjaGVzIiwidHlwZSIsInJlcXVlc3RJZCIsInJldmlldyIsImVycm9yIiwiY2xlYW5NYXBib3hUaWxlc0NhY2hlIiwic2V0SW50ZXJ2YWwiLCJlbnF1ZXVlVG9hc3QiLCJjb25jYXQiLCJkYXRhIiwic2hvd0Nvbm5lY3Rpb25TdGF0dXMiLCJ1cGRhdGVSZXZpZXdIVE1MIiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25zb2xlIiwic2VsZiIsIkwiLCJtYXAiLCJjZW50ZXIiLCJsYXRsbmciLCJsYXQiLCJsbmciLCJ6b29tIiwic2Nyb2xsV2hlZWxab29tIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsIk1BUEJPWF9BUElfS0VZIiwiYXR0cmlidXRpb24iLCJhZGRUbyIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJpZCIsImZpbGxCcmVhZGNydW1iIiwiREJIZWxwZXIiLCJuZXh0TWF0Y2hlc01lZGlhUXVlcnkiLCJwcmV2aW91c2x5Rm9jdXNlZEVsZW1lbnQiLCJhY2Nlc3NpYmxlUmVzdGF1cmFudENvbnRhaW5lciIsInNldEF0dHJpYnV0ZSIsInJlc3RhdXJhbnRDb250YWluZXIiLCJjYWxsYmFjayIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJpbm5lckhUTUwiLCJuYW1lIiwiYWRkcmVzcyIsInNvdXJjZUxhcmdlIiwiY3JlYXRlRWxlbWVudCIsIm1lZGlhIiwic3Jjc2V0IiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwic2l6ZSIsIndpZGUiLCJmZXRjaFJldmlld3MiLCJzb3VyY2VNZWRpdW0iLCJwaWN0dXJlIiwiYXBwZW5kQ2hpbGQiLCJzb3VyY2VTbWFsbCIsImltYWdlIiwiYWx0IiwiY3Vpc2luZV90eXBlIiwiYWRkUmV2aWV3QnV0dG9uIiwicmVtb3ZlQXR0cmlidXRlIiwib3BlcmF0aW5nX2hvdXJzIiwiY2xhc3NOYW1lIiwiY2FsbCIsImZpbGxNYXJrQXNGYXZvdXJpdGVIVE1MIiwiY3Vpc2luZSIsIm9wZXJhdGluZ0hvdXJzIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lIiwia2V5IiwiYWRkUmV2aWV3T3ZlcmxheUhlYWRpbmciLCJyb3ciLCJkYXkiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsInRpbWUiLCJtYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlIiwiYnV0dG9uIiwiaWNvbiIsInF1ZXJ5U2VsZWN0b3IiLCJob3VycyIsInVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZSIsImlzRmF2b3VyaXRlIiwidGV4dCIsImZhdm91cml0ZUJ1dHRvbiIsImZpbGxSZXZpZXdzSFRNTCIsImdldE91dGJveFJldmlld3MiLCJmaWxsU2VuZGluZ1Jldmlld3NIVE1MIiwibm9SZXZpZXdzIiwiZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJ1bCIsImluc2VydEJlZm9yZSIsImNyZWF0ZVJldmlld0hUTUwiLCJmaXJzdENoaWxkIiwib3V0Ym94UmV2aWV3IiwiX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIiwicmVxdWVzdF9pZCIsInNlbmRpbmciLCJhcnRpY2xlIiwiaGVhZGVyU3BhbiIsImNvbnRhaW5lciIsImRhdGUiLCJsb2FkaW5nVGV4dCIsImZvckVhY2giLCJ1cGRhdGVkQXQiLCJjb250ZW50U3BhbiIsInJhdGluZyIsImNvbW1lbnRzIiwiZGF0ZVRleHQiLCJmb3JtYXREYXRlIiwicmV2aWV3RWxlbWVudCIsImVycm9yVGV4dCIsImJyZWFkY3J1bWIiLCJsaSIsInVybCIsImxvY2F0aW9uIiwiaHJlZiIsInJlcGxhY2UiLCJyZXN1bHRzIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsInNldE1hcmtBc0Zhdm91cml0ZUZldGNoaW5nU3RhdGUiLCJEYXRlIiwic3Bpbm5lciIsInJlbW92ZU1hcmtBc0Zhdm91cml0ZUZldGNoaW5nU3RhdGUiLCJ0b2dnbGVSZXN0YXVyYW50QXNGYXZvdXJpdGUiLCJzdWNjZXNzTWVzc2FnZSIsImVycm9yTWVzc2FnZSIsInN0cmluZ1RvQm9vbGVhbiIsImlzX2Zhdm9yaXRlIiwiZ2V0VXJsUGFyYW0iLCJuZXdJc0Zhdm91cml0ZSIsImZhaWxlZFVwZGF0ZUNhbGxiYWNrIiwic2V0UmVzdGF1cmFudEZhdm91cml0ZVN0YXR1cyIsInJlc3RhdXJhbnRJZCIsInVwZGF0ZWRSZXN0YXVyYW50Iiwib3Blbk1vZGFsIiwiYWN0aXZlRWxlbWVudCIsIm92ZXJsYXkiLCJpbnRlcmFjdGl2ZUVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImJvZHkiLCJ0cmFwVGFiS2V5Iiwic2V0VGltZW91dCIsImZvY3VzIiwiY2xvc2VNb2RhbCIsImNsZWFyRm9ybUVycm9ycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJmaXJzdEVsZW1lbnQiLCJsYXN0RWxlbWVudCIsInNoaWZ0S2V5IiwidGFyZ2V0IiwicHJldmVudERlZmF1bHQiLCJzZXROYW1lSW5wdXRFcnJvciIsIm5hbWVJbnB1dCIsIm5hbWVJbnB1dEVycm9yIiwiY2xlYXJOYW1lSW5wdXRFcnJvciIsInNldFJhdGluZ0lucHV0RXJyb3IiLCJyYXRpbmdJbnB1dCIsInJhdGluZ0lucHV0RXJyb3IiLCJjbGVhclJhdGluZ0lucHV0RXJyb3IiLCJzZXRDb21tZW50SW5wdXRFcnJvciIsImNvbW1lbnRJbnB1dCIsImNvbW1lbnRJbnB1dEVycm9yIiwiY2xlYXJDb21tZW50SW5wdXRFcnJvciIsImVycm9yRnVuY3Rpb25zIiwic2V0RXJyb3IiLCJjbGVhckVycm9yIiwidmFsaWRhdGVJbnB1dCIsInZhbHVlIiwiaW5wdXRWYWx1ZSIsImlucHV0IiwiY2xvbmVOb2RlIiwiTnVtYmVyIiwicGFyc2VJbnQiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJ2YWxpZGF0ZUFsbElucHV0cyIsImludmFsaWRJbnB1dHMiLCJwdXNoIiwiaGFuZGxlUmFuZ2VDaGFuZ2UiLCJoYW5kbGVJbnB1dEtleVVwIiwiaGFuZGxlSW5wdXRCbHVyIiwiZ2V0Rm9ybUlucHV0VmFsdWVzIiwidmFsdWVzIiwiY2xlYXJGb3JtIiwiaGFuZGxlQWRkUmV2aWV3U3VibWl0IiwiX3ZhbGlkYXRlQWxsSW5wdXRzIiwiZm9ybUVycm9yIiwiam9pbiIsIl9nZXRGb3JtSW5wdXRWYWx1ZXMiLCJjb250cm9sbGVyIiwibm93IiwibmV3UmV2aWV3IiwicmVzdGF1cmFudF9pZCIsInBvc3RNZXNzYWdlIiwic3VibWl0QnV0dG9uIiwiYWRkUmV2aWV3IiwibG9nIiwiaGFuZGxlRm9ybVN1Ym1pdCJdLCJtYXBwaW5ncyI6Im1kQUFBLElBQUlBLFdBQ0FDLFFBQ0FDLGNBQ0FDLE9BSEFILG9CQUlBSSxtQkFBb0IsRUFDbEJDLFdBQWEscUJBQW5CQyxTQUFNRCxpQkFBYSxtQkFBbkIsU0FBQUUsR0FDQUMsb0JBQUFDLFVBQUFDLE9BUUVDLFVBQ0lDLE9BQU9DLGFBQ1RULGtCQUFvQlEsT0FBT0MsV0FBV1IsWUFBWVMsU0FKcEROLGdDQUVBRyx3QkFDSUMsT0FBT0MsUUFDVFQsWUFBQUEsc0JBQTJCUyxLQUU3QkUsVUFBQUEsZUFRRU4sVUFBVU8sY0FBY0MsaUJBQWlCLFVBQVcsU0FBQ1YsR0FBVSxJQUFBVyxFQUw3RE4sRUFBT08sS0FPTEMsRUFGMkRGLEVBRTNERSxLQUFNQyxFQUZxREgsRUFFckRH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QUNBdUMsWUFDQXBNLFVBQVVPLGNBQWNtTSxXQUFXSSxZQUFZLENBQzdDbk0sS0FBTSxjQUNORSxPQUFRK0wsRUFDUmhNLFVBQUFBLFFBcENxRSxDQUV2RSxJQUFNbU0sRUFBZWxOLFNBQVN5QixlQUFlLHFCQUM3Q3lMLEVBQWFuSyxhQUFhLFlBQVksR0FDdENtSyxFQUFhbkssYUFBYSxZQUFhLFFBQ3ZDSixTQUFTd0ssVUFBVXhMLEtBQUtqQyxXQUFXK0MsR0FBSWtCLEVBQU04RCxFQUFRQyxFQUFVLFNBQUN6RyxFQUFPOEwsR0FHckUsR0FGQUcsRUFBYXJJLGdCQUFnQixZQUM3QnFJLEVBQWFuSyxhQUFhLFlBQWEsU0FDbkM5QixFQUNGRyxhQUFhLHNDQUF1QyxTQUNwRE0sUUFBUTBMLElBQUluTSxPQUNQLENBQ0xHLGFBQVksR0FBQUMsT0FBSXNDLEVBQUosNEJBQW9DLFdBQ2hELElBQU04QyxFQUFLekcsU0FBU3lCLGVBQWUsZ0JBQ25DZ0YsRUFBR0MsYUFBYUMsaUJBQWlCb0csR0FBWXRHLEVBQUdHLFlBQ2hEb0QsYUFDQXVDLGlCQWdDVixTQUFTYyxpQkFBaUJwTixHQUN4QkEsRUFBTXNLIiwiZmlsZSI6InJlc3RhdXJhbnRfaW5mby5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xubGV0IHJldmlld3M7XG5sZXQgb3V0Ym94UmV2aWV3cztcbmxldCBuZXdNYXA7XG5sZXQgbWF0Y2hlc01lZGlhUXVlcnkgPSB0cnVlO1xuY29uc3QgbWVkaWFRdWVyeSA9ICcobWluLXdpZHRoOiA4MDBweCknO1xubGV0IHByZXZpb3VzbHlDb25uZWN0ZWQ7XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBtYXAgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoZXZlbnQpID0+IHtcbiAgcHJldmlvdXNseUNvbm5lY3RlZCA9IG5hdmlnYXRvci5vbkxpbmU7XG5cbiAgaW5pdE1hcCgpO1xuICBpZiAod2luZG93Lm1hdGNoTWVkaWEpIHtcbiAgICBtYXRjaGVzTWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKG1lZGlhUXVlcnkpLm1hdGNoZXM7XG4gIH1cbiAgdXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEoKTsgLy8gc2V0IGluaXRpYWwgYXJpYSB2YWx1ZXNcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XG5cbiAgaWYgKHdpbmRvdy5jYWNoZXMpIHtcbiAgICBzZXRJbnRlcnZhbChjbGVhbk1hcGJveFRpbGVzQ2FjaGUsIDUwMDApO1xuICB9XG5cbiAgaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudCkgPT4ge1xuICAgICAgY29uc3Qge1xuICAgICAgICB0eXBlLCByZXF1ZXN0SWQsIHJldmlldywgZXJyb3IsXG4gICAgICB9ID0gZXZlbnQuZGF0YTtcbiAgICAgIGlmICh0eXBlID09PSAndXBkYXRlLXJldmlldycpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgZW5xdWV1ZVRvYXN0KCdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBzdWJtaXR0aW5nIHlvdXIgcmV2aWV3JywgJ2Vycm9yJyk7XG4gICAgICAgICAgdXBkYXRlUmV2aWV3SFRNTCh0cnVlLCByZXF1ZXN0SWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVucXVldWVUb2FzdChgJHtyZXZpZXcubmFtZX0ncyByZXZpZXcgaGFzIGJlZW4gc2F2ZWRgLCAnc3VjY2VzcycpO1xuICAgICAgICAgIHVwZGF0ZVJldmlld0hUTUwoZmFsc2UsIHJlcXVlc3RJZCwgcmV2aWV3KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKCdvbkxpbmUnIGluIG5hdmlnYXRvcikge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBzaG93Q29ubmVjdGlvblN0YXR1cyk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29mZmxpbmUnLCBzaG93Q29ubmVjdGlvblN0YXR1cyk7XG4gICAgc2hvd0Nvbm5lY3Rpb25TdGF0dXMoKTtcbiAgfVxuXG4gIGNvbnN0IHRvYXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvYXN0Jyk7XG59KTtcblxuLyoqXG4gKiBJbml0aWFsaXplIGxlYWZsZXQgbWFwXG4gKi9cbmNvbnN0IGluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgY29uc3QgTUFQQk9YX0FQSV9LRVkgPSAncGsuZXlKMUlqb2lZVzVsWlhOaExYTmhiR1ZvSWl3aVlTSTZJbU5xYTJ4bVpIVndNREZvWVc0emRuQXdZV3BsTW01M2JIRWlmUS5WMTFkRE90RW5XU3dUeFktQzhtSkx3JztcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmV3TWFwID0gTC5tYXAoJ21hcCcsIHtcbiAgICAgICAgY2VudGVyOiBbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLFxuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgICAgTC50aWxlTGF5ZXIoJ2h0dHBzOi8vYXBpLnRpbGVzLm1hcGJveC5jb20vdjQve2lkfS97en0ve3h9L3t5fS5qcGc3MD9hY2Nlc3NfdG9rZW49e21hcGJveFRva2VufScsIHtcbiAgICAgICAgbWFwYm94VG9rZW46IE1BUEJPWF9BUElfS0VZLFxuICAgICAgICBtYXhab29tOiAxOCxcbiAgICAgICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJ1xuICAgICAgICAgICsgJzxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgJ1xuICAgICAgICAgICsgJ0ltYWdlcnkgwqkgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm1hcGJveC5jb20vXCI+TWFwYm94PC9hPicsXG4gICAgICAgIGlkOiAnbWFwYm94LnN0cmVldHMnLFxuICAgICAgfSkuYWRkVG8obmV3TWFwKTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5uZXdNYXApO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiogVXBkYXRlIGFyaWEtaGlkZGVuIHZhbHVlcyBvZiB0aGUgdmlzaWJsZSBhbmQgYWNjZXNzaWJsZSByZXN0YXVyYW50IGNvbnRhaW5lcnNcbiovXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICBpZiAod2luZG93Lm1hdGNoTWVkaWEpIHtcbiAgICBjb25zdCBuZXh0TWF0Y2hlc01lZGlhUXVlcnkgPSB3aW5kb3cubWF0Y2hNZWRpYShtZWRpYVF1ZXJ5KS5tYXRjaGVzO1xuICAgIGlmIChuZXh0TWF0Y2hlc01lZGlhUXVlcnkgIT09IG1hdGNoZXNNZWRpYVF1ZXJ5KSB7IC8vIG9ubHkgdXBkYXRlIGFyaWEgd2hlbiBsYXlvdXQgY2hhbmdlc1xuICAgICAgbWF0Y2hlc01lZGlhUXVlcnkgPSBuZXh0TWF0Y2hlc01lZGlhUXVlcnk7XG4gICAgICB1cGRhdGVSZXN0YXVyYW50Q29udGFpbmVyQXJpYSgpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8qKlxuKiBTZXQgYXJpYS1oaWRkZW4gdmFsdWVzIGZvciB2aXNpYmxlIGFuZCByZWd1bGFyIHJlc3RhdXJhbnQgY29udGFpbmVyc1xuKiBBY2Nlc3NpYmxlIHJlc3RhdXJhbnQgY29udGFpbmVyIGlzIG9mZiBzY3JlZW5cbiogSXQgaXMgcmVxdWlyZWQgdG8gbWFpbnRhaW4gc2NyZWVuIHJlYWRpbmcgb3JkZXIgd2hlbiB0aGUgbGF5b3V0IHNoaWZ0c1xuKi9cbmNvbnN0IHVwZGF0ZVJlc3RhdXJhbnRDb250YWluZXJBcmlhID0gKCkgPT4ge1xuICBjb25zdCByZXN0YXVyYW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY29udGFpbmVyJyk7XG4gIGNvbnN0IGFjY2Vzc2libGVSZXN0YXVyYW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY2Vzc2libGUtcmVzdGF1cmFudC1jb250YWluZXInKTtcbiAgaWYgKG1hdGNoZXNNZWRpYVF1ZXJ5KSB7IC8vIGxhcmdlciBsYXlvdXQsIHNjcmVlbiByZWFkaW5nIG9yZGVyIG9mZlxuICAgIHJlc3RhdXJhbnRDb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICdmYWxzZScpO1xuICB9IGVsc2UgeyAvLyB1c2UgcmVndWxhciByZWFkaW5nIG9yZGVyXG4gICAgcmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG4gICAgYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gIH1cbn07XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5jb25zdCBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgaWQgPSBnZXRVcmxQYXJhbSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBjb25zdCBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLXNwaW5uZXInKS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tZXJyb3InKS5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLXNwaW5uZXInKS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWVycm9yJykuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmZXRjaFJldmlld3MoaWQpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1zcGlubmVyJykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyYXAtbWFpbi1jb250ZW50JykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgfSk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MICs9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBwaWN0dXJlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtcGljdHVyZScpO1xuXG4gIGNvbnN0IHNvdXJjZUxhcmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIHNvdXJjZUxhcmdlLm1lZGlhID0gJyhtaW4td2lkdGg6IDgwMHB4KSc7XG4gIHNvdXJjZUxhcmdlLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB7IHNpemU6ICdsYXJnZScsIHdpZGU6IHRydWUgfSk7XG4gIHNvdXJjZUxhcmdlLnR5cGUgPSAnaW1hZ2UvanBlZyc7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoc291cmNlTGFyZ2UpO1xuXG4gIGNvbnN0IHNvdXJjZU1lZGl1bSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBzb3VyY2VNZWRpdW0ubWVkaWEgPSAnKG1pbi13aWR0aDogNjAwcHgpJztcbiAgc291cmNlTWVkaXVtLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB7IHNpemU6ICdtZWRpdW0nIH0pO1xuICBzb3VyY2VNZWRpdW0udHlwZSA9ICdpbWFnZS9qcGVnJztcbiAgcGljdHVyZS5hcHBlbmRDaGlsZChzb3VyY2VNZWRpdW0pO1xuXG4gIGNvbnN0IHNvdXJjZVNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIHNvdXJjZVNtYWxsLnNyY3NldCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB7IHNpemU6ICdzbWFsbCcgfSk7XG4gIHNvdXJjZVNtYWxsLnR5cGUgPSAnaW1hZ2UvanBlZyc7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoc291cmNlU21hbGwpO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIC8vIHNldCBkZWZhdWx0IHNpemUgaW4gY2FzZSBwaWN0dXJlIGVsZW1lbnQgaXMgbm90IHN1cHBvcnRlZFxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGltYWdlLmFsdCA9IHJlc3RhdXJhbnQuYWx0O1xuICBwaWN0dXJlLmFwcGVuZENoaWxkKGltYWdlKTtcblxuICBjb25zdCBhY2Nlc3NpYmxlUmVzdGF1cmFudEltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY2Vzc2libGUtcmVzdGF1cmFudC1pbWcnKTtcbiAgYWNjZXNzaWJsZVJlc3RhdXJhbnRJbWFnZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCByZXN0YXVyYW50LmFsdCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSBgQ3Vpc2luZTogJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX1gO1xuXG4gIGNvbnN0IGFjY2Vzc2libGVSZXN0YXVyYW50Q3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2Nlc3NpYmxlLXJlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBhY2Nlc3NpYmxlUmVzdGF1cmFudEN1aXNpbmUuaW5uZXJIVE1MID0gYEN1aXNpbmU6ICR7cmVzdGF1cmFudC5jdWlzaW5lX3R5cGV9YDtcblxuICBjb25zdCBhZGRSZXZpZXdCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXJldmlldy1idXR0b24nKTtcbiAgYWRkUmV2aWV3QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGBBZGQgYSByZXZpZXcgZm9yICR7cmVzdGF1cmFudC5uYW1lfWApO1xuICBhZGRSZXZpZXdCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuXG4gIGNvbnN0IGFkZFJldmlld092ZXJsYXlIZWFkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1yZXZpZXctb3ZlcmxheS1oZWFkaW5nJyk7XG4gIGFkZFJldmlld092ZXJsYXlIZWFkaW5nLmlubmVySFRNTCA9IGBBZGQgcmV2aWV3IGZvciAke3Jlc3RhdXJhbnQubmFtZX1gO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cblxuICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwocmVzdGF1cmFudCwgJ2lzX2Zhdm9yaXRlJykpIHtcbiAgICBmaWxsTWFya0FzRmF2b3VyaXRlSFRNTCgpO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAoY29uc3Qga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvcGVyYXRpbmdIb3Vycywga2V5KSkge1xuICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gICAgfVxuICB9XG59O1xuXG5jb25zdCBtYXJrUmVzdGF1cmFudEFzRmF2b3VyaXRlID0gKGJ1dHRvbikgPT4ge1xuICBjb25zdCBpY29uID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ2knKTtcbiAgY29uc3QgdGV4dCA9IGJ1dHRvbi5xdWVyeVNlbGVjdG9yKCdzcGFuJyk7XG4gIHRleHQuaW5uZXJIVE1MID0gJ1VubWFyayByZXN0YXVyYW50IGFzIGZhdm91cml0ZSc7XG4gIGljb24uY2xhc3NMaXN0LmFkZCgnZmFzJywgJ21hcmtlZCcpO1xuICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhcicsICd1bm1hcmtlZCcpO1xuICBpY29uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdSZXN0YXVyYW50IGlzIGN1cnJlbnRseSBtYXJrZWQgYXMgZmF2b3VyaXRlJyk7XG59O1xuXG5jb25zdCB1bm1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUgPSAoYnV0dG9uKSA9PiB7XG4gIGNvbnN0IGljb24gPSBidXR0b24ucXVlcnlTZWxlY3RvcignaScpO1xuICBjb25zdCB0ZXh0ID0gYnV0dG9uLnF1ZXJ5U2VsZWN0b3IoJ3NwYW4nKTtcbiAgdGV4dC5pbm5lckhUTUwgPSAnTWFyayByZXN0YXVyYW50IGFzIGZhdm91cml0ZSc7XG4gIGljb24uY2xhc3NMaXN0LmFkZCgnZmFyJywgJ3VubWFya2VkJyk7XG4gIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmFzJywgJ21hcmtlZCcpO1xuICBpY29uLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdSZXN0YXVyYW50IGlzIG5vdCBjdXJyZW50bHkgbWFya2VkIGFzIGZhdm91cml0ZScpO1xufTtcblxuLyoqXG4gKiBTZXQgc3RhdGUgYW5kIHRleHQgZm9yIG1hcmsgYXMgZmF2b3VyaXRlIGJ1dHRvbi5cbiAqL1xuY29uc3QgZmlsbE1hcmtBc0Zhdm91cml0ZUhUTUwgPSAoaXNGYXZvdXJpdGUgPSBzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpID0+IHtcbiAgY29uc3QgZmF2b3VyaXRlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcmstYXMtZmF2b3VyaXRlJyk7XG4gIGlmIChzdHJpbmdUb0Jvb2xlYW4oaXNGYXZvdXJpdGUpKSB7XG4gICAgbWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZShmYXZvdXJpdGVCdXR0b24pO1xuICB9IGVsc2Uge1xuICAgIHVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZShmYXZvdXJpdGVCdXR0b24pO1xuICB9XG59O1xuXG4vKipcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZmV0Y2hSZXZpZXdzID0gKGlkKSA9PiB7XG4gIERCSGVscGVyLmZldGNoUmV2aWV3c0J5UmVzdGF1cmFudElkKGlkLCAoZXJyb3IsIHJldmlld3MpID0+IHtcbiAgICBzZWxmLnJldmlld3MgPSByZXZpZXdzO1xuICAgIGlmICghcmV2aWV3cykge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGZpbGxSZXZpZXdzSFRNTCgpO1xuICAgIERCSGVscGVyLmdldE91dGJveFJldmlld3MoaWQsIChlcnJvciwgb3V0Ym94UmV2aWV3cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGYub3V0Ym94UmV2aWV3cyA9IG91dGJveFJldmlld3M7XG4gICAgICAgIGZpbGxTZW5kaW5nUmV2aWV3c0hUTUwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJldmlld3MpID0+IHtcbiAgaWYgKCFyZXZpZXdzIHx8IHJldmlld3MubGVuZ3RoID09PSAwKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHJldmlld3MuZm9yRWFjaCgocmV2aWV3KSA9PiB7XG4gICAgdWwuaW5zZXJ0QmVmb3JlKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSwgdWwuZmlyc3RDaGlsZCk7XG4gIH0pO1xufTtcblxuY29uc3QgZmlsbFNlbmRpbmdSZXZpZXdzSFRNTCA9IChvdXRib3hSZXZpZXdzID0gc2VsZi5vdXRib3hSZXZpZXdzKSA9PiB7XG4gIGlmICghb3V0Ym94UmV2aWV3cyB8fCBvdXRib3hSZXZpZXdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICBvdXRib3hSZXZpZXdzLmZvckVhY2goKG91dGJveFJldmlldykgPT4ge1xuICAgIGNvbnN0IHsgcmVxdWVzdF9pZCwgLi4ucmV2aWV3IH0gPSBvdXRib3hSZXZpZXc7XG4gICAgdWwuaW5zZXJ0QmVmb3JlKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3LCB0cnVlLCByZXF1ZXN0X2lkKSwgdWwuZmlyc3RDaGlsZCk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY29uc3QgY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcsIHNlbmRpbmcsIHJlcXVlc3RJZCkgPT4ge1xuICBjb25zdCBhcnRpY2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYXJ0aWNsZScpO1xuICBhcnRpY2xlLmNsYXNzTmFtZSA9ICdyZXZpZXcnO1xuXG4gIGNvbnN0IGhlYWRlclNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gIGhlYWRlclNwYW4uY2xhc3NOYW1lID0gJ3Jldmlldy1oZWFkZXInO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIG5hbWUuY2xhc3NOYW1lID0gJ3Jldmlldy1uYW1lJztcbiAgaGVhZGVyU3Bhbi5hcHBlbmRDaGlsZChuYW1lKTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuXG4gIGlmIChzZW5kaW5nKSB7XG4gICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcbiAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhcicsICdmYS1jbG9jaycpO1xuICAgIGNvbnN0IGxvYWRpbmdUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgIGxvYWRpbmdUZXh0LmlubmVySFRNTCA9ICdTZW5kaW5nJztcbiAgICBkYXRlLmFwcGVuZENoaWxkKGljb24pO1xuICAgIGRhdGUuYXBwZW5kQ2hpbGQobG9hZGluZ1RleHQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGRhdGVUZXh0ID0gZm9ybWF0RGF0ZShuZXcgRGF0ZShyZXZpZXcudXBkYXRlZEF0KSk7XG4gICAgZGF0ZS5pbm5lckhUTUwgPSBkYXRlVGV4dDtcbiAgfVxuXG4gIGRhdGUuY2xhc3NOYW1lID0gJ3Jldmlldy1kYXRlJztcbiAgaGVhZGVyU3Bhbi5hcHBlbmRDaGlsZChkYXRlKTtcbiAgYXJ0aWNsZS5hcHBlbmRDaGlsZChoZWFkZXJTcGFuKTtcblxuICBjb25zdCBjb250ZW50U3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgY29udGVudFNwYW4uY2xhc3NOYW1lID0gJ3Jldmlldy1jb250ZW50JztcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgcmF0aW5nLmNsYXNzTmFtZSA9ICdyZXZpZXctcmF0aW5nJztcbiAgY29udGVudFNwYW4uYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb250ZW50U3Bhbi5hcHBlbmRDaGlsZChjb21tZW50cyk7XG4gIGFydGljbGUuYXBwZW5kQ2hpbGQoY29udGVudFNwYW4pO1xuXG4gIGlmIChzZW5kaW5nKSB7XG4gICAgYXJ0aWNsZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCByZXF1ZXN0SWQpO1xuICAgIGFydGljbGUuc2V0QXR0cmlidXRlKCdhcmlhLWJ1c3knLCAndHJ1ZScpO1xuICAgIGFydGljbGUuY2xhc3NMaXN0LmFkZCgnc2VuZGluZycpO1xuICB9XG5cbiAgcmV0dXJuIGFydGljbGU7XG59O1xuXG5jb25zdCB1cGRhdGVSZXZpZXdIVE1MID0gKGVycm9yLCByZXF1ZXN0SWQsIHJldmlldykgPT4ge1xuICBjb25zdCByZXZpZXdFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtaWQ9XCIke3JlcXVlc3RJZH1cIl1gKTtcbiAgaWYgKGVycm9yKSB7XG4gICAgaWYgKHJldmlld0VsZW1lbnQpIHsgLy8gZm9yIGVycm9yLCBubyBuZWVkIHRvIGFkZCB0byBVSSBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICBjb25zdCBkYXRlID0gcmV2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucmV2aWV3LWRhdGUnKTtcbiAgICAgIGRhdGUuaW5uZXJIVE1MID0gJyc7XG4gICAgICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xuICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYXMnLCAnZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUnKTtcbiAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgIGVycm9yVGV4dC5pbm5lckhUTUwgPSAnU2VuZGluZyBmYWlsZWQnO1xuICAgICAgZGF0ZS5hcHBlbmRDaGlsZChpY29uKTtcbiAgICAgIGRhdGUuYXBwZW5kQ2hpbGQoZXJyb3JUZXh0KTtcbiAgICAgIGRhdGUuY2xhc3NMaXN0LmFkZCgnZXJyb3InKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gICAgaWYgKHVsICYmIHNlbGYucmVzdGF1cmFudCkgeyAvLyBvbmx5IHVwZGF0ZSBpZiB0aGUgcmVzdGF1cmFudCBpcyBsb2FkZWRcbiAgICAgIGlmIChyZXZpZXdFbGVtZW50KSB7XG4gICAgICAgIHJldmlld0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnc2VuZGluZycpO1xuICAgICAgICBjb25zdCBkYXRlID0gcmV2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucmV2aWV3LWRhdGUnKTtcbiAgICAgICAgY29uc3QgZGF0ZVRleHQgPSBmb3JtYXREYXRlKG5ldyBEYXRlKHJldmlldy51cGRhdGVkQXQpKTtcbiAgICAgICAgZGF0ZS5pbm5lckhUTUwgPSBkYXRlVGV4dDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNyZWF0ZVJldmlld0hUTUwocmV2aWV3LCBmYWxzZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmNvbnN0IGZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuY29uc3QgZ2V0VXJsUGFyYW0gPSAobmFtZSwgdXJsKSA9PiB7XG4gIHVybCA9IHVybCB8fCB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKTtcblxuXG4gIGNvbnN0IHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cykgcmV0dXJuIG51bGw7XG4gIGlmICghcmVzdWx0c1syXSkgcmV0dXJuICcnO1xuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufTtcblxuY29uc3Qgc2V0TWFya0FzRmF2b3VyaXRlRmV0Y2hpbmdTdGF0ZSA9IChidXR0b24sIHNwaW5uZXIpID0+IHtcbiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1idXN5JywgJ3RydWUnKTtcbiAgc3Bpbm5lci5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG59O1xuXG5jb25zdCByZW1vdmVNYXJrQXNGYXZvdXJpdGVGZXRjaGluZ1N0YXRlID0gKGJ1dHRvbiwgc3Bpbm5lcikgPT4ge1xuICBidXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWJ1c3knLCAnZmFsc2UnKTtcbiAgc3Bpbm5lci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG59O1xuXG5jb25zdCB0b2dnbGVSZXN0YXVyYW50QXNGYXZvdXJpdGUgPSAoKSA9PiB7XG4gIGNvbnN0IGlzRmF2b3VyaXRlID0gc3RyaW5nVG9Cb29sZWFuKHNlbGYucmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gIGNvbnN0IG5ld0lzRmF2b3VyaXRlID0gKCFpc0Zhdm91cml0ZSkgJiYgaXNGYXZvdXJpdGUgIT09ICdmYWxzZSc7XG4gIGNvbnN0IHJlc3RhdXJhbnRJZCA9IHNlbGYucmVzdGF1cmFudC5pZDtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcmstYXMtZmF2b3VyaXRlJyk7XG4gIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmF2b3VyaXRlLXNwaW5uZXInKTtcbiAgbGV0IGZhaWxlZFVwZGF0ZUNhbGxiYWNrO1xuICBsZXQgc3VjY2Vzc01lc3NhZ2U7XG4gIGxldCBlcnJvck1lc3NhZ2U7XG4gIGlmIChuZXdJc0Zhdm91cml0ZSkge1xuICAgIG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoYnV0dG9uKTtcbiAgICBmYWlsZWRVcGRhdGVDYWxsYmFjayA9IHVubWFya1Jlc3RhdXJhbnRBc0Zhdm91cml0ZTtcbiAgICBzdWNjZXNzTWVzc2FnZSA9ICdSZXN0YXVyYW50IGhhcyBiZWVuIG1hcmtlZCBhcyBmYXZvdXJpdGUnO1xuICAgIGVycm9yTWVzc2FnZSA9ICdBbiBlcnJvciBvY2N1cnJlZCBtYXJraW5nIHJlc3RhdXJhbnQgYXMgZmF2b3VyaXRlJztcbiAgfSBlbHNlIHtcbiAgICB1bm1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGUoYnV0dG9uKTtcbiAgICBmYWlsZWRVcGRhdGVDYWxsYmFjayA9IG1hcmtSZXN0YXVyYW50QXNGYXZvdXJpdGU7XG4gICAgc3VjY2Vzc01lc3NhZ2UgPSAnUmVzdGF1cmFudCBoYXMgYmVlbiB1bm1hcmtlZCBhcyBmYXZvdXJpdGUnO1xuICAgIGVycm9yTWVzc2FnZSA9ICdBbiBlcnJvciBvY2N1cnJlZCB1bm1hcmtpbmcgcmVzdGF1cmFudCBhcyBmYXZvdXJpdGUnO1xuICB9XG4gIHNldE1hcmtBc0Zhdm91cml0ZUZldGNoaW5nU3RhdGUoYnV0dG9uLCBzcGlubmVyKTtcbiAgREJIZWxwZXIuc2V0UmVzdGF1cmFudEZhdm91cml0ZVN0YXR1cyhyZXN0YXVyYW50SWQsIG5ld0lzRmF2b3VyaXRlLCAoZXJyb3IsIHVwZGF0ZWRSZXN0YXVyYW50KSA9PiB7XG4gICAgcmVtb3ZlTWFya0FzRmF2b3VyaXRlRmV0Y2hpbmdTdGF0ZShidXR0b24sIHNwaW5uZXIpO1xuICAgIGlmICghdXBkYXRlZFJlc3RhdXJhbnQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgZmFpbGVkVXBkYXRlQ2FsbGJhY2soYnV0dG9uKTtcbiAgICAgIGVucXVldWVUb2FzdChlcnJvck1lc3NhZ2UsICdlcnJvcicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZWxmLnJlc3RhdXJhbnQgPSB1cGRhdGVkUmVzdGF1cmFudDtcbiAgICBlbnF1ZXVlVG9hc3Qoc3VjY2Vzc01lc3NhZ2UsICdzdWNjZXNzJyk7XG4gIH0pO1xufTtcblxuZnVuY3Rpb24gc2hvd0Nvbm5lY3Rpb25TdGF0dXMoKSB7XG4gIGNvbnN0IGNvbm5lY3Rpb25TdGF0dXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29ubmVjdGlvblN0YXR1cycpO1xuXG4gIGlmIChuYXZpZ2F0b3Iub25MaW5lICYmICFwcmV2aW91c2x5Q29ubmVjdGVkKSB7IC8vIHVzZXIgY2FtZSBiYWNrIG9ubGluZVxuICAgIGVucXVldWVUb2FzdCgnWW91IGFyZSBiYWNrIG9ubGluZScsICdzdWNjZXNzJyk7XG4gIH0gZWxzZSBpZiAoIW5hdmlnYXRvci5vbkxpbmUgJiYgcHJldmlvdXNseUNvbm5lY3RlZCkgeyAvLyB1c2VyIHdlbnQgb2ZmbGluZVxuICAgIGVucXVldWVUb2FzdCgnWW91IGFyZSBvZmZsaW5lJywgJ2Vycm9yJyk7XG4gIH1cblxuICBwcmV2aW91c2x5Q29ubmVjdGVkID0gbmF2aWdhdG9yLm9uTGluZTtcbn1cbiIsIi8qKiAqKioqIG1vZGFsICoqKioqKiAqL1xuXG5sZXQgcHJldmlvdXNseUZvY3VzZWRFbGVtZW50O1xuXG5mdW5jdGlvbiBvcGVuTW9kYWwoKSB7XG4gIHByZXZpb3VzbHlGb2N1c2VkRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7XG4gIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3ZlcmxheScpO1xuICBjb25zdCBpbnRlcmFjdGl2ZUVsZW1lbnRzID0gb3ZlcmxheS5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24sIGlucHV0LCB0ZXh0YXJlYScpO1xuICBvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdoYXMtb3Blbi1tb2RhbCcpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdHJhcFRhYktleSk7XG4gIC8vIGZvY3VzIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBvdmVybGF5LiB0aW1lb3V0IGlzIG5lZWRlZCBiZWNhdXNlIG9mIENTUyB0cmFuc2l0aW9uXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIGludGVyYWN0aXZlRWxlbWVudHNbMF0uZm9jdXMoKTtcbiAgfSwgMTAwKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbCgpIHtcbiAgY2xlYXJGb3JtRXJyb3JzKCk7XG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vdmVybGF5JykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2hhcy1vcGVuLW1vZGFsJyk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0cmFwVGFiS2V5KTtcbiAgaWYgKHByZXZpb3VzbHlGb2N1c2VkRWxlbWVudCkge1xuICAgIHByZXZpb3VzbHlGb2N1c2VkRWxlbWVudC5mb2N1cygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyYXBUYWJLZXkoZXZlbnQpIHtcbiAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vdmVybGF5Jyk7XG4gIGNvbnN0IGludGVyYWN0aXZlRWxlbWVudHMgPSBvdmVybGF5LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbiwgaW5wdXQnKTtcbiAgY29uc3QgZmlyc3RFbGVtZW50ID0gaW50ZXJhY3RpdmVFbGVtZW50c1swXTtcbiAgY29uc3QgbGFzdEVsZW1lbnQgPSBpbnRlcmFjdGl2ZUVsZW1lbnRzW2ludGVyYWN0aXZlRWxlbWVudHMubGVuZ3RoIC0gMV07XG4gIGlmIChldmVudC5rZXkgJiYgZXZlbnQua2V5ID09PSAnVGFiJykge1xuICAgIGlmIChldmVudC5zaGlmdEtleSAmJiBldmVudC50YXJnZXQgPT09IGZpcnN0RWxlbWVudCkgeyAvLyBzaGlmdCArIHRhYlxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGxhc3RFbGVtZW50LmZvY3VzKCk7XG4gICAgfSBlbHNlIGlmICghZXZlbnQuc2hpZnRLZXkgJiYgZXZlbnQudGFyZ2V0ID09PSBsYXN0RWxlbWVudCkgeyAvLyB0YWJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBmaXJzdEVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqICoqKiogaGFuZGxlIGVycm9ycyAqKioqKiogKi9cblxuZnVuY3Rpb24gc2V0TmFtZUlucHV0RXJyb3IoKSB7XG4gIGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJyk7XG4gIGNvbnN0IG5hbWVJbnB1dEVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hbWUtZXJyb3InKTtcbiAgbmFtZUlucHV0LmNsYXNzTGlzdC5hZGQoJ2hhcy1lcnJvcicpO1xuICBuYW1lSW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWludmFsaWQnLCAndHJ1ZScpO1xuICBuYW1lSW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5JywgJ25hbWUtZXJyb3InKTtcbiAgbmFtZUlucHV0RXJyb3IuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xufVxuXG5mdW5jdGlvbiBjbGVhck5hbWVJbnB1dEVycm9yKCkge1xuICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpO1xuICBjb25zdCBuYW1lSW5wdXRFcnJvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lLWVycm9yJyk7XG4gIG5hbWVJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoYXMtZXJyb3InKTtcbiAgbmFtZUlucHV0LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1pbnZhbGlkJyk7XG4gIG5hbWVJbnB1dC5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknKTtcbiAgbmFtZUlucHV0RXJyb3IuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xufVxuXG5mdW5jdGlvbiBzZXRSYXRpbmdJbnB1dEVycm9yKCkge1xuICBjb25zdCByYXRpbmdJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRpbmcnKTtcbiAgY29uc3QgcmF0aW5nSW5wdXRFcnJvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRpbmctZXJyb3InKTtcbiAgcmF0aW5nSW5wdXQuY2xhc3NMaXN0LmFkZCgnaGFzLWVycm9yJyk7XG4gIHJhdGluZ0lucHV0LnNldEF0dHJpYnV0ZSgnYXJpYS1pbnZhbGlkJywgJ3RydWUnKTtcbiAgcmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5JywgJ3JhdGluZy1lcnJvcicpO1xuICByYXRpbmdJbnB1dEVycm9yLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbn1cblxuZnVuY3Rpb24gY2xlYXJSYXRpbmdJbnB1dEVycm9yKCkge1xuICBjb25zdCByYXRpbmdJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRpbmcnKTtcbiAgY29uc3QgcmF0aW5nSW5wdXRFcnJvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRpbmctZXJyb3InKTtcbiAgcmF0aW5nSW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnaGFzLWVycm9yJyk7XG4gIHJhdGluZ0lucHV0LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1pbnZhbGlkJyk7XG4gIHJhdGluZ0lucHV0LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScpO1xuICByYXRpbmdJbnB1dEVycm9yLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbn1cblxuZnVuY3Rpb24gc2V0Q29tbWVudElucHV0RXJyb3IoKSB7XG4gIGNvbnN0IGNvbW1lbnRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50cycpO1xuICBjb25zdCBjb21tZW50SW5wdXRFcnJvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50cy1lcnJvcicpO1xuICBjb21tZW50SW5wdXQuY2xhc3NMaXN0LmFkZCgnaGFzLWVycm9yJyk7XG4gIGNvbW1lbnRJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaW52YWxpZCcsICd0cnVlJyk7XG4gIGNvbW1lbnRJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknLCAnY29tbWVudHMtZXJyb3InKTtcbiAgY29tbWVudElucHV0RXJyb3IuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xufVxuXG5mdW5jdGlvbiBjbGVhckNvbW1lbnRJbnB1dEVycm9yKCkge1xuICBjb25zdCBjb21tZW50SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tbWVudHMnKTtcbiAgY29uc3QgY29tbWVudElucHV0RXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tbWVudHMtZXJyb3InKTtcbiAgY29tbWVudElucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hhcy1lcnJvcicpO1xuICBjb21tZW50SW5wdXQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWludmFsaWQnKTtcbiAgY29tbWVudElucHV0LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScpO1xuICBjb21tZW50SW5wdXRFcnJvci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG59XG5cbmNvbnN0IGVycm9yRnVuY3Rpb25zID0ge1xuICBuYW1lOiB7XG4gICAgc2V0RXJyb3I6IHNldE5hbWVJbnB1dEVycm9yLFxuICAgIGNsZWFyRXJyb3I6IGNsZWFyTmFtZUlucHV0RXJyb3IsXG4gIH0sXG4gIHJhdGluZzoge1xuICAgIHNldEVycm9yOiBzZXRSYXRpbmdJbnB1dEVycm9yLFxuICAgIGNsZWFyRXJyb3I6IGNsZWFyUmF0aW5nSW5wdXRFcnJvcixcbiAgfSxcbiAgY29tbWVudHM6IHtcbiAgICBzZXRFcnJvcjogc2V0Q29tbWVudElucHV0RXJyb3IsXG4gICAgY2xlYXJFcnJvcjogY2xlYXJDb21tZW50SW5wdXRFcnJvcixcbiAgfSxcbn07XG5cbi8qKiAqKioqIHZhbGlkYXRpb24gKioqKioqICovXG5cbmZ1bmN0aW9uIHZhbGlkYXRlSW5wdXQoaWQsIHZhbHVlKSB7XG4gIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLmNsb25lTm9kZSgpO1xuICBsZXQgaW5wdXRWYWx1ZTtcbiAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICBpbnB1dFZhbHVlID0gdmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgaW5wdXRWYWx1ZSA9IGlucHV0LnZhbHVlO1xuICB9XG4gIGlucHV0VmFsdWUgPSBpZCA9PT0gJ3JhdGluZycgPyBOdW1iZXIucGFyc2VJbnQoaW5wdXRWYWx1ZSwgMTApIDogaW5wdXRWYWx1ZTtcbiAgaWYgKGlucHV0VmFsdWUpIHtcbiAgICBlcnJvckZ1bmN0aW9uc1tpZF0uY2xlYXJFcnJvcigpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShlcnJvckZ1bmN0aW9uc1tpZF0uc2V0RXJyb3IpO1xuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQWxsSW5wdXRzKCkge1xuICBsZXQgZXJyb3IgPSBmYWxzZTtcbiAgY29uc3QgaW5wdXRJZHMgPSBbJ25hbWUnLCAncmF0aW5nJywgJ2NvbW1lbnRzJ107XG4gIGNvbnN0IGludmFsaWRJbnB1dHMgPSBbXTtcbiAgaW5wdXRJZHMuZm9yRWFjaCgoaWQpID0+IHtcbiAgICBjb25zdCBpbnB1dFZhbGlkID0gdmFsaWRhdGVJbnB1dChpZCk7XG4gICAgaWYgKCFpbnB1dFZhbGlkKSB7XG4gICAgICBpbnZhbGlkSW5wdXRzLnB1c2goaWQpO1xuICAgICAgZXJyb3IgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiB7IGVycm9yLCBpbnZhbGlkSW5wdXRzIH07XG59XG5cbi8qKiAqKioqIGhhbmRsZSBldmVudHMgKioqKioqICovXG5cbmZ1bmN0aW9uIGhhbmRsZVJhbmdlQ2hhbmdlKGV2ZW50KSB7XG4gIGNvbnN0IHJhdGluZ1ZhbHVlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJhdGluZy12YWx1ZScpO1xuICByYXRpbmdWYWx1ZS5pbm5lckhUTUwgPSBgJHtldmVudC50YXJnZXQudmFsdWV9LzVgO1xuICB2YWxpZGF0ZUlucHV0KGV2ZW50LnRhcmdldC5uYW1lLCBldmVudC50YXJnZXQudmFsdWUpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVJbnB1dEtleVVwKGV2ZW50KSB7XG4gIGlmICghKGV2ZW50LmtleSAmJiBldmVudC5rZXkgPT09ICdUYWInKSkge1xuICAgIC8vIHdoZW4gdGFiIGlzIHVzZWQsIGFsbG93IHRoZSBvbmJsdXIgaGFuZGxlciB0byBwZXJmb3JtIHZhbGlkYXRpb25cbiAgICAvLyB3aGVuIHRoZSB0YWIga2V5IGlzIHByZXNzZWQsIGZvY3VzIGlzIGFscmVhZHkgb24gdGhlIG5leHQgaW5wdXQgd2hlbiB0aGUgZXZlbnQgZmlyZXNcbiAgICAvLyBzbyB0aGUgd3JvbmcgaW5wdXQgaXMgdmFsaWRhdGVkXG4gICAgdmFsaWRhdGVJbnB1dChldmVudC50YXJnZXQubmFtZSwgZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVJbnB1dEJsdXIoZXZlbnQpIHtcbiAgdmFsaWRhdGVJbnB1dChldmVudC50YXJnZXQubmFtZSwgZXZlbnQudGFyZ2V0LnZhbHVlKTtcbn1cblxuZnVuY3Rpb24gZ2V0Rm9ybUlucHV0VmFsdWVzKCkge1xuICBjb25zdCBpbnB1dElkcyA9IFsnbmFtZScsICdyYXRpbmcnLCAnY29tbWVudHMnXTtcbiAgY29uc3QgdmFsdWVzID0ge307XG4gIGlucHV0SWRzLmZvckVhY2goKGlkKSA9PiB7XG4gICAgdmFsdWVzW2lkXSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS52YWx1ZTtcbiAgfSk7XG4gIHJldHVybiB2YWx1ZXM7XG59XG5cbmZ1bmN0aW9uIGNsZWFyRm9ybSgpIHtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hbWUnKS52YWx1ZSA9ICcnO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0aW5nJykudmFsdWUgPSAnMCc7XG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yYXRpbmctdmFsdWUnKS5pbm5lckhUTUwgPSAnMC81JztcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzJykudmFsdWUgPSAnJztcbn1cblxuZnVuY3Rpb24gY2xlYXJGb3JtRXJyb3JzKCkge1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZS1lcnJvcicpLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZy1lcnJvcicpLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzLWVycm9yJykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXJldmlldy1mb3JtLWVycm9yJykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXJldmlldy1mb3JtLWVycm9yJykuaW5uZXJIVE1MID0gJyc7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJykuY2xhc3NMaXN0LnJlbW92ZSgnaGFzLWVycm9yJyk7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRpbmcnKS5jbGFzc0xpc3QucmVtb3ZlKCdoYXMtZXJyb3InKTtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzJykuY2xhc3NMaXN0LnJlbW92ZSgnaGFzLWVycm9yJyk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZFJldmlld1N1Ym1pdCgpIHtcbiAgY29uc3QgeyBlcnJvciwgaW52YWxpZElucHV0cyB9ID0gdmFsaWRhdGVBbGxJbnB1dHMoKTtcbiAgaWYgKCFlcnJvcikge1xuICAgIGNvbnN0IHsgbmFtZSwgcmF0aW5nLCBjb21tZW50cyB9ID0gZ2V0Rm9ybUlucHV0VmFsdWVzKCk7XG4gICAgaWYgKCghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHx8ICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcikpIHtcbiAgICAgIC8vIHBlcmZvcm0gcmVndWxhciBmZXRjaCBhbmQgcmVndWxhciB1cGRhdGVzXG4gICAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXJldmlldy1zdWJtaXQnKTtcbiAgICAgIHN1Ym1pdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICBzdWJtaXRCdXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWJ1c3knLCAndHJ1ZScpO1xuICAgICAgREJIZWxwZXIuYWRkUmV2aWV3KHNlbGYucmVzdGF1cmFudC5pZCwgbmFtZSwgcmF0aW5nLCBjb21tZW50cywgKGVycm9yLCBuZXdSZXZpZXcpID0+IHtcbiAgICAgICAgc3VibWl0QnV0dG9uLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgc3VibWl0QnV0dG9uLnNldEF0dHJpYnV0ZSgnYXJpYS1idXN5JywgJ2ZhbHNlJyk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGVucXVldWVUb2FzdCgnQW4gZXJyb3Igb2NjdXJyZWQuIFBsZWFzZSB0cnkgYWdhaW4nLCAnZXJyb3InKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZW5xdWV1ZVRvYXN0KGAke25hbWV9J3MgcmV2aWV3IGhhcyBiZWVuIHNhdmVkYCwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgICAgICAgICB1bC5pbnNlcnRCZWZvcmUoY3JlYXRlUmV2aWV3SFRNTChuZXdSZXZpZXcpLCB1bC5maXJzdENoaWxkKTtcbiAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgY2xlYXJGb3JtKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByZXF1ZXN0SWQgPSBgJHtzZWxmLnJlc3RhdXJhbnQuaWR9LSR7RGF0ZS5ub3coKX1gO1xuICAgICAgY29uc3QgbmV3UmV2aWV3ID0ge1xuICAgICAgICBuYW1lLCByYXRpbmcsIGNvbW1lbnRzLCByZXN0YXVyYW50X2lkOiBzZWxmLnJlc3RhdXJhbnQuaWQsXG4gICAgICB9O1xuICAgICAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gICAgICB1bC5pbnNlcnRCZWZvcmUoY3JlYXRlUmV2aWV3SFRNTChuZXdSZXZpZXcsIHRydWUsIHJlcXVlc3RJZCksIHVsLmZpcnN0Q2hpbGQpO1xuXG4gICAgICBpZiAoKCdvbkxpbmUnIGluIG5hdmlnYXRvcikgJiYgIW5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgICAgZW5xdWV1ZVRvYXN0KCdZb3VyIHJldmlldyB3aWxsIGJlIHN1Ym1pdHRlZCB3aGVuIHlvdSBhcmUgYmFjayBvbmxpbmUnKTtcbiAgICAgIH1cblxuICAgICAgY2xvc2VNb2RhbCgpO1xuICAgICAgY2xlYXJGb3JtKCk7XG4gICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5jb250cm9sbGVyLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgdHlwZTogJ3Bvc3QtcmV2aWV3JyxcbiAgICAgICAgcmV2aWV3OiBuZXdSZXZpZXcsXG4gICAgICAgIHJlcXVlc3RJZCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBlbHNlIHsgLy8gZm9ybSBlcnJvcnMgbm90IGNsZWFyZWRcbiAgICBjb25zdCBmb3JtRXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXJldmlldy1mb3JtLWVycm9yJyk7XG4gICAgY29uc3QgZXJyb3JUZXh0ID0gYEludmFsaWQgaW5wdXQgZm9yOiAke2ludmFsaWRJbnB1dHMuam9pbignLCAnKX1gO1xuICAgIGZvcm1FcnJvci5pbm5lckhUTUwgPSBlcnJvclRleHQ7XG4gICAgZm9ybUVycm9yLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpbnZhbGlkSW5wdXRzWzBdKS5mb2N1cygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUZvcm1TdWJtaXQoZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn1cbiJdfQ==

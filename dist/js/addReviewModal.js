"use strict";

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/****** modal *******/
function openModal() {
  previouslyFocusedElement = document.activeElement;
  var overlay = document.querySelector('.overlay');
  var interactiveElements = overlay.querySelectorAll('button, input, textarea');
  overlay.classList.add('show');
  document.body.classList.add('has-open-modal');
  document.addEventListener('keydown', trapTabKey);
  setTimeout(function () {
    interactiveElements[0].focus();
  }, 100);
}

function closeModal() {
  document.querySelector('.overlay').classList.remove('show');
  document.body.classList.remove('has-open-modal');
  document.removeEventListener('keydown', trapTabKey);

  if (previouslyFocusedElement) {
    previouslyFocusedElement.focus();
  }
}

function trapTabKey(event) {
  var overlay = document.querySelector('.overlay');
  var interactiveElements = overlay.querySelectorAll('button, input');
  var TAB = 9;
  var firstElement = interactiveElements[0];
  var lastElement = interactiveElements[interactiveElements.length - 1];

  if (event.keyCode === TAB) {
    if (event.shiftKey && event.target === firstElement) {
      // shift + tab
      event.preventDefault();
      lastElement.focus();
    } else if (!event.shiftKey && event.target === lastElement) {
      // tab
      event.preventDefault();
      firstElement.focus();
    }
  }
}
/****** handle errors *******/


function setNameInputError() {
  var nameInput = document.getElementById('name');
  var nameInputError = document.getElementById('name-error');
  nameInput.classList.add('has-error');
  nameInput.setAttribute('aria-invalid', 'true');
  nameInput.setAttribute('aria-describedby', 'name-error');
  nameInputError.classList.add('show');
}

function clearNameInputError() {
  var nameInput = document.getElementById('name');
  var nameInputError = document.getElementById('name-error');
  nameInput.classList.remove('has-error');
  nameInput.removeAttribute('aria-invalid');
  nameInput.removeAttribute('aria-describedby');
  nameInputError.classList.remove('show');
}

function setRatingInputError() {
  var ratingInput = document.getElementById('rating');
  var ratingInputError = document.getElementById('rating-error');
  ratingInput.classList.add('has-error');
  ratingInput.setAttribute('aria-invalid', 'true');
  ratingInput.setAttribute('aria-describedby', 'rating-error');
  ratingInputError.classList.add('show');
}

function clearRatingInputError() {
  var ratingInput = document.getElementById('rating');
  var ratingInputError = document.getElementById('rating-error');
  ratingInput.classList.remove('has-error');
  ratingInput.removeAttribute('aria-invalid');
  ratingInput.removeAttribute('aria-describedby');
  ratingInputError.classList.remove('show');
}

function setCommentInputError() {
  var commentInput = document.getElementById('comment');
  var commentInputError = document.getElementById('comment-error');
  commentInput.classList.add('has-error');
  commentInput.setAttribute('aria-invalid', 'true');
  commentInput.setAttribute('aria-describedby', 'comment-error');
  commentInputError.classList.add('show');
}

function clearCommentInputError() {
  var commentInput = document.getElementById('comment');
  var commentInputError = document.getElementById('comment-error');
  commentInput.classList.remove('has-error');
  commentInput.removeAttribute('aria-invalid');
  commentInput.removeAttribute('aria-describedby');
  commentInputError.classList.remove('show');
}

var errorFunctions = {
  name: {
    setError: setNameInputError,
    clearError: clearNameInputError
  },
  rating: {
    setError: setRatingInputError,
    clearError: clearRatingInputError
  },
  comment: {
    setError: setCommentInputError,
    clearError: clearCommentInputError
  }
};
/****** validation *******/

function validateInput(id) {
  var input = document.getElementById(id).cloneNode();
  var value = id === 'rating' ? Number.parseInt(input.value, 10) : input.value;

  if (value) {
    errorFunctions[id].clearError();
    return true;
  } else {
    errorFunctions[id].setError();
    return false;
  }
}

function validateAllInputs() {
  var allInputsValid = true;
  var inputIds = ['name', 'rating', 'comment'];
  inputIds.forEach(function (id) {
    var inputValid = validateInput(id);
    allInputsValid = allInputsValid && inputValid;
  });
  return allInputsValid;
}
/****** handle events *******/


function handleRangeChange(event) {
  var ratingValue = document.querySelector('.rating-value');
  ratingValue.innerHTML = "".concat(event.target.value, ".0");
}

function handleNameInputBlur() {
  validateInput('name');
}

function handleRatingInputBlur() {
  validateInput('rating');
}

function handleCommentInputBlur() {
  validateInput('comment');
}

function getFormInputValues() {
  var inputIds = ['name', 'rating', 'comment'];
  var values = {};
  inputIds.forEach(function (id) {
    values[id] = document.getElementById(id).value;
  });
  return values;
}

function clearForm() {
  document.getElementById('name').value = '';
  document.getElementById('rating').value = '0';
  document.querySelector('.rating-value').innerHTML = '0.0';
  document.getElementById('comment').value = '';
}

function handleAddReviewSubmit() {
  var allInputsValid = validateAllInputs();

  if (allInputsValid) {
    var values = getFormInputValues();
    console.log(_objectSpread({}, values, {
      restaurant_id: self.restaurant.id
    }));
    closeModal();
    clearForm();
  }
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZFJldmlld01vZGFsLmpzIl0sIm5hbWVzIjpbIm9wZW5Nb2RhbCIsInByZXZpb3VzbHlGb2N1c2VkRWxlbWVudCIsImRvY3VtZW50IiwiYWN0aXZlRWxlbWVudCIsIm92ZXJsYXkiLCJxdWVyeVNlbGVjdG9yIiwiaW50ZXJhY3RpdmVFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjbGFzc0xpc3QiLCJhZGQiLCJib2R5IiwiYWRkRXZlbnRMaXN0ZW5lciIsInRyYXBUYWJLZXkiLCJzZXRUaW1lb3V0IiwiZm9jdXMiLCJjbG9zZU1vZGFsIiwicmVtb3ZlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiVEFCIiwiZmlyc3RFbGVtZW50IiwibGFzdEVsZW1lbnQiLCJsZW5ndGgiLCJrZXlDb2RlIiwic2hpZnRLZXkiLCJ0YXJnZXQiLCJwcmV2ZW50RGVmYXVsdCIsInNldE5hbWVJbnB1dEVycm9yIiwibmFtZUlucHV0IiwiZ2V0RWxlbWVudEJ5SWQiLCJuYW1lSW5wdXRFcnJvciIsInNldEF0dHJpYnV0ZSIsImNsZWFyTmFtZUlucHV0RXJyb3IiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRSYXRpbmdJbnB1dEVycm9yIiwicmF0aW5nSW5wdXQiLCJyYXRpbmdJbnB1dEVycm9yIiwiY2xlYXJSYXRpbmdJbnB1dEVycm9yIiwic2V0Q29tbWVudElucHV0RXJyb3IiLCJjb21tZW50SW5wdXQiLCJjb21tZW50SW5wdXRFcnJvciIsImNsZWFyQ29tbWVudElucHV0RXJyb3IiLCJlcnJvckZ1bmN0aW9ucyIsIm5hbWUiLCJzZXRFcnJvciIsImNsZWFyRXJyb3IiLCJyYXRpbmciLCJjb21tZW50IiwidmFsaWRhdGVJbnB1dCIsImlkIiwiaW5wdXQiLCJjbG9uZU5vZGUiLCJ2YWx1ZSIsIk51bWJlciIsInBhcnNlSW50IiwidmFsaWRhdGVBbGxJbnB1dHMiLCJhbGxJbnB1dHNWYWxpZCIsImlucHV0SWRzIiwiZm9yRWFjaCIsImlucHV0VmFsaWQiLCJoYW5kbGVSYW5nZUNoYW5nZSIsInJhdGluZ1ZhbHVlIiwiaW5uZXJIVE1MIiwiaGFuZGxlTmFtZUlucHV0Qmx1ciIsImhhbmRsZVJhdGluZ0lucHV0Qmx1ciIsImhhbmRsZUNvbW1lbnRJbnB1dEJsdXIiLCJnZXRGb3JtSW5wdXRWYWx1ZXMiLCJ2YWx1ZXMiLCJjbGVhckZvcm0iLCJoYW5kbGVBZGRSZXZpZXdTdWJtaXQiLCJjb25zb2xlIiwibG9nIiwicmVzdGF1cmFudF9pZCIsInNlbGYiLCJyZXN0YXVyYW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUVBLFNBQVNBLFNBQVQsR0FBcUI7QUFDbkJDLEVBQUFBLHdCQUF3QixHQUFHQyxRQUFRLENBQUNDLGFBQXBDO0FBQ0EsTUFBTUMsT0FBTyxHQUFHRixRQUFRLENBQUNHLGFBQVQsQ0FBdUIsVUFBdkIsQ0FBaEI7QUFDQSxNQUFNQyxtQkFBbUIsR0FBR0YsT0FBTyxDQUFDRyxnQkFBUixDQUF5Qix5QkFBekIsQ0FBNUI7QUFDQUgsRUFBQUEsT0FBTyxDQUFDSSxTQUFSLENBQWtCQyxHQUFsQixDQUFzQixNQUF0QjtBQUNBUCxFQUFBQSxRQUFRLENBQUNRLElBQVQsQ0FBY0YsU0FBZCxDQUF3QkMsR0FBeEIsQ0FBNEIsZ0JBQTVCO0FBQ0FQLEVBQUFBLFFBQVEsQ0FBQ1MsZ0JBQVQsQ0FBMEIsU0FBMUIsRUFBcUNDLFVBQXJDO0FBQ0FDLEVBQUFBLFVBQVUsQ0FBQyxZQUFVO0FBQUVQLElBQUFBLG1CQUFtQixDQUFDLENBQUQsQ0FBbkIsQ0FBdUJRLEtBQXZCO0FBQWlDLEdBQTlDLEVBQWdELEdBQWhELENBQVY7QUFDRDs7QUFFRCxTQUFTQyxVQUFULEdBQXNCO0FBQ3BCYixFQUFBQSxRQUFRLENBQUNHLGFBQVQsQ0FBdUIsVUFBdkIsRUFBbUNHLFNBQW5DLENBQTZDUSxNQUE3QyxDQUFvRCxNQUFwRDtBQUNBZCxFQUFBQSxRQUFRLENBQUNRLElBQVQsQ0FBY0YsU0FBZCxDQUF3QlEsTUFBeEIsQ0FBK0IsZ0JBQS9CO0FBQ0FkLEVBQUFBLFFB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Q25CbEUsRUFBQUEsUUFBUSxDQUFDMkIsY0FBVCxDQUF3QixNQUF4QixFQUFnQ3VCLEtBQWhDLEdBQXdDLEVBQXhDO0FBQ0FsRCxFQUFBQSxRQUFRLENBQUMyQixjQUFULENBQXdCLFFBQXhCLEVBQWtDdUIsS0FBbEMsR0FBMEMsR0FBMUM7QUFDQWxELEVBQUFBLFFBQVEsQ0FBQ0csYUFBVCxDQUF1QixlQUF2QixFQUF3Q3lELFNBQXhDLEdBQW9ELEtBQXBEO0FBQ0E1RCxFQUFBQSxRQUFRLENBQUMyQixjQUFULENBQXdCLFNBQXhCLEVBQW1DdUIsS0FBbkMsR0FBMkMsRUFBM0M7QUFDRDs7QUFFRCxTQUFTaUIscUJBQVQsR0FBZ0M7QUFDOUIsTUFBTWIsY0FBYyxHQUFHRCxpQkFBaUIsRUFBeEM7O0FBQ0EsTUFBSUMsY0FBSixFQUFvQjtBQUNsQixRQUFNVyxNQUFNLEdBQUdELGtCQUFrQixFQUFqQztBQUNBSSxJQUFBQSxPQUFPLENBQUNDLEdBQVIsbUJBQWlCSixNQUFqQjtBQUF5QkssTUFBQUEsYUFBYSxFQUFFQyxJQUFJLENBQUNDLFVBQUwsQ0FBZ0J6QjtBQUF4RDtBQUNBbEMsSUFBQUEsVUFBVTtBQUNWcUQsSUFBQUEsU0FBUztBQUNWO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqIG1vZGFsICoqKioqKiovXG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbCgpIHtcbiAgcHJldmlvdXNseUZvY3VzZWRFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vdmVybGF5Jyk7XG4gIGNvbnN0IGludGVyYWN0aXZlRWxlbWVudHMgPSBvdmVybGF5LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbiwgaW5wdXQsIHRleHRhcmVhJyk7XG4gIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xuICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2hhcy1vcGVuLW1vZGFsJyk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0cmFwVGFiS2V5KTtcbiAgc2V0VGltZW91dChmdW5jdGlvbigpeyBpbnRlcmFjdGl2ZUVsZW1lbnRzWzBdLmZvY3VzKCk7IH0sIDEwMCk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwoKSB7XG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vdmVybGF5JykuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xuICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2hhcy1vcGVuLW1vZGFsJyk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0cmFwVGFiS2V5KTtcbiAgaWYgKHByZXZpb3VzbHlGb2N1c2VkRWxlbWVudCkge1xuICAgIHByZXZpb3VzbHlGb2N1c2VkRWxlbWVudC5mb2N1cygpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHRyYXBUYWJLZXkoZXZlbnQpIHtcbiAgY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vdmVybGF5Jyk7XG4gIGNvbnN0IGludGVyYWN0aXZlRWxlbWVudHMgPSBvdmVybGF5LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbiwgaW5wdXQnKTtcbiAgY29uc3QgVEFCID0gOTtcbiAgY29uc3QgZmlyc3RFbGVtZW50ID0gaW50ZXJhY3RpdmVFbGVtZW50c1swXTtcbiAgY29uc3QgbGFzdEVsZW1lbnQgPSBpbnRlcmFjdGl2ZUVsZW1lbnRzW2ludGVyYWN0aXZlRWxlbWVudHMubGVuZ3RoIC0gMV07XG4gIGlmIChldmVudC5rZXlDb2RlID09PSBUQUIpIHtcbiAgICBpZiAoZXZlbnQuc2hpZnRLZXkgJiYgZXZlbnQudGFyZ2V0ID09PSBmaXJzdEVsZW1lbnQpIHsgLy8gc2hpZnQgKyB0YWJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBsYXN0RWxlbWVudC5mb2N1cygpO1xuICAgIH0gZWxzZSBpZiAoIWV2ZW50LnNoaWZ0S2V5ICYmIGV2ZW50LnRhcmdldCA9PT0gbGFzdEVsZW1lbnQpIHsgLy8gdGFiXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZmlyc3RFbGVtZW50LmZvY3VzKCk7XG4gICAgfVxuICB9XG59XG5cbi8qKioqKiogaGFuZGxlIGVycm9ycyAqKioqKioqL1xuXG5mdW5jdGlvbiBzZXROYW1lSW5wdXRFcnJvcigpIHtcbiAgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hbWUnKTtcbiAgY29uc3QgbmFtZUlucHV0RXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZS1lcnJvcicpO1xuICBuYW1lSW5wdXQuY2xhc3NMaXN0LmFkZCgnaGFzLWVycm9yJyk7XG4gIG5hbWVJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaW52YWxpZCcsICd0cnVlJyk7XG4gIG5hbWVJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknLCAnbmFtZS1lcnJvcicpO1xuICBuYW1lSW5wdXRFcnJvci5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG59XG5cbmZ1bmN0aW9uIGNsZWFyTmFtZUlucHV0RXJyb3IoKSB7XG4gIGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJyk7XG4gIGNvbnN0IG5hbWVJbnB1dEVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hbWUtZXJyb3InKTtcbiAgbmFtZUlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hhcy1lcnJvcicpO1xuICBuYW1lSW5wdXQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWludmFsaWQnKTtcbiAgbmFtZUlucHV0LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScpO1xuICBuYW1lSW5wdXRFcnJvci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG59XG5cbmZ1bmN0aW9uIHNldFJhdGluZ0lucHV0RXJyb3IoKSB7XG4gIGNvbnN0IHJhdGluZ0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZycpO1xuICBjb25zdCByYXRpbmdJbnB1dEVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZy1lcnJvcicpO1xuICByYXRpbmdJbnB1dC5jbGFzc0xpc3QuYWRkKCdoYXMtZXJyb3InKTtcbiAgcmF0aW5nSW5wdXQuc2V0QXR0cmlidXRlKCdhcmlhLWludmFsaWQnLCAndHJ1ZScpO1xuICByYXRpbmdJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknLCAncmF0aW5nLWVycm9yJyk7XG4gIHJhdGluZ0lucHV0RXJyb3IuY2xhc3NMaXN0LmFkZCgnc2hvdycpO1xufVxuXG5mdW5jdGlvbiBjbGVhclJhdGluZ0lucHV0RXJyb3IoKSB7XG4gIGNvbnN0IHJhdGluZ0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZycpO1xuICBjb25zdCByYXRpbmdJbnB1dEVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZy1lcnJvcicpO1xuICByYXRpbmdJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoYXMtZXJyb3InKTtcbiAgcmF0aW5nSW5wdXQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWludmFsaWQnKTtcbiAgcmF0aW5nSW5wdXQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWRlc2NyaWJlZGJ5Jyk7XG4gIHJhdGluZ0lucHV0RXJyb3IuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdycpO1xufVxuXG5mdW5jdGlvbiBzZXRDb21tZW50SW5wdXRFcnJvcigpIHtcbiAgY29uc3QgY29tbWVudElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnQnKTtcbiAgY29uc3QgY29tbWVudElucHV0RXJyb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tbWVudC1lcnJvcicpO1xuICBjb21tZW50SW5wdXQuY2xhc3NMaXN0LmFkZCgnaGFzLWVycm9yJyk7XG4gIGNvbW1lbnRJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtaW52YWxpZCcsICd0cnVlJyk7XG4gIGNvbW1lbnRJbnB1dC5zZXRBdHRyaWJ1dGUoJ2FyaWEtZGVzY3JpYmVkYnknLCAnY29tbWVudC1lcnJvcicpO1xuICBjb21tZW50SW5wdXRFcnJvci5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XG59XG5cbmZ1bmN0aW9uIGNsZWFyQ29tbWVudElucHV0RXJyb3IoKSB7XG4gIGNvbnN0IGNvbW1lbnRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50Jyk7XG4gIGNvbnN0IGNvbW1lbnRJbnB1dEVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnQtZXJyb3InKTtcbiAgY29tbWVudElucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hhcy1lcnJvcicpO1xuICBjb21tZW50SW5wdXQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWludmFsaWQnKTtcbiAgY29tbWVudElucHV0LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1kZXNjcmliZWRieScpO1xuICBjb21tZW50SW5wdXRFcnJvci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG59XG5cbmNvbnN0IGVycm9yRnVuY3Rpb25zID0ge1xuICBuYW1lOiB7XG4gICAgc2V0RXJyb3I6IHNldE5hbWVJbnB1dEVycm9yLFxuICAgIGNsZWFyRXJyb3I6IGNsZWFyTmFtZUlucHV0RXJyb3IsXG4gIH0sXG4gIHJhdGluZzoge1xuICAgIHNldEVycm9yOiBzZXRSYXRpbmdJbnB1dEVycm9yLFxuICAgIGNsZWFyRXJyb3I6IGNsZWFyUmF0aW5nSW5wdXRFcnJvcixcbiAgfSxcbiAgY29tbWVudDoge1xuICAgIHNldEVycm9yOiBzZXRDb21tZW50SW5wdXRFcnJvcixcbiAgICBjbGVhckVycm9yOiBjbGVhckNvbW1lbnRJbnB1dEVycm9yLFxuICB9XG59O1xuXG4vKioqKioqIHZhbGlkYXRpb24gKioqKioqKi9cblxuZnVuY3Rpb24gdmFsaWRhdGVJbnB1dChpZCkge1xuICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKS5jbG9uZU5vZGUoKTtcbiAgY29uc3QgdmFsdWUgPSBpZCA9PT0gJ3JhdGluZyc/IE51bWJlci5wYXJzZUludChpbnB1dC52YWx1ZSwgMTApIDogaW5wdXQudmFsdWU7XG4gIGlmICh2YWx1ZSkge1xuICAgIGVycm9yRnVuY3Rpb25zW2lkXS5jbGVhckVycm9yKCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgZXJyb3JGdW5jdGlvbnNbaWRdLnNldEVycm9yKCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQWxsSW5wdXRzKCkge1xuICBsZXQgYWxsSW5wdXRzVmFsaWQgPSB0cnVlO1xuICBjb25zdCBpbnB1dElkcyA9IFsnbmFtZScsICdyYXRpbmcnLCAnY29tbWVudCddO1xuICBpbnB1dElkcy5mb3JFYWNoKChpZCkgPT4ge1xuICAgIGNvbnN0IGlucHV0VmFsaWQgPSB2YWxpZGF0ZUlucHV0KGlkKTtcbiAgICBhbGxJbnB1dHNWYWxpZCA9IGFsbElucHV0c1ZhbGlkICYmIGlucHV0VmFsaWQ7XG4gIH0pO1xuICByZXR1cm4gYWxsSW5wdXRzVmFsaWQ7XG59XG5cbi8qKioqKiogaGFuZGxlIGV2ZW50cyAqKioqKioqL1xuXG5mdW5jdGlvbiBoYW5kbGVSYW5nZUNoYW5nZShldmVudCkge1xuICB2YXIgcmF0aW5nVmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmF0aW5nLXZhbHVlJyk7XG4gIHJhdGluZ1ZhbHVlLmlubmVySFRNTCA9IGAke2V2ZW50LnRhcmdldC52YWx1ZX0uMGA7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZU5hbWVJbnB1dEJsdXIoKSB7XG4gIHZhbGlkYXRlSW5wdXQoJ25hbWUnKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlUmF0aW5nSW5wdXRCbHVyKCkge1xuICB2YWxpZGF0ZUlucHV0KCdyYXRpbmcnKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQ29tbWVudElucHV0Qmx1cigpIHtcbiAgdmFsaWRhdGVJbnB1dCgnY29tbWVudCcpO1xufVxuXG5mdW5jdGlvbiBnZXRGb3JtSW5wdXRWYWx1ZXMoKSB7XG4gIGNvbnN0IGlucHV0SWRzID0gWyduYW1lJywgJ3JhdGluZycsICdjb21tZW50J107XG4gIGNvbnN0IHZhbHVlcyA9IHt9O1xuICBpbnB1dElkcy5mb3JFYWNoKChpZCkgPT4ge1xuICAgIHZhbHVlc1tpZF0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkudmFsdWU7XG4gIH0pO1xuICByZXR1cm4gdmFsdWVzO1xufVxuXG5mdW5jdGlvbiBjbGVhckZvcm0oKSB7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJykudmFsdWUgPSAnJztcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JhdGluZycpLnZhbHVlID0gJzAnO1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmF0aW5nLXZhbHVlJykuaW5uZXJIVE1MID0gJzAuMCc7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tZW50JykudmFsdWUgPSAnJztcbn1cblxuZnVuY3Rpb24gaGFuZGxlQWRkUmV2aWV3U3VibWl0KCl7XG4gIGNvbnN0IGFsbElucHV0c1ZhbGlkID0gdmFsaWRhdGVBbGxJbnB1dHMoKTtcbiAgaWYgKGFsbElucHV0c1ZhbGlkKSB7XG4gICAgY29uc3QgdmFsdWVzID0gZ2V0Rm9ybUlucHV0VmFsdWVzKCk7XG4gICAgY29uc29sZS5sb2coeyAuLi52YWx1ZXMsIHJlc3RhdXJhbnRfaWQ6IHNlbGYucmVzdGF1cmFudC5pZCB9KTtcbiAgICBjbG9zZU1vZGFsKCk7XG4gICAgY2xlYXJGb3JtKCk7XG4gIH1cbn1cbiJdLCJmaWxlIjoiYWRkUmV2aWV3TW9kYWwuanMifQ==

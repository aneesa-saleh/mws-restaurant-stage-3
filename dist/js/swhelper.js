"use strict";

var registerServiceWorker = function registerServiceWorker() {
  if (!navigator.serviceWorker) return;
  navigator.serviceWorker.register('/service-worker.js').catch(function (error) {
    return console.log(error);
  });
};

var cleanMapboxTilesCache = function cleanMapboxTilesCache() {
  caches.open('restaurant-reviews-map-tiles').then(function (cache) {
    return cache.keys().then(function (requests) {
      var length = requests.length;
      if (length <= 12) return; // keep only the 12 most recent tiles

      requests.slice(0, length - 12).forEach(function (request) {
        cache.delete(request);
      });
    });
  });
};

var openDatabase = function openDatabase(requestFromServiceWorker) {
  if (!navigator.serviceWorker && !requestFromServiceWorker) return Promise.resolve();
  return idb.open('restaurant-reviews', 3, function (upgradeDb) {
    switch (upgradeDb.oldVersion) {
      case 0:
        upgradeDb.createObjectStore('restaurants', {
          keyPath: 'id'
        });

      case 1:
        var reviewsStore = upgradeDb.createObjectStore('reviews', {
          keyPath: 'id'
        });
        reviewsStore.createIndex('restaurant_id', 'restaurant_id');

      case 2:
        upgradeDb.createObjectStore('outbox', {
          keyPath: 'request_id'
        });
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3aGVscGVyLmpzIl0sIm5hbWVzIjpbInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiY2xlYW5NYXBib3hUaWxlc0NhY2hlIiwiY2FjaGVzIiwib3BlbiIsInRoZW4iLCJjYWNoZSIsImtleXMiLCJyZXF1ZXN0cyIsImxlbmd0aCIsInNsaWNlIiwiZm9yRWFjaCIsInJlcXVlc3QiLCJkZWxldGUiLCJvcGVuRGF0YWJhc2UiLCJyZXF1ZXN0RnJvbVNlcnZpY2VXb3JrZXIiLCJQcm9taXNlIiwicmVzb2x2ZSIsImlkYiIsInVwZ3JhZGVEYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJyZXZpZXdzU3RvcmUiLCJjcmVhdGVJbmRleCJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxxQkFBcUIsR0FBRyxTQUF4QkEscUJBQXdCLEdBQU07QUFDbEMsTUFBSSxDQUFDQyxTQUFTLENBQUNDLGFBQWYsRUFBOEI7QUFFOUJELEVBQUFBLFNBQVMsQ0FBQ0MsYUFBVixDQUF3QkMsUUFBeEIsQ0FBaUMsb0JBQWpDLEVBQ0dDLEtBREgsQ0FDUyxVQUFBQyxLQUFLO0FBQUEsV0FBSUMsT0FBTyxDQUFDQyxHQUFSLENBQVlGLEtBQVosQ0FBSjtBQUFBLEdBRGQ7QUFFRCxDQUxEOztBQU9BLElBQU1HLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsR0FBTTtBQUNsQ0MsRUFBQUEsTUFBTSxDQUFDQyxJQUFQLENBQVksOEJBQVosRUFBNENDLElBQTVDLENBQ0UsVUFBQUMsS0FBSztBQUFBLFdBQUlBLEtBQUssQ0FBQ0MsSUFBTixHQUFhRixJQUFiLENBQWtCLFVBQUNHLFFBQUQsRUFBYztBQUFBLFVBQy9CQyxNQUQrQixHQUNwQkQsUUFEb0IsQ0FDL0JDLE1BRCtCO0FBRXZDLFVBQUlBLE1BQU0sSUFBSSxFQUFkLEVBQWtCLE9BRnFCLENBSXZDOztBQUNBRCxNQUFBQSxRQUFRLENBQUNFLEtBQVQsQ0FBZSxDQUFmLEVBQWtCRCxNQUFNLEdBQUcsRUFBM0IsRUFBK0JFLE9BQS9CLENBQXVDLFVBQUNDLE9BQUQsRUFBYTtBQUNsRE4sUUFBQUEsS0FBSyxDQUFDTyxNQUFOLENBQWFELE9BQWI7QUFDRCxPQUZEO0FBR0QsS0FSUSxDQUFKO0FBQUEsR0FEUDtBQVdELENBWkQ7O0FBY0EsSUFBTUUsWUFBWSxHQUFHLFNBQWZBLFlBQWUsQ0FBQ0Msd0JBQUQsRUFBOEI7QUFDakQsTUFBSSxDQUFDcEIsU0FBUyxDQUFDQyxhQUFYLElBQTRCLENBQUNtQix3QkFBakMsRUFBMkQsT0FBT0MsT0FBTyxDQUFDQyxPQUFSLEVBQVA7QUFFM0QsU0FBT0MsR0FBRyxDQUFDZCxJQUFKLENBQVMsb0JBQVQsRUFBK0IsQ0FBL0IsRUFBa0MsVUFBQ2UsU0FBRCxFQUFlO0FBQ3RELFlBQU9BLFNBQVMsQ0FBQ0MsVUFBakI7QUFDRSxXQUFLLENBQUw7QUFDRUQsUUFBQUEsU0FBUyxDQUFDRSxpQkFBVixDQUE0QixhQUE1QixFQUEyQztBQUN6Q0MsVUFBQUEsT0FBTyxFQUFFO0FBRGdDLFNBQTNDOztBQUdGLFdBQUssQ0FBTDtBQUNFLFlBQU1DLFlBQVksR0FBR0osU0FBUyxDQUFDRSxpQkFBVixDQUE0QixTQUE1QixFQUF1QztBQUMxREMsVUFBQUEsT0FBTyxFQUFFO0FBRGlELFNBQXZDLENBQXJCO0FBR0FDLFFBQUFBLFlBQVksQ0FBQ0MsV0FBYixDQUF5QixlQUF6QixFQUEwQyxlQUExQzs7QUFDRixXQUFLLENBQUw7QUFDRUwsUUFBQUEsU0FBUyxDQUFDRSxpQkFBVixDQUE0QixRQUE1QixFQUFzQztBQUNwQ0MsVUFBQUEsT0FBTyxFQUFFO0FBRDJCLFNBQXRDO0FBWEo7QUFlRCxHQWhCTSxDQUFQO0FBaUJELENBcEJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyID0gKCkgPT4ge1xuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XG5cbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zZXJ2aWNlLXdvcmtlci5qcycpXG4gICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUubG9nKGVycm9yKSk7XG59O1xuXG5jb25zdCBjbGVhbk1hcGJveFRpbGVzQ2FjaGUgPSAoKSA9PiB7XG4gIGNhY2hlcy5vcGVuKCdyZXN0YXVyYW50LXJldmlld3MtbWFwLXRpbGVzJykudGhlbihcbiAgICBjYWNoZSA9PiBjYWNoZS5rZXlzKCkudGhlbigocmVxdWVzdHMpID0+IHtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSByZXF1ZXN0cztcbiAgICAgIGlmIChsZW5ndGggPD0gMTIpIHJldHVybjtcblxuICAgICAgLy8ga2VlcCBvbmx5IHRoZSAxMiBtb3N0IHJlY2VudCB0aWxlc1xuICAgICAgcmVxdWVzdHMuc2xpY2UoMCwgbGVuZ3RoIC0gMTIpLmZvckVhY2goKHJlcXVlc3QpID0+IHtcbiAgICAgICAgY2FjaGUuZGVsZXRlKHJlcXVlc3QpO1xuICAgICAgfSk7XG4gICAgfSksXG4gICk7XG59O1xuXG5jb25zdCBvcGVuRGF0YWJhc2UgPSAocmVxdWVzdEZyb21TZXJ2aWNlV29ya2VyKSA9PiB7XG4gIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIgJiYgIXJlcXVlc3RGcm9tU2VydmljZVdvcmtlcikgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuXG4gIHJldHVybiBpZGIub3BlbigncmVzdGF1cmFudC1yZXZpZXdzJywgMywgKHVwZ3JhZGVEYikgPT4ge1xuICAgIHN3aXRjaCh1cGdyYWRlRGIub2xkVmVyc2lvbikge1xuICAgICAgY2FzZSAwOlxuICAgICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgIH0pO1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjb25zdCByZXZpZXdzU3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XG4gICAgICAgICAga2V5UGF0aDogJ2lkJyxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldmlld3NTdG9yZS5jcmVhdGVJbmRleCgncmVzdGF1cmFudF9pZCcsICdyZXN0YXVyYW50X2lkJyk7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgnb3V0Ym94Jywge1xuICAgICAgICAgIGtleVBhdGg6ICdyZXF1ZXN0X2lkJyxcbiAgICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG4iXSwiZmlsZSI6InN3aGVscGVyLmpzIn0=

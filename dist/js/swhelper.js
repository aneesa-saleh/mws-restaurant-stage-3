"use strict";

var registerServiceWorker = function registerServiceWorker() {
  if (!navigator.serviceWorker) return;
  navigator.serviceWorker.register('/service-worker.js').catch(function (error) {
    return console.log(error);
  });
};

var cleanMapboxTilesCache = function cleanMapboxTilesCache() {
  caches.open('restaurant-reviews-map-tiles').then(function (cache) {
    return cache.keys().then(function (requests) {
      var length = requests.length;
      if (length <= 12) return; // keep only the 12 most recent tiles

      requests.slice(0, length - 12).forEach(function (request) {
        cache.delete(request);
      });
    });
  });
};

var openDatabase = function openDatabase(requestFromServiceWorker) {
  if (!navigator.serviceWorker && !requestFromServiceWorker) return Promise.resolve();
  return idb.open('restaurant-reviews', 4, function (upgradeDb) {
    switch (upgradeDb.oldVersion) {
      case 0:
        upgradeDb.createObjectStore('restaurants', {
          keyPath: 'id'
        });

      case 1:
        var reviewsStore = upgradeDb.createObjectStore('reviews', {
          keyPath: 'id'
        });
        reviewsStore.createIndex('restaurant_id', 'restaurant_id');

      case 2:
        upgradeDb.createObjectStore('outbox', {
          keyPath: 'request_id'
        });

      case 3:
        var outboxStore = upgradeDb.transaction.objectStore('outbox');
        outboxStore.createIndex('restaurant_id', 'restaurant_id');
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3aGVscGVyLmpzIl0sIm5hbWVzIjpbInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiY2xlYW5NYXBib3hUaWxlc0NhY2hlIiwiY2FjaGVzIiwib3BlbiIsInRoZW4iLCJjYWNoZSIsImtleXMiLCJyZXF1ZXN0cyIsImxlbmd0aCIsInNsaWNlIiwiZm9yRWFjaCIsInJlcXVlc3QiLCJkZWxldGUiLCJvcGVuRGF0YWJhc2UiLCJyZXF1ZXN0RnJvbVNlcnZpY2VXb3JrZXIiLCJQcm9taXNlIiwicmVzb2x2ZSIsImlkYiIsInVwZ3JhZGVEYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJyZXZpZXdzU3RvcmUiLCJjcmVhdGVJbmRleCIsIm91dGJveFN0b3JlIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxxQkFBcUIsR0FBRyxTQUF4QkEscUJBQXdCLEdBQU07QUFDbEMsTUFBSSxDQUFDQyxTQUFTLENBQUNDLGFBQWYsRUFBOEI7QUFFOUJELEVBQUFBLFNBQVMsQ0FBQ0MsYUFBVixDQUF3QkMsUUFBeEIsQ0FBaUMsb0JBQWpDLEVBQ0dDLEtBREgsQ0FDUyxVQUFBQyxLQUFLO0FBQUEsV0FBSUMsT0FBTyxDQUFDQyxHQUFSLENBQVlGLEtBQVosQ0FBSjtBQUFBLEdBRGQ7QUFFRCxDQUxEOztBQU9BLElBQU1HLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsR0FBTTtBQUNsQ0MsRUFBQUEsTUFBTSxDQUFDQyxJQUFQLENBQVksOEJBQVosRUFBNENDLElBQTVDLENBQ0UsVUFBQUMsS0FBSztBQUFBLFdBQUlBLEtBQUssQ0FBQ0MsSUFBTixHQUFhRixJQUFiLENBQWtCLFVBQUNHLFFBQUQsRUFBYztBQUFBLFVBQy9CQyxNQUQrQixHQUNwQkQsUUFEb0IsQ0FDL0JDLE1BRCtCO0FBRXZDLFVBQUlBLE1BQU0sSUFBSSxFQUFkLEVBQWtCLE9BRnFCLENBSXZDOztBQUNBRCxNQUFBQSxRQUFRLENBQUNFLEtBQVQsQ0FBZSxDQUFmLEVBQWtCRCxNQUFNLEdBQUcsRUFBM0IsRUFBK0JFLE9BQS9CLENBQXVDLFVBQUNDLE9BQUQsRUFBYTtBQUNsRE4sUUFBQUEsS0FBSyxDQUFDTyxNQUFOLENBQWFELE9BQWI7QUFDRCxPQUZEO0FBR0QsS0FSUSxDQUFKO0FBQUEsR0FEUDtBQVdELENBWkQ7O0FBY0EsSUFBTUUsWUFBWSxHQUFHLFNBQWZBLFlBQWUsQ0FBQ0Msd0JBQUQsRUFBOEI7QUFDakQsTUFBSSxDQUFDcEIsU0FBUyxDQUFDQyxhQUFYLElBQTRCLENBQUNtQix3QkFBakMsRUFBMkQsT0FBT0MsT0FBTyxDQUFDQyxPQUFSLEVBQVA7QUFFM0QsU0FBT0MsR0FBRyxDQUFDZCxJQUFKLENBQVMsb0JBQVQsRUFBK0IsQ0FBL0IsRUFBa0MsVUFBQ2UsU0FBRCxFQUFlO0FBQ3RELFlBQU9BLFNBQVMsQ0FBQ0MsVUFBakI7QUFDRSxXQUFLLENBQUw7QUFDRUQsUUFBQUEsU0FBUyxDQUFDRSxpQkFBVixDQUE0QixhQUE1QixFQUEyQztBQUN6Q0MsVUFBQUEsT0FBTyxFQUFFO0FBRGdDLFNBQTNDOztBQUdGLFdBQUssQ0FBTDtBQUNFLFlBQU1DLFlBQVksR0FBR0osU0FBUyxDQUFDRSxpQkFBVixDQUE0QixTQUE1QixFQUF1QztBQUMxREMsVUFBQUEsT0FBTyxFQUFFO0FBRGlELFNBQXZDLENBQXJCO0FBR0FDLFFBQUFBLFlBQVksQ0FBQ0MsV0FBYixDQUF5QixlQUF6QixFQUEwQyxlQUExQzs7QUFDRixXQUFLLENBQUw7QUFDRUwsUUFBQUEsU0FBUyxDQUFDRSxpQkFBVixDQUE0QixRQUE1QixFQUFzQztBQUNwQ0MsVUFBQUEsT0FBTyxFQUFFO0FBRDJCLFNBQXRDOztBQUdGLFdBQUssQ0FBTDtBQUNFLFlBQU1HLFdBQVcsR0FBR04sU0FBUyxDQUFDTyxXQUFWLENBQXNCQyxXQUF0QixDQUFrQyxRQUFsQyxDQUFwQjtBQUNBRixRQUFBQSxXQUFXLENBQUNELFdBQVosQ0FBd0IsZUFBeEIsRUFBeUMsZUFBekM7QUFoQko7QUFrQkQsR0FuQk0sQ0FBUDtBQW9CRCxDQXZCRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlZ2lzdGVyU2VydmljZVdvcmtlciA9ICgpID0+IHtcbiAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuO1xuXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc2VydmljZS13b3JrZXIuanMnKVxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhlcnJvcikpO1xufTtcblxuY29uc3QgY2xlYW5NYXBib3hUaWxlc0NhY2hlID0gKCkgPT4ge1xuICBjYWNoZXMub3BlbigncmVzdGF1cmFudC1yZXZpZXdzLW1hcC10aWxlcycpLnRoZW4oXG4gICAgY2FjaGUgPT4gY2FjaGUua2V5cygpLnRoZW4oKHJlcXVlc3RzKSA9PiB7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gcmVxdWVzdHM7XG4gICAgICBpZiAobGVuZ3RoIDw9IDEyKSByZXR1cm47XG5cbiAgICAgIC8vIGtlZXAgb25seSB0aGUgMTIgbW9zdCByZWNlbnQgdGlsZXNcbiAgICAgIHJlcXVlc3RzLnNsaWNlKDAsIGxlbmd0aCAtIDEyKS5mb3JFYWNoKChyZXF1ZXN0KSA9PiB7XG4gICAgICAgIGNhY2hlLmRlbGV0ZShyZXF1ZXN0KTtcbiAgICAgIH0pO1xuICAgIH0pLFxuICApO1xufTtcblxuY29uc3Qgb3BlbkRhdGFiYXNlID0gKHJlcXVlc3RGcm9tU2VydmljZVdvcmtlcikgPT4ge1xuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyICYmICFyZXF1ZXN0RnJvbVNlcnZpY2VXb3JrZXIpIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblxuICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnQtcmV2aWV3cycsIDQsICh1cGdyYWRlRGIpID0+IHtcbiAgICBzd2l0Y2godXBncmFkZURiLm9sZFZlcnNpb24pIHtcbiAgICAgIGNhc2UgMDpcbiAgICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICB9KTtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgY29uc3QgcmV2aWV3c1N0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xuICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgIH0pO1xuICAgICAgICByZXZpZXdzU3RvcmUuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLCAncmVzdGF1cmFudF9pZCcpO1xuICAgICAgY2FzZSAyOlxuICAgICAgICB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ291dGJveCcsIHtcbiAgICAgICAgICBrZXlQYXRoOiAncmVxdWVzdF9pZCcsXG4gICAgICAgIH0pO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBjb25zdCBvdXRib3hTdG9yZSA9IHVwZ3JhZGVEYi50cmFuc2FjdGlvbi5vYmplY3RTdG9yZSgnb3V0Ym94Jyk7XG4gICAgICAgIG91dGJveFN0b3JlLmNyZWF0ZUluZGV4KCdyZXN0YXVyYW50X2lkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcbiAgICB9XG4gIH0pO1xufTtcbiJdLCJmaWxlIjoic3doZWxwZXIuanMifQ==

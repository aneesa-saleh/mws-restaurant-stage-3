"use strict";

var registerServiceWorker = function registerServiceWorker() {
  if (!navigator.serviceWorker) return;
  navigator.serviceWorker.register('/service-worker.js').catch(function (error) {
    return console.log(error);
  });
};

var cleanMapboxTilesCache = function cleanMapboxTilesCache() {
  caches.open('restaurant-reviews-map-tiles').then(function (cache) {
    return cache.keys().then(function (requests) {
      var length = requests.length;
      if (length <= 12) return; // keep only the 12 most recent tiles

      requests.slice(0, length - 12).forEach(function (request) {
        cache.delete(request);
      });
    });
  });
};
/* eslint-disable default-case */

/* eslint-disable no-fallthrough */


var openDatabase = function openDatabase(requestFromServiceWorker) {
  if (!navigator.serviceWorker && !requestFromServiceWorker) return Promise.resolve();
  return idb.open('restaurant-reviews', 4, function (upgradeDb) {
    switch (upgradeDb.oldVersion) {
      case 0:
        {
          upgradeDb.createObjectStore('restaurants', {
            keyPath: 'id'
          });
        }

      case 1:
        {
          var reviewsStore = upgradeDb.createObjectStore('reviews', {
            keyPath: 'id'
          });
          reviewsStore.createIndex('restaurant_id', 'restaurant_id');
        }

      case 2:
        {
          upgradeDb.createObjectStore('outbox', {
            keyPath: 'request_id'
          });
        }

      case 3:
        {
          var outboxStore = upgradeDb.transaction.objectStore('outbox');
          outboxStore.createIndex('restaurant_id', 'restaurant_id');
        }
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3aGVscGVyLmpzIl0sIm5hbWVzIjpbInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiY2xlYW5NYXBib3hUaWxlc0NhY2hlIiwiY2FjaGVzIiwib3BlbiIsInRoZW4iLCJjYWNoZSIsImtleXMiLCJyZXF1ZXN0cyIsImxlbmd0aCIsInNsaWNlIiwiZm9yRWFjaCIsInJlcXVlc3QiLCJkZWxldGUiLCJvcGVuRGF0YWJhc2UiLCJyZXF1ZXN0RnJvbVNlcnZpY2VXb3JrZXIiLCJQcm9taXNlIiwicmVzb2x2ZSIsImlkYiIsInVwZ3JhZGVEYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJyZXZpZXdzU3RvcmUiLCJjcmVhdGVJbmRleCIsIm91dGJveFN0b3JlIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxxQkFBcUIsR0FBRyxTQUF4QkEscUJBQXdCLEdBQU07QUFDbEMsTUFBSSxDQUFDQyxTQUFTLENBQUNDLGFBQWYsRUFBOEI7QUFFOUJELEVBQUFBLFNBQVMsQ0FBQ0MsYUFBVixDQUF3QkMsUUFBeEIsQ0FBaUMsb0JBQWpDLEVBQ0dDLEtBREgsQ0FDUyxVQUFBQyxLQUFLO0FBQUEsV0FBSUMsT0FBTyxDQUFDQyxHQUFSLENBQVlGLEtBQVosQ0FBSjtBQUFBLEdBRGQ7QUFFRCxDQUxEOztBQU9BLElBQU1HLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0IsR0FBTTtBQUNsQ0MsRUFBQUEsTUFBTSxDQUFDQyxJQUFQLENBQVksOEJBQVosRUFBNENDLElBQTVDLENBQ0UsVUFBQUMsS0FBSztBQUFBLFdBQUlBLEtBQUssQ0FBQ0MsSUFBTixHQUFhRixJQUFiLENBQWtCLFVBQUNHLFFBQUQsRUFBYztBQUFBLFVBQy9CQyxNQUQrQixHQUNwQkQsUUFEb0IsQ0FDL0JDLE1BRCtCO0FBRXZDLFVBQUlBLE1BQU0sSUFBSSxFQUFkLEVBQWtCLE9BRnFCLENBSXZDOztBQUNBRCxNQUFBQSxRQUFRLENBQUNFLEtBQVQsQ0FBZSxDQUFmLEVBQWtCRCxNQUFNLEdBQUcsRUFBM0IsRUFBK0JFLE9BQS9CLENBQXVDLFVBQUNDLE9BQUQsRUFBYTtBQUNsRE4sUUFBQUEsS0FBSyxDQUFDTyxNQUFOLENBQWFELE9BQWI7QUFDRCxPQUZEO0FBR0QsS0FSUSxDQUFKO0FBQUEsR0FEUDtBQVdELENBWkQ7QUFjQTs7QUFDQTs7O0FBRUEsSUFBTUUsWUFBWSxHQUFHLFNBQWZBLFlBQWUsQ0FBQ0Msd0JBQUQsRUFBOEI7QUFDakQsTUFBSSxDQUFDcEIsU0FBUyxDQUFDQyxhQUFYLElBQTRCLENBQUNtQix3QkFBakMsRUFBMkQsT0FBT0MsT0FBTyxDQUFDQyxPQUFSLEVBQVA7QUFFM0QsU0FBT0MsR0FBRyxDQUFDZCxJQUFKLENBQVMsb0JBQVQsRUFBK0IsQ0FBL0IsRUFBa0MsVUFBQ2UsU0FBRCxFQUFlO0FBQ3RELFlBQVFBLFNBQVMsQ0FBQ0MsVUFBbEI7QUFDRSxXQUFLLENBQUw7QUFBUTtBQUNORCxVQUFBQSxTQUFTLENBQUNFLGlCQUFWLENBQTRCLGFBQTVCLEVBQTJDO0FBQ3pDQyxZQUFBQSxPQUFPLEVBQUU7QUFEZ0MsV0FBM0M7QUFHRDs7QUFDRCxXQUFLLENBQUw7QUFBUTtBQUFFLGNBQU1DLFlBQVksR0FBR0osU0FBUyxDQUFDRSxpQkFBVixDQUE0QixTQUE1QixFQUF1QztBQUNwRUMsWUFBQUEsT0FBTyxFQUFFO0FBRDJELFdBQXZDLENBQXJCO0FBR1ZDLFVBQUFBLFlBQVksQ0FBQ0MsV0FBYixDQUF5QixlQUF6QixFQUEwQyxlQUExQztBQUNDOztBQUNELFdBQUssQ0FBTDtBQUFRO0FBQ05MLFVBQUFBLFNBQVMsQ0FBQ0UsaUJBQVYsQ0FBNEIsUUFBNUIsRUFBc0M7QUFDcENDLFlBQUFBLE9BQU8sRUFBRTtBQUQyQixXQUF0QztBQUdEOztBQUNELFdBQUssQ0FBTDtBQUFRO0FBQ04sY0FBTUcsV0FBVyxHQUFHTixTQUFTLENBQUNPLFdBQVYsQ0FBc0JDLFdBQXRCLENBQWtDLFFBQWxDLENBQXBCO0FBQ0FGLFVBQUFBLFdBQVcsQ0FBQ0QsV0FBWixDQUF3QixlQUF4QixFQUF5QyxlQUF6QztBQUNEO0FBbkJIO0FBcUJELEdBdEJNLENBQVA7QUF1QkQsQ0ExQkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XG4gIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHJldHVybjtcblxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3NlcnZpY2Utd29ya2VyLmpzJylcbiAgICAuY2F0Y2goZXJyb3IgPT4gY29uc29sZS5sb2coZXJyb3IpKTtcbn07XG5cbmNvbnN0IGNsZWFuTWFwYm94VGlsZXNDYWNoZSA9ICgpID0+IHtcbiAgY2FjaGVzLm9wZW4oJ3Jlc3RhdXJhbnQtcmV2aWV3cy1tYXAtdGlsZXMnKS50aGVuKFxuICAgIGNhY2hlID0+IGNhY2hlLmtleXMoKS50aGVuKChyZXF1ZXN0cykgPT4ge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHJlcXVlc3RzO1xuICAgICAgaWYgKGxlbmd0aCA8PSAxMikgcmV0dXJuO1xuXG4gICAgICAvLyBrZWVwIG9ubHkgdGhlIDEyIG1vc3QgcmVjZW50IHRpbGVzXG4gICAgICByZXF1ZXN0cy5zbGljZSgwLCBsZW5ndGggLSAxMikuZm9yRWFjaCgocmVxdWVzdCkgPT4ge1xuICAgICAgICBjYWNoZS5kZWxldGUocmVxdWVzdCk7XG4gICAgICB9KTtcbiAgICB9KSxcbiAgKTtcbn07XG5cbi8qIGVzbGludC1kaXNhYmxlIGRlZmF1bHQtY2FzZSAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tZmFsbHRocm91Z2ggKi9cblxuY29uc3Qgb3BlbkRhdGFiYXNlID0gKHJlcXVlc3RGcm9tU2VydmljZVdvcmtlcikgPT4ge1xuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyICYmICFyZXF1ZXN0RnJvbVNlcnZpY2VXb3JrZXIpIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcblxuICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnQtcmV2aWV3cycsIDQsICh1cGdyYWRlRGIpID0+IHtcbiAgICBzd2l0Y2ggKHVwZ3JhZGVEYi5vbGRWZXJzaW9uKSB7XG4gICAgICBjYXNlIDA6IHtcbiAgICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcbiAgICAgICAgICBrZXlQYXRoOiAnaWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgMTogeyBjb25zdCByZXZpZXdzU3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XG4gICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICB9KTtcbiAgICAgIHJldmlld3NTdG9yZS5jcmVhdGVJbmRleCgncmVzdGF1cmFudF9pZCcsICdyZXN0YXVyYW50X2lkJyk7XG4gICAgICB9XG4gICAgICBjYXNlIDI6IHtcbiAgICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdvdXRib3gnLCB7XG4gICAgICAgICAga2V5UGF0aDogJ3JlcXVlc3RfaWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgMzoge1xuICAgICAgICBjb25zdCBvdXRib3hTdG9yZSA9IHVwZ3JhZGVEYi50cmFuc2FjdGlvbi5vYmplY3RTdG9yZSgnb3V0Ym94Jyk7XG4gICAgICAgIG91dGJveFN0b3JlLmNyZWF0ZUluZGV4KCdyZXN0YXVyYW50X2lkJywgJ3Jlc3RhdXJhbnRfaWQnKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbiJdLCJmaWxlIjoic3doZWxwZXIuanMifQ==

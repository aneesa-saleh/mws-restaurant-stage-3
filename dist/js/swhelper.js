"use strict";

var registerServiceWorker = function registerServiceWorker() {
  if (!navigator.serviceWorker) return;
  navigator.serviceWorker.register('/service-worker.js').catch(function (error) {
    return console.log(error);
  });
};

var cleanMapboxTilesCache = function cleanMapboxTilesCache() {
  caches.open('restaurant-reviews-map-tiles').then(function (cache) {
    return cache.keys().then(function (requests) {
      var length = requests.length;
      if (length <= 12) return; // keep only the 12 most recent tiles

      requests.slice(0, length - 12).forEach(function (request) {
        cache.delete(request);
      });
    });
  });
};

var openDatabase = function openDatabase() {
  if (!navigator.serviceWorker) return Promise.resolve();
  return idb.open('restaurant-reviews', 2, function (upgradeDb) {
    switch (upgradeDb.oldVersion) {
      case 0:
        var restaurantsStore = upgradeDb.createObjectStore('restaurants', {
          keyPath: 'id'
        });

      case 1:
        var reviewsStore = upgradeDb.createObjectStore('reviews', {
          keyPath: 'id'
        });
        reviewsStore.createIndex('restaurant_id', 'restaurant_id');
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3aGVscGVyLmpzIl0sIm5hbWVzIjpbInJlZ2lzdGVyU2VydmljZVdvcmtlciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJyZWdpc3RlciIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiY2xlYW5NYXBib3hUaWxlc0NhY2hlIiwiY2FjaGVzIiwib3BlbiIsInRoZW4iLCJjYWNoZSIsImtleXMiLCJyZXF1ZXN0cyIsImxlbmd0aCIsInNsaWNlIiwiZm9yRWFjaCIsInJlcXVlc3QiLCJkZWxldGUiLCJvcGVuRGF0YWJhc2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsImlkYiIsInVwZ3JhZGVEYiIsIm9sZFZlcnNpb24iLCJyZXN0YXVyYW50c1N0b3JlIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwicmV2aWV3c1N0b3JlIiwiY3JlYXRlSW5kZXgiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEscUJBQXFCLEdBQUcsU0FBeEJBLHFCQUF3QixHQUFNO0FBQ2xDLE1BQUksQ0FBQ0MsU0FBUyxDQUFDQyxhQUFmLEVBQThCO0FBRTlCRCxFQUFBQSxTQUFTLENBQUNDLGFBQVYsQ0FBd0JDLFFBQXhCLENBQWlDLG9CQUFqQyxFQUNHQyxLQURILENBQ1MsVUFBQUMsS0FBSztBQUFBLFdBQUlDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixLQUFaLENBQUo7QUFBQSxHQURkO0FBRUQsQ0FMRDs7QUFPQSxJQUFNRyxxQkFBcUIsR0FBRyxTQUF4QkEscUJBQXdCLEdBQU07QUFDbENDLEVBQUFBLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZLDhCQUFaLEVBQTRDQyxJQUE1QyxDQUNFLFVBQUFDLEtBQUs7QUFBQSxXQUFJQSxLQUFLLENBQUNDLElBQU4sR0FBYUYsSUFBYixDQUFrQixVQUFDRyxRQUFELEVBQWM7QUFBQSxVQUMvQkMsTUFEK0IsR0FDcEJELFFBRG9CLENBQy9CQyxNQUQrQjtBQUV2QyxVQUFJQSxNQUFNLElBQUksRUFBZCxFQUFrQixPQUZxQixDQUl2Qzs7QUFDQUQsTUFBQUEsUUFBUSxDQUFDRSxLQUFULENBQWUsQ0FBZixFQUFrQkQsTUFBTSxHQUFHLEVBQTNCLEVBQStCRSxPQUEvQixDQUF1QyxVQUFDQyxPQUFELEVBQWE7QUFDbEROLFFBQUFBLEtBQUssQ0FBQ08sTUFBTixDQUFhRCxPQUFiO0FBQ0QsT0FGRDtBQUdELEtBUlEsQ0FBSjtBQUFBLEdBRFA7QUFXRCxDQVpEOztBQWNBLElBQU1FLFlBQVksR0FBRyxTQUFmQSxZQUFlLEdBQU07QUFDekIsTUFBSSxDQUFDbkIsU0FBUyxDQUFDQyxhQUFmLEVBQThCLE9BQU9tQixPQUFPLENBQUNDLE9BQVIsRUFBUDtBQUU5QixTQUFPQyxHQUFHLENBQUNiLElBQUosQ0FBUyxvQkFBVCxFQUErQixDQUEvQixFQUFrQyxVQUFDYyxTQUFELEVBQWU7QUFDdEQsWUFBT0EsU0FBUyxDQUFDQyxVQUFqQjtBQUNFLFdBQUssQ0FBTDtBQUNFLFlBQU1DLGdCQUFnQixHQUFHRixTQUFTLENBQUNHLGlCQUFWLENBQTRCLGFBQTVCLEVBQTJDO0FBQ2xFQyxVQUFBQSxPQUFPLEVBQUU7QUFEeUQsU0FBM0MsQ0FBekI7O0FBR0YsV0FBSyxDQUFMO0FBQ0UsWUFBTUMsWUFBWSxHQUFHTCxTQUFTLENBQUNHLGlCQUFWLENBQTRCLFNBQTVCLEVBQXVDO0FBQzFEQyxVQUFBQSxPQUFPLEVBQUU7QUFEaUQsU0FBdkMsQ0FBckI7QUFHQUMsUUFBQUEsWUFBWSxDQUFDQyxXQUFiLENBQXlCLGVBQXpCLEVBQTBDLGVBQTFDO0FBVEo7QUFXRCxHQVpNLENBQVA7QUFhRCxDQWhCRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHJlZ2lzdGVyU2VydmljZVdvcmtlciA9ICgpID0+IHtcbiAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuO1xuXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc2VydmljZS13b3JrZXIuanMnKVxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhlcnJvcikpO1xufTtcblxuY29uc3QgY2xlYW5NYXBib3hUaWxlc0NhY2hlID0gKCkgPT4ge1xuICBjYWNoZXMub3BlbigncmVzdGF1cmFudC1yZXZpZXdzLW1hcC10aWxlcycpLnRoZW4oXG4gICAgY2FjaGUgPT4gY2FjaGUua2V5cygpLnRoZW4oKHJlcXVlc3RzKSA9PiB7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gcmVxdWVzdHM7XG4gICAgICBpZiAobGVuZ3RoIDw9IDEyKSByZXR1cm47XG5cbiAgICAgIC8vIGtlZXAgb25seSB0aGUgMTIgbW9zdCByZWNlbnQgdGlsZXNcbiAgICAgIHJlcXVlc3RzLnNsaWNlKDAsIGxlbmd0aCAtIDEyKS5mb3JFYWNoKChyZXF1ZXN0KSA9PiB7XG4gICAgICAgIGNhY2hlLmRlbGV0ZShyZXF1ZXN0KTtcbiAgICAgIH0pO1xuICAgIH0pLFxuICApO1xufTtcblxuY29uc3Qgb3BlbkRhdGFiYXNlID0gKCkgPT4ge1xuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG5cbiAgcmV0dXJuIGlkYi5vcGVuKCdyZXN0YXVyYW50LXJldmlld3MnLCAyLCAodXBncmFkZURiKSA9PiB7XG4gICAgc3dpdGNoKHVwZ3JhZGVEYi5vbGRWZXJzaW9uKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnRzU3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgIH0pO1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjb25zdCByZXZpZXdzU3RvcmUgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XG4gICAgICAgICAga2V5UGF0aDogJ2lkJyxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldmlld3NTdG9yZS5jcmVhdGVJbmRleCgncmVzdGF1cmFudF9pZCcsICdyZXN0YXVyYW50X2lkJyk7XG4gICAgfVxuICB9KTtcbn07XG4iXSwiZmlsZSI6InN3aGVscGVyLmpzIn0=
